<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The fundamental library for scientific computing in optical and visual perception sciences.">
      
      
        <meta name="author" content="Kaan AkÅŸit">
      
      
        <link rel="canonical" href="https://kaanaksit.github.io/odak/odak/learn_perception/">
      
      
        <link rel="prev" href="../../notes/using_metameric_loss/">
      
      
      
      <link rel="icon" href="../../odak.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>odak.learn.perception - Odak</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="odak" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#odak.learn.perception" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
For updates follow 
<a href="https://x.com/kaanaksit" style="color:#1da1f2;">
<strong>@kaanaksit</strong> 
</a>
on
<a href="https://x.com/kaanaksit" style="color:#1da1f2;">
<span class="twemoji twitter"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </span>
</a>
<strong>
Twitter
</strong>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Odak" class="md-header__button md-logo" aria-label="Odak" data-md-component="logo">
      
  <img src="../../odak.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Odak
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              odak.learn.perception
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="odak" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kaanaksit/odak" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    kaanaksit/odak
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Odak" class="md-nav__button md-logo" aria-label="Odak" data-md-component="logo">
      
  <img src="../../odak.png" alt="logo">

    </a>
    Odak
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kaanaksit/odak" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    kaanaksit/odak
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Getting started
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    What is Odak?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../course/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Computational Light Course
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Computational Light Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/computational_light/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Light, Computation, and Computational Light
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fundamentals in optimizing and learning light
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/geometric_optics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Modeling light with rays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/computer_generated_holography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computer-Generated Holography
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/visual_perception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visual Perception
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/computational_displays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computational Displays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/computational_imaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Computational Imaging and Sensing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../course/photonic_computers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    All-optical Machine Learning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Computer-Generated Holography
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Computer-Generated Holography
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cgh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/holographic_light_transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Holographic Light Transport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/optimizing_holograms_using_odak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hologram Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wave/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.wave
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learn_wave/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.learn.wave
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lensless Imaging
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Lensless Imaging
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1">
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lensless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learn_lensless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.learn.lensless
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    General toolkit
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            General toolkit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../toolkit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learn_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.learn.tools
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Machine learning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Machine learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.fit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learn_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.learn.models
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Raytracing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Raytracing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.raytracing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../learn_raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    odak.learn.raytracing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Visual perception
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Visual perception
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1">
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../perception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/using_metameric_loss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using metameric loss
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    odak.learn.perception
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    odak.learn.perception
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception" class="md-nav__link">
    <span class="md-ellipsis">
      perception
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BlurLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BlurLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      CVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      FVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS" class="md-nav__link">
    <span class="md-ellipsis">
      LPIPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LPIPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MSSSIM" class="md-nav__link">
    <span class="md-ellipsis">
      MSSSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MSSSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MSSSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamerMSELoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamerMSELoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLossUniform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLossUniform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.PSNR" class="md-nav__link">
    <span class="md-ellipsis">
      PSNR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSNR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.PSNR.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.RadiallyVaryingBlur" class="md-nav__link">
    <span class="md-ellipsis">
      RadiallyVaryingBlur
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RadiallyVaryingBlur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.RadiallyVaryingBlur.blur" class="md-nav__link">
    <span class="md-ellipsis">
      blur
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.SSIM" class="md-nav__link">
    <span class="md-ellipsis">
      SSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialSteerablePyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialSteerablePyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.construct_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      construct_pyramid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.reconstruct_from_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_from_pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs" class="md-nav__link">
    <span class="md-ellipsis">
      display_color_hvs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="display_color_hvs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.cone_response_to_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      cone_response_to_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.construct_matrix_lms" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.construct_matrix_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.display_spectrum_response" class="md-nav__link">
    <span class="md-ellipsis">
      display_spectrum_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_cones_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_cones_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_random_spectrum_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_random_spectrum_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_rgb_backlight_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_rgb_backlight_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.lms_to_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      lms_to_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.primaries_to_lms" class="md-nav__link">
    <span class="md-ellipsis">
      primaries_to_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.second_to_third_stage" class="md-nav__link">
    <span class="md-ellipsis">
      second_to_third_stage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_map" class="md-nav__link">
    <span class="md-ellipsis">
      color_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.crop_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      crop_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.get_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      get_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.hsv_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      hsv_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.lab_to_srgb" class="md-nav__link">
    <span class="md-ellipsis">
      lab_to_srgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.linear_rgb_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.linear_rgb_to_xyz" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_xyz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_3d_location_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_3d_location_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_eccentricity_distance_maps" class="md-nav__link">
    <span class="md-ellipsis">
      make_eccentricity_distance_maps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_equi_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_equi_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_radial_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_radial_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.pad_image_for_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pad_image_for_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_2_ycrcb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_2_ycrcb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_to_hsv" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_hsv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.srgb_to_lab" class="md-nav__link">
    <span class="md-ellipsis">
      srgb_to_lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.xyz_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      xyz_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.ycrcb_2_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      ycrcb_2_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss" class="md-nav__link">
    <span class="md-ellipsis">
      blur_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BlurLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BlurLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion" class="md-nav__link">
    <span class="md-ellipsis">
      color_conversion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs" class="md-nav__link">
    <span class="md-ellipsis">
      display_color_hvs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="display_color_hvs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.cone_response_to_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      cone_response_to_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_lms" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.display_spectrum_response" class="md-nav__link">
    <span class="md-ellipsis">
      display_spectrum_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_cones_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_cones_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_random_spectrum_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_random_spectrum_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_rgb_backlight_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_rgb_backlight_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.lms_to_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      lms_to_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.primaries_to_lms" class="md-nav__link">
    <span class="md-ellipsis">
      primaries_to_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.second_to_third_stage" class="md-nav__link">
    <span class="md-ellipsis">
      second_to_third_stage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.color_map" class="md-nav__link">
    <span class="md-ellipsis">
      color_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.hsv_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      hsv_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.lab_to_srgb" class="md-nav__link">
    <span class="md-ellipsis">
      lab_to_srgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.linear_rgb_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.linear_rgb_to_xyz" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_xyz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_2_ycrcb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_2_ycrcb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_to_hsv" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_hsv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.srgb_to_lab" class="md-nav__link">
    <span class="md-ellipsis">
      srgb_to_lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.xyz_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      xyz_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.ycrcb_2_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      ycrcb_2_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation" class="md-nav__link">
    <span class="md-ellipsis">
      foveation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_3d_location_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_3d_location_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_eccentricity_distance_maps" class="md-nav__link">
    <span class="md-ellipsis">
      make_eccentricity_distance_maps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_radial_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_radial_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses" class="md-nav__link">
    <span class="md-ellipsis">
      image_quality_losses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.MSSSIM" class="md-nav__link">
    <span class="md-ellipsis">
      MSSSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MSSSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.MSSSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.PSNR" class="md-nav__link">
    <span class="md-ellipsis">
      PSNR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSNR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.PSNR.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.SSIM" class="md-nav__link">
    <span class="md-ellipsis">
      SSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.SSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses" class="md-nav__link">
    <span class="md-ellipsis">
      learned_perceptual_losses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      CVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      FVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS" class="md-nav__link">
    <span class="md-ellipsis">
      LPIPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LPIPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss" class="md-nav__link">
    <span class="md-ellipsis">
      metameric_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform" class="md-nav__link">
    <span class="md-ellipsis">
      metameric_loss_uniform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLossUniform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLossUniform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss" class="md-nav__link">
    <span class="md-ellipsis">
      metamer_mse_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamerMSELoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamerMSELoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur" class="md-nav__link">
    <span class="md-ellipsis">
      radially_varying_blur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur" class="md-nav__link">
    <span class="md-ellipsis">
      RadiallyVaryingBlur
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RadiallyVaryingBlur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur.blur" class="md-nav__link">
    <span class="md-ellipsis">
      blur
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_steerable_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialSteerablePyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialSteerablePyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.construct_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      construct_pyramid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.reconstruct_from_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_from_pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.pad_image_for_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pad_image_for_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters.crop_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      crop_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters.get_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      get_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.util" class="md-nav__link">
    <span class="md-ellipsis">
      util
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.util.slice_rgbd_targets" class="md-nav__link">
    <span class="md-ellipsis">
      slice_rgbd_targets
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception" class="md-nav__link">
    <span class="md-ellipsis">
      perception
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BlurLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BlurLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.BlurLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      CVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.CVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      FVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.FVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS" class="md-nav__link">
    <span class="md-ellipsis">
      LPIPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LPIPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.LPIPS.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MSSSIM" class="md-nav__link">
    <span class="md-ellipsis">
      MSSSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MSSSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MSSSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamerMSELoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamerMSELoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamerMSELoss.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLossUniform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLossUniform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.MetamericLossUniform.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.PSNR" class="md-nav__link">
    <span class="md-ellipsis">
      PSNR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSNR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.PSNR.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.RadiallyVaryingBlur" class="md-nav__link">
    <span class="md-ellipsis">
      RadiallyVaryingBlur
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RadiallyVaryingBlur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.RadiallyVaryingBlur.blur" class="md-nav__link">
    <span class="md-ellipsis">
      blur
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.SSIM" class="md-nav__link">
    <span class="md-ellipsis">
      SSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialSteerablePyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialSteerablePyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.construct_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      construct_pyramid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.SpatialSteerablePyramid.reconstruct_from_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_from_pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs" class="md-nav__link">
    <span class="md-ellipsis">
      display_color_hvs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="display_color_hvs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.cone_response_to_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      cone_response_to_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.construct_matrix_lms" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.construct_matrix_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.display_spectrum_response" class="md-nav__link">
    <span class="md-ellipsis">
      display_spectrum_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_cones_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_cones_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_random_spectrum_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_random_spectrum_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.initialize_rgb_backlight_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_rgb_backlight_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.lms_to_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      lms_to_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.primaries_to_lms" class="md-nav__link">
    <span class="md-ellipsis">
      primaries_to_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.display_color_hvs.second_to_third_stage" class="md-nav__link">
    <span class="md-ellipsis">
      second_to_third_stage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_map" class="md-nav__link">
    <span class="md-ellipsis">
      color_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.crop_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      crop_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.get_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      get_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.hsv_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      hsv_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.lab_to_srgb" class="md-nav__link">
    <span class="md-ellipsis">
      lab_to_srgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.linear_rgb_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.linear_rgb_to_xyz" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_xyz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_3d_location_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_3d_location_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_eccentricity_distance_maps" class="md-nav__link">
    <span class="md-ellipsis">
      make_eccentricity_distance_maps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_equi_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_equi_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.make_radial_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_radial_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.pad_image_for_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pad_image_for_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_2_ycrcb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_2_ycrcb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_to_hsv" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_hsv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.rgb_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.srgb_to_lab" class="md-nav__link">
    <span class="md-ellipsis">
      srgb_to_lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.xyz_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      xyz_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.ycrcb_2_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      ycrcb_2_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss" class="md-nav__link">
    <span class="md-ellipsis">
      blur_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss" class="md-nav__link">
    <span class="md-ellipsis">
      BlurLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BlurLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.blur_loss.BlurLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion" class="md-nav__link">
    <span class="md-ellipsis">
      color_conversion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs" class="md-nav__link">
    <span class="md-ellipsis">
      display_color_hvs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="display_color_hvs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.cone_response_to_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      cone_response_to_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_lms" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      construct_matrix_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.display_spectrum_response" class="md-nav__link">
    <span class="md-ellipsis">
      display_spectrum_response
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_cones_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_cones_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_random_spectrum_normalized" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_random_spectrum_normalized
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_rgb_backlight_spectrum" class="md-nav__link">
    <span class="md-ellipsis">
      initialize_rgb_backlight_spectrum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.lms_to_primaries" class="md-nav__link">
    <span class="md-ellipsis">
      lms_to_primaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.primaries_to_lms" class="md-nav__link">
    <span class="md-ellipsis">
      primaries_to_lms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.display_color_hvs.second_to_third_stage" class="md-nav__link">
    <span class="md-ellipsis">
      second_to_third_stage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.color_map" class="md-nav__link">
    <span class="md-ellipsis">
      color_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.hsv_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      hsv_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.lab_to_srgb" class="md-nav__link">
    <span class="md-ellipsis">
      lab_to_srgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.linear_rgb_to_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.linear_rgb_to_xyz" class="md-nav__link">
    <span class="md-ellipsis">
      linear_rgb_to_xyz
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_2_ycrcb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_2_ycrcb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_to_hsv" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_hsv
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.rgb_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      rgb_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.srgb_to_lab" class="md-nav__link">
    <span class="md-ellipsis">
      srgb_to_lab
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.xyz_to_linear_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      xyz_to_linear_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.color_conversion.ycrcb_2_rgb" class="md-nav__link">
    <span class="md-ellipsis">
      ycrcb_2_rgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation" class="md-nav__link">
    <span class="md-ellipsis">
      foveation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_3d_location_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_3d_location_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_eccentricity_distance_maps" class="md-nav__link">
    <span class="md-ellipsis">
      make_eccentricity_distance_maps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_equi_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_pooling_size_map_lod" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_lod
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_pooling_size_map_pixels" class="md-nav__link">
    <span class="md-ellipsis">
      make_pooling_size_map_pixels
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.foveation.make_radial_map" class="md-nav__link">
    <span class="md-ellipsis">
      make_radial_map
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses" class="md-nav__link">
    <span class="md-ellipsis">
      image_quality_losses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.MSSSIM" class="md-nav__link">
    <span class="md-ellipsis">
      MSSSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MSSSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.MSSSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.PSNR" class="md-nav__link">
    <span class="md-ellipsis">
      PSNR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PSNR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.PSNR.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.SSIM" class="md-nav__link">
    <span class="md-ellipsis">
      SSIM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSIM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.image_quality_losses.SSIM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses" class="md-nav__link">
    <span class="md-ellipsis">
      learned_perceptual_losses
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      CVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP" class="md-nav__link">
    <span class="md-ellipsis">
      FVVDP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FVVDP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS" class="md-nav__link">
    <span class="md-ellipsis">
      LPIPS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LPIPS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss" class="md-nav__link">
    <span class="md-ellipsis">
      metameric_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss.MetamericLoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform" class="md-nav__link">
    <span class="md-ellipsis">
      metameric_loss_uniform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform" class="md-nav__link">
    <span class="md-ellipsis">
      MetamericLossUniform
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamericLossUniform">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss" class="md-nav__link">
    <span class="md-ellipsis">
      metamer_mse_loss
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss" class="md-nav__link">
    <span class="md-ellipsis">
      MetamerMSELoss
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetamerMSELoss">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__call__" class="md-nav__link">
    <span class="md-ellipsis">
      __call__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.gen_metamer" class="md-nav__link">
    <span class="md-ellipsis">
      gen_metamer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur" class="md-nav__link">
    <span class="md-ellipsis">
      radially_varying_blur
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur" class="md-nav__link">
    <span class="md-ellipsis">
      RadiallyVaryingBlur
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RadiallyVaryingBlur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur.blur" class="md-nav__link">
    <span class="md-ellipsis">
      blur
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_steerable_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid" class="md-nav__link">
    <span class="md-ellipsis">
      SpatialSteerablePyramid
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SpatialSteerablePyramid">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.construct_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      construct_pyramid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.reconstruct_from_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct_from_pyramid
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.spatial_steerable_pyramid.pad_image_for_pyramid" class="md-nav__link">
    <span class="md-ellipsis">
      pad_image_for_pyramid
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters.crop_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      crop_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.steerable_pyramid_filters.get_steerable_pyramid_filters" class="md-nav__link">
    <span class="md-ellipsis">
      get_steerable_pyramid_filters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.util" class="md-nav__link">
    <span class="md-ellipsis">
      util
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.perception.util.slice_rgbd_targets" class="md-nav__link">
    <span class="md-ellipsis">
      slice_rgbd_targets
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>odak.learn.perception</h1>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception"></a>
    <div class="doc doc-contents first">

        <p><code>odak.learn.perception</code></p>
<p>Defines a number of different perceptual loss functions, which can be used to optimise images where gaze location is known.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.BlurLoss" class="doc doc-heading">
            <code>BlurLoss</code>


<a href="#odak.learn.perception.BlurLoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p><code>BlurLoss</code> implements two different blur losses. When <code>blur_source</code> is set to <code>False</code>, it implements blur_match, trying to match the input image to the blurred target image. This tries to match the source input image to a blurred version of the target.</p>
<p>When <code>blur_source</code> is set to <code>True</code>, it implements blur_lowpass, matching the blurred version of the input image to the blurred target image. This tries to match only the low frequencies of the source input image to the low frequencies of the target.</p>
<p>The interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">BlurLoss</span><span class="p">():</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    `BlurLoss` implements two different blur losses. When `blur_source` is set to `False`, it implements blur_match, trying to match the input image to the blurred target image. This tries to match the source input image to a blurred version of the target.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    When `blur_source` is set to `True`, it implements blur_lowpass, matching the blurred version of the input image to the blurred target image. This tries to match only the low frequencies of the source input image to the low frequencies of the target.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    The interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        ----------</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        blur_source             : bool</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    If true, blurs the source image as well as the target before computing the loss.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        """</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span> <span class="o">=</span> <span class="n">blur_source</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">blur_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="n">RadiallyVaryingBlur</span><span class="p">()</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Calculates the Blur Loss.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        gaze                : list</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Returns</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        -------</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        """</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"BlurLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">blurred_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">blurred_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">blurred_image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.BlurLoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></code>

<a href="#odak.learn.perception.BlurLoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Blur Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Calculates the Blur Loss.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    gaze                : list</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Returns</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    -------</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    """</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"BlurLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">blurred_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">blurred_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">blurred_image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.BlurLoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.BlurLoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>blur_source</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, blurs the source image as well as the target before computing the loss.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    ----------</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    blur_source             : bool</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                If true, blurs the source image as well as the target before computing the loss.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    """</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span> <span class="o">=</span> <span class="n">blur_source</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.CVVDP" class="doc doc-heading">
            <code>CVVDP</code>


<a href="#odak.learn.perception.CVVDP" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">CVVDP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        Initializes the CVVDP model with a specified device.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        ----------</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        device   : torch.device</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">                    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">CVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">pycvvdp</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span> <span class="o">=</span> <span class="n">pycvvdp</span><span class="o">.</span><span class="n">cvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP is missing, consider installing by running "pip install -U git+https://github.com/gfxdisp/ColorVideoVDP"'</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        targets    h  : torch.tensor</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        dim_order     : str</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Returns</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        -------</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                        The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        """</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">l_ColorVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="k">return</span> <span class="n">l_ColorVideoVDP</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.CVVDP.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.CVVDP.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the CVVDP model with a specified device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Initializes the CVVDP model with a specified device.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    ----------</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    device   : torch.device</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">                The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">CVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">pycvvdp</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span> <span class="o">=</span> <span class="n">pycvvdp</span><span class="o">.</span><span class="n">cvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP is missing, consider installing by running "pip install -U git+https://github.com/gfxdisp/ColorVideoVDP"'</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.CVVDP.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span><span class="o">=</span><span class="s1">'BCHW'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.CVVDP.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dim_order</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    targets    h  : torch.tensor</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    dim_order     : str</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                    The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    -------</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                    The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    """</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">l_ColorVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">return</span> <span class="n">l_ColorVideoVDP</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.FVVDP" class="doc doc-heading">
            <code>FVVDP</code>


<a href="#odak.learn.perception.FVVDP" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">FVVDP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Initializes the FVVDP model with a specified device.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        ----------</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        device   : torch.device</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        """</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">FVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">pyfvvdp</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span> <span class="o">=</span> <span class="n">pyfvvdp</span><span class="o">.</span><span class="n">fvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">heatmap</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP is missing, consider installing by running "pip install pyfvvdp"'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        ----------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        dim_order     : str</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Returns</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        -------</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                          The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        """</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">l_FovVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">return</span> <span class="n">l_FovVideoVDP</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.FVVDP.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.FVVDP.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the FVVDP model with a specified device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Initializes the FVVDP model with a specified device.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    ----------</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    device   : torch.device</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    """</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">FVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">pyfvvdp</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span> <span class="o">=</span> <span class="n">pyfvvdp</span><span class="o">.</span><span class="n">fvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">heatmap</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP is missing, consider installing by running "pip install pyfvvdp"'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.FVVDP.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span><span class="o">=</span><span class="s1">'BCHW'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.FVVDP.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dim_order</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    ----------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    dim_order     : str</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                    The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Returns</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    -------</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                      The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    """</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">l_FovVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">return</span> <span class="n">l_FovVideoVDP</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.LPIPS" class="doc doc-heading">
            <code>LPIPS</code>


<a href="#odak.learn.perception.LPIPS" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">class</span><span class="w"> </span><span class="nc">LPIPS</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">LPIPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">torchmetrics</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span> <span class="o">=</span> <span class="n">torchmetrics</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">lpip</span><span class="o">.</span><span class="n">LearnedPerceptualImagePatchSimilarity</span><span class="p">(</span><span class="n">net_type</span> <span class="o">=</span> <span class="s1">'squeeze'</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'torchmetrics is missing, consider installing by running "pip install torchmetrics"'</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        ----------</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Returns</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        -------</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                        The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        """</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">predictions</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">targets</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_image</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_target</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">l_LPIPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span><span class="p">(</span><span class="n">lpips_image</span><span class="p">,</span> <span class="n">lpips_target</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">return</span> <span class="n">l_LPIPS</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'LPIPS failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.LPIPS.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

<a href="#odak.learn.perception.LPIPS.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</p>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">LPIPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">torchmetrics</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span> <span class="o">=</span> <span class="n">torchmetrics</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">lpip</span><span class="o">.</span><span class="n">LearnedPerceptualImagePatchSimilarity</span><span class="p">(</span><span class="n">net_type</span> <span class="o">=</span> <span class="s1">'squeeze'</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'torchmetrics is missing, consider installing by running "pip install torchmetrics"'</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.LPIPS.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.LPIPS.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    ----------</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Returns</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    -------</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                    The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    """</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">predictions</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">targets</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">if</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">lpips_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_image</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">lpips_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_target</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">l_LPIPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span><span class="p">(</span><span class="n">lpips_image</span><span class="p">,</span> <span class="n">lpips_target</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">return</span> <span class="n">l_LPIPS</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'LPIPS failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.MSSSIM" class="doc doc-heading">
            <code>MSSSIM</code>


<a href="#odak.learn.perception.MSSSIM" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate multi-scale structural similarity index of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">class</span><span class="w"> </span><span class="nc">MSSSIM</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    A class to calculate multi-scale structural similarity index of an image with respect to a ground truth image.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    '''</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">MSSSIM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        ----------</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        predictions : torch.tensor</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                      The predicted images.</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        targets     : torch.tensor</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                      The ground truth images.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Returns</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        -------</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        result      : torch.tensor </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                      The computed MS-SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        """</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">multiscale_structural_similarity_index_measure</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">l_MSSSIM</span> <span class="o">=</span> <span class="n">multiscale_structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_range</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">return</span> <span class="n">l_MSSSIM</span>  
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'MS-SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MSSSIM.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MSSSIM.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
              (<code><span title="torch.tensor">tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed MS-SSIM value if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    ----------</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    predictions : torch.tensor</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                  The predicted images.</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    targets     : torch.tensor</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                  The ground truth images.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    Returns</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    -------</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    result      : torch.tensor </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                  The computed MS-SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    """</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">multiscale_structural_similarity_index_measure</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">l_MSSSIM</span> <span class="o">=</span> <span class="n">multiscale_structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_range</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="n">l_MSSSIM</span>  
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'MS-SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.MetamerMSELoss" class="doc doc-heading">
            <code>MetamerMSELoss</code>


<a href="#odak.learn.perception.MetamerMSELoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>MetamerMSELoss</code> class provides a perceptual loss function. This generates a metamer for the target image, and then optimises the source image to be the same as this target image metamer.</p>
<p>Please note this is different to <code>MetamericLoss</code> which optimises the source image to be any metamer of the target image.</p>
<p>Its interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamerMSELoss</span><span class="p">():</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    The `MetamerMSELoss` class provides a perceptual loss function. This generates a metamer for the target image, and then optimises the source image to be the same as this target image metamer.</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Please note this is different to `MetamericLoss` which optimises the source image to be any metamer of the target image.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Its interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    """</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    too high will slow down the calculation a lot.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                    Increasing this will increase runtime.</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        """</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="n">MetamericLoss</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                            <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="n">n_pyramid_levels</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        gaze    : list</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Returns</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        -------</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        metamer : torch.tensor</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                The generated metamer image</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        """</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                    <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">return</span> <span class="n">metamer</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Calculates the Metamer MSE Loss.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        ----------</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                  Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        target  : torch.tensor</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                  Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        gaze    : list</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                   Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Returns</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        -------</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        loss    : torch.tensor</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">                  The computed loss.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        """</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamerMSELoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_metamer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamerMSELoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></code>

<a href="#odak.learn.perception.MetamerMSELoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metamer MSE Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>   Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Calculates the Metamer MSE Loss.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    ----------</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">              Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    target  : torch.tensor</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">              Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    gaze    : list</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">               Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    -------</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    loss    : torch.tensor</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">              The computed loss.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    """</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamerMSELoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_metamer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamerMSELoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamerMSELoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of levels of the steerable pyramid. Note that the image is padded
                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                    too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                    Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                too high will slow down the calculation a lot.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                Increasing this will increase runtime.</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    """</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="n">MetamericLoss</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                        <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="n">n_pyramid_levels</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamerMSELoss.gen_metamer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_metamer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamerMSELoss.gen_metamer" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Generates a metamer for an image, following the method in <a href="https://dl.acm.org/doi/abs/10.1145/3450626.3459943">this paper</a>
This function can be used on its own to generate a metamer for a desired image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>metamer</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The generated metamer image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    gaze    : list</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    -------</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    metamer : torch.tensor</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            The generated metamer image</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    """</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">return</span> <span class="n">metamer</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.MetamericLoss" class="doc doc-heading">
            <code>MetamericLoss</code>


<a href="#odak.learn.perception.MetamericLoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>MetamericLoss</code> class provides a perceptual loss function.</p>
<p>Rather than exactly match the source image to the target, it tries to ensure the source is a <em>metamer</em> to the target image.</p>
<p>Its interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamericLoss</span><span class="p">():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    The `MetamericLoss` class provides a perceptual loss function.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    Rather than exactly match the source image to the target, it tries to ensure the source is a *metamer* to the target image.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Its interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    """</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>                 <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>                 <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        ----------</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                    Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    too high will slow down the calculation a lot.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    Increasing this will increase runtime.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        use_l2_foveal_loss      : bool </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    If true, for all the pixels that have pooling size 1 pixel in the </span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                    largest scale will use direct L2 against target rather than pooling over pyramid levels.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                                    In practice this gives better results when the loss is used for holography.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        fovea_weight            : float </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    A weight to apply to the foveal region if use_l2_foveal_loss is set to True.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        use_radial_weight       : bool </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    If True, will apply a radial weighting when calculating the difference between</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                                    the source and target stats maps. This weights stats closer to the fovea more than those</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                    further away.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        use_fullres_l0          : bool </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                    If true, stats for the lowpass residual are replaced with blurred versions</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                    of the full-resolution source and target images.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        """</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span> <span class="o">=</span> <span class="n">use_l2_foveal_loss</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">=</span> <span class="n">fovea_weight</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span> <span class="o">=</span> <span class="n">use_radial_weight</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="o">=</span> <span class="n">use_fullres_l0</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="s2">"Can't use use_fullres_l0 and use_l2_foveal_loss options together in MetamericLoss!"</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>                       <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">or</span> \
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="ow">or</span>\
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">filt_h0</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="n">SpatialSteerablePyramid</span><span class="p">(</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"cropped"</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="p">[</span><span class="n">RadiallyVaryingBlur</span><span class="p">()</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)]</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">find_stats</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">blur</span><span class="p">):</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">image_means</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">image_meansq</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="o">*</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                                     <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">image_vars</span> <span class="o">=</span> <span class="n">image_meansq</span> <span class="o">-</span> <span class="p">(</span><span class="n">image_means</span><span class="o">*</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">image_vars</span><span class="p">[</span><span class="n">image_vars</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">image_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">image_vars</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_means</span><span class="p">)):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image means!"</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_std</span><span class="p">)):</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_std</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image stdevs!"</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span><span class="p">:</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">if</span> <span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">matte</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="n">matte</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">return</span> <span class="n">image_means</span> <span class="o">*</span> <span class="n">matte</span><span class="p">,</span> <span class="n">image_std</span> <span class="o">*</span> <span class="n">matte</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">return</span> <span class="n">image_means</span><span class="p">,</span> <span class="n">image_std</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">output_stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">image_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">base_mask</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span><span class="p">))</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">base_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span> <span class="o">=</span> <span class="n">base_mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="c1">#self.fovea_mask     = torch.nn.functional.interpolate(self.fovea_mask, scale_factor=0.125, mode="area")</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="c1">#self.fovea_mask     = torch.nn.functional.interpolate(self.fovea_mask, size=(image.size(-2), image.size(-1)), mode="bilinear")</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">periphery_mask</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">periphery_mask</span> <span class="o">=</span> <span class="n">periphery_mask</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">periphery_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="n">periphery_mask</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span><span class="p">:</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="n">output_stats</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metameric_loss_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span><span class="p">:</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">radii</span> <span class="o">=</span> <span class="n">make_radial_map</span><span class="p">(</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">gaze</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="o">-</span> <span class="p">(</span><span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span><span class="p">)</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">weights</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">weights</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">loss</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualise_loss_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_stats</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">loss_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,)</span> <span class="o">+</span> <span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">stats</span> <span class="o">-</span> <span class="n">target_stats</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">stat_mse_map</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">loss_map</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">loss_map</span> <span class="o">+=</span> <span class="n">stat_mse_map</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_map</span> <span class="o">=</span> <span class="n">loss_map</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Calculates the Metameric Loss.</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        ----------</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        image_colorspace    : str</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">                                The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                                accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        gaze                : list</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">                                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        visualise_loss      : bool</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">                                Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        Returns</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        -------</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        """</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">target</span><span class="p">,</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="p">)</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">peripheral_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">foveal_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="c1"># New weighting - evenly weight fovea and periphery.</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">peripheral_loss</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">*</span> <span class="n">foveal_loss</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamericLoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s1">'RGB'</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamericLoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metameric Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_colorspace</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The current colorspace of your image and target. Ignored if input does not have 3 channels.
                accepted values: RGB, YCrCb.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>visualise_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Shows a heatmap indicating which parts of the image contributed most to the loss.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Calculates the Metameric Loss.</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    ----------</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    image_colorspace    : str</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">                            The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                            accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    gaze                : list</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">                            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    visualise_loss      : bool</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">                            Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    Returns</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    -------</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    """</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">target</span><span class="p">,</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="p">)</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">peripheral_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">foveal_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1"># New weighting - evenly weight fovea and periphery.</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">peripheral_loss</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">*</span> <span class="n">foveal_loss</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">return</span> <span class="n">loss</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamericLoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamericLoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of levels of the steerable pyramid. Note that the image is padded
                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                    too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                    Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_l2_foveal_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, for all the pixels that have pooling size 1 pixel in the 
                    largest scale will use direct L2 against target rather than pooling over pyramid levels.
                    In practice this gives better results when the loss is used for holography.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>fovea_weight</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    A weight to apply to the foveal region if use_l2_foveal_loss is set to True.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_radial_weight</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If True, will apply a radial weighting when calculating the difference between
                    the source and target stats maps. This weights stats closer to the fovea more than those
                    further away.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_fullres_l0</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, stats for the lowpass residual are replaced with blurred versions
                    of the full-resolution source and target images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>             <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>             <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    ----------</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                too high will slow down the calculation a lot.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                Increasing this will increase runtime.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    use_l2_foveal_loss      : bool </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                If true, for all the pixels that have pooling size 1 pixel in the </span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                largest scale will use direct L2 against target rather than pooling over pyramid levels.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                                In practice this gives better results when the loss is used for holography.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    fovea_weight            : float </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                A weight to apply to the foveal region if use_l2_foveal_loss is set to True.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    use_radial_weight       : bool </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                If True, will apply a radial weighting when calculating the difference between</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                                the source and target stats maps. This weights stats closer to the fovea more than those</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                further away.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    use_fullres_l0          : bool </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                If true, stats for the lowpass residual are replaced with blurred versions</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                of the full-resolution source and target images.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    """</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span> <span class="o">=</span> <span class="n">use_l2_foveal_loss</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">=</span> <span class="n">fovea_weight</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span> <span class="o">=</span> <span class="n">use_radial_weight</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="o">=</span> <span class="n">use_fullres_l0</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="s2">"Can't use use_fullres_l0 and use_l2_foveal_loss options together in MetamericLoss!"</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.MetamericLossUniform" class="doc doc-heading">
            <code>MetamericLossUniform</code>


<a href="#odak.learn.perception.MetamericLossUniform" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>Measures metameric loss between a given image and a metamer of the given target image.
This variant of the metameric loss is not foveated - it applies uniform pooling sizes to the whole input image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamericLossUniform</span><span class="p">():</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Measures metameric loss between a given image and a metamer of the given target image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    This variant of the metameric loss is not foveated - it applies uniform pooling sizes to the whole input image.</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    """</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        pooling_size            : int</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                  Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                  Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                  so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                  too high will slow down the calculation a lot.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                  Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                  Increasing this will increase runtime.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        """</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">):</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">or</span> \
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="ow">or</span>\
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">filt_h0</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="n">SpatialSteerablePyramid</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"cropped"</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">find_stats</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">image_means</span> <span class="o">=</span> <span class="n">uniform_blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="n">image_meansq</span> <span class="o">=</span> <span class="n">uniform_blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="o">*</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="n">image_vars</span> <span class="o">=</span> <span class="n">image_meansq</span> <span class="o">-</span> <span class="p">(</span><span class="n">image_means</span><span class="o">*</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">image_vars</span><span class="p">[</span><span class="n">image_vars</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="n">image_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">image_vars</span><span class="p">)</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_means</span><span class="p">)):</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image means!"</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_std</span><span class="p">)):</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_std</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image stdevs!"</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="k">return</span> <span class="n">image_means</span><span class="p">,</span> <span class="n">image_std</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">output_stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">image_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">curr_pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">],</span> <span class="n">curr_pooling_size</span><span class="p">)</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>                    <span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">curr_pooling_size</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">curr_pooling_size</span> <span class="o">/=</span> <span class="mi">2</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="n">output_stats</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metameric_loss_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">loss</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">)</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualise_loss_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_stats</span><span class="p">):</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">loss_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)):</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">stats</span> <span class="o">-</span> <span class="n">target_stats</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">stat_mse_map</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">loss_map</span><span class="o">.</span><span class="n">size</span><span class="p">(</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">loss_map</span> <span class="o">+=</span> <span class="n">stat_mse_map</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_map</span> <span class="o">=</span> <span class="n">loss_map</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        Calculates the Metameric Loss.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        ----------</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        image_colorspace    : str</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                                The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                                accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        visualise_loss      : bool</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                                Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Returns</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        -------</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLossUniform"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)):</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Target of incorrect type"</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                  Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Returns</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        -------</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        metamer : torch.tensor</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">                  The generated metamer image</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        """</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                    <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">return</span> <span class="n">metamer</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamericLossUniform.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s1">'RGB'</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamericLossUniform.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metameric Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_colorspace</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The current colorspace of your image and target. Ignored if input does not have 3 channels.
                accepted values: RGB, YCrCb.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>visualise_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Shows a heatmap indicating which parts of the image contributed most to the loss.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Calculates the Metameric Loss.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    ----------</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    image_colorspace    : str</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                            The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                            accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    visualise_loss      : bool</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                            Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Returns</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    -------</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLossUniform"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)):</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Target of incorrect type"</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamericLossUniform.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamericLossUniform.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>pooling_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Number of levels of the steerable pyramid. Note that the image is padded
                  so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                  too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                  Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    pooling_size            : int</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                              Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                              Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                              so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                              too high will slow down the calculation a lot.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                              Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                              Increasing this will increase runtime.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    """</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.MetamericLossUniform.gen_metamer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_metamer</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.MetamericLossUniform.gen_metamer" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Generates a metamer for an image, following the method in <a href="https://dl.acm.org/doi/abs/10.1145/3450626.3459943">this paper</a>
This function can be used on its own to generate a metamer for a desired image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>metamer</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The generated metamer image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">              Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    Returns</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    -------</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    metamer : torch.tensor</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">              The generated metamer image</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    """</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">return</span> <span class="n">metamer</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.PSNR" class="doc doc-heading">
            <code>PSNR</code>


<a href="#odak.learn.perception.PSNR" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">PSNR</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    A class to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    '''</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">PSNR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        ----------</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                        Image to be tested.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                        Ground truth image.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        peak_value    : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                        Peak value that given tensors could have.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Returns</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        -------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                        Peak-signal-to-noise ratio.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        """</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">mse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">targets</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">peak_value</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.PSNR.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#odak.learn.perception.PSNR.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Image to be tested.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Ground truth image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>peak_value</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Peak value that given tensors could have.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Peak-signal-to-noise ratio.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    ----------</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                    Image to be tested.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                    Ground truth image.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    peak_value    : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                    Peak value that given tensors could have.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Returns</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    -------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                    Peak-signal-to-noise ratio.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    """</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">targets</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">peak_value</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.RadiallyVaryingBlur" class="doc doc-heading">
            <code>RadiallyVaryingBlur</code>


<a href="#odak.learn.perception.RadiallyVaryingBlur" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>RadiallyVaryingBlur</code> class provides a way to apply a radially varying blur to an image. Given a gaze location and information about the image and foveation, it applies a blur that will achieve the proper pooling size. The pooling size is chosen to appear the same at a range of display sizes and viewing distances, for a given <code>alpha</code> parameter value. For more information on how the pooling sizes are computed, please see <a href="">link coming soon</a>.</p>
<p>The blur is accelerated by generating and sampling from MIP maps of the input image.</p>
<p>This class caches the foveation information. This means that if it is run repeatedly with the same foveation parameters, gaze location and image size (e.g. in an optimisation loop) it won't recalculate the pooling maps.</p>
<p>If you are repeatedly applying blur to images of different sizes (e.g. a pyramid) for best performance use one instance of this class per image size.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/radially_varying_blur.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">RadiallyVaryingBlur</span><span class="p">():</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    The `RadiallyVaryingBlur` class provides a way to apply a radially varying blur to an image. Given a gaze location and information about the image and foveation, it applies a blur that will achieve the proper pooling size. The pooling size is chosen to appear the same at a range of display sizes and viewing distances, for a given `alpha` parameter value. For more information on how the pooling sizes are computed, please see [link coming soon]().</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    The blur is accelerated by generating and sampling from MIP maps of the input image.</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    This class caches the foveation information. This means that if it is run repeatedly with the same foveation parameters, gaze location and image size (e.g. in an optimisation loop) it won't recalculate the pooling maps.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    If you are repeatedly applying blur to images of different sizes (e.g. a pyramid) for best performance use one instance of this class per image size.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    """</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">blur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Apply the radially varying blur to an image.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        image                   : torch.tensor</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The image to blur, in NCHW format.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                    Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        centre                  : tuple of floats</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                                    The centre of the radially varying blur (the gaze location).</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    Should be a tuple of floats containing normalised image coordinates in range [0,1]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                    If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                    The centre argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Returns</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        -------</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        output                  : torch.tensor</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                    The blurred image</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="c1"># LOD map caching</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>\
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">size</span> <span class="ow">or</span>\
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>\
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="n">alpha</span> <span class="ow">or</span>\
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">!=</span> <span class="n">real_image_width</span> <span class="ow">or</span>\
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">!=</span> <span class="n">real_viewing_distance</span> <span class="ow">or</span>\
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">!=</span> <span class="n">centre</span> <span class="ow">or</span>\
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span> <span class="ow">or</span>\
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">!=</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                    <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">mipmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">while</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="k">for</span> <span class="n">l2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                    <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                        <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="n">blended_levels</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="n">blended_levels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                    <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">*</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">output</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">blended_levels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">return</span> <span class="n">output</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.RadiallyVaryingBlur.blur" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">blur</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.RadiallyVaryingBlur.blur" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Apply the radially varying blur to an image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The image to blur, in NCHW format.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
                    Ignored in equirectangular mode (equi==True)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
                    Ignored in equirectangular mode (equi==True)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>centre</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The centre of the radially varying blur (the gaze location).
                    Should be a tuple of floats containing normalised image coordinates in range [0,1]
                    In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The centre argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>output</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The blurred image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/radially_varying_blur.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">blur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Apply the radially varying blur to an image.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    image                   : torch.tensor</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The image to blur, in NCHW format.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    centre                  : tuple of floats</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                                The centre of the radially varying blur (the gaze location).</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                Should be a tuple of floats containing normalised image coordinates in range [0,1]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                The centre argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Returns</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    -------</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    output                  : torch.tensor</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                The blurred image</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># LOD map caching</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>\
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">size</span> <span class="ow">or</span>\
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>\
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="n">alpha</span> <span class="ow">or</span>\
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">!=</span> <span class="n">real_image_width</span> <span class="ow">or</span>\
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">!=</span> <span class="n">real_viewing_distance</span> <span class="ow">or</span>\
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">!=</span> <span class="n">centre</span> <span class="ow">or</span>\
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span> <span class="ow">or</span>\
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">!=</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">mipmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">while</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">for</span> <span class="n">l2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                    <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">blended_levels</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">blended_levels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">*</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">output</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">blended_levels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">output</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.SSIM" class="doc doc-heading">
            <code>SSIM</code>


<a href="#odak.learn.perception.SSIM" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate structural similarity index of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">class</span><span class="w"> </span><span class="nc">SSIM</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    A class to calculate structural similarity index of an image with respect to a ground truth image.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    '''</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SSIM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        ----------</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        predictions : torch.tensor</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                      The predicted images.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        targets     : torch.tensor</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                      The ground truth images.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Returns</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        -------</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        result      : torch.tensor </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                      The computed SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        """</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">structural_similarity_index_measure</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">l_SSIM</span> <span class="o">=</span> <span class="n">structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">return</span> <span class="n">l_SSIM</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.SSIM.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.SSIM.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
              (<code><span title="torch.tensor">tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed SSIM value if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    ----------</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    predictions : torch.tensor</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                  The predicted images.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    targets     : torch.tensor</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                  The ground truth images.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    -------</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    result      : torch.tensor </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                  The computed SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    """</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">structural_similarity_index_measure</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">l_SSIM</span> <span class="o">=</span> <span class="n">structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="n">l_SSIM</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.SpatialSteerablePyramid" class="doc doc-heading">
            <code>SpatialSteerablePyramid</code>


<a href="#odak.learn.perception.SpatialSteerablePyramid" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>This implements a real-valued steerable pyramid where the filtering is carried out spatially (using convolution)
as opposed to multiplication in the Fourier domain.
This has a number of optimisations over previous implementations that increase efficiency, but introduce some
reconstruction error.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpatialSteerablePyramid</span><span class="p">():</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    This implements a real-valued steerable pyramid where the filtering is carried out spatially (using convolution)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    as opposed to multiplication in the Fourier domain.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    This has a number of optimisations over previous implementations that increase efficiency, but introduce some</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    reconstruction error.</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    """</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>                 <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                 <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        ----------</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        use_bilinear_downup     : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                    This uses bilinear filtering when upsampling/downsampling, rather than the original approach</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    of applying a large lowpass kernel and sampling even rows/columns</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        n_channels              : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    Number of channels in the input images (e.g. 3 for RGB input)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        filter_size             : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                    Desired size of filters (e.g. 3 will use 3x3 filters).</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        n_orientations          : int</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                    Number of oriented bands in each level of the pyramid.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        filter_type             : str</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                    This can be used to select smaller filters than the original ones if desired.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                    full: Original filter sizes</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                    cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                    trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        device                  : torch.device</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                                    torch device the input images will be supplied from.</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        """</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span> <span class="o">=</span> <span class="n">use_bilinear_downup</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">filters</span> <span class="o">=</span> <span class="n">get_steerable_pyramid_filters</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">filter_size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">make_pad</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">filter_size</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="n">pad_amt</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">((</span><span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">))</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">if</span> <span class="n">n_channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">add_channels_to_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">padded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                                     <span class="mi">2</span><span class="p">],</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="n">padded</span><span class="p">[</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="k">return</span> <span class="n">padded</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)):</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Constructs and returns a steerable pyramid for the provided image.</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        ----------</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                                The input image, in NCHW format. The number of channels C should match num_channels</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                                when the pyramid maker was created.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        n_levels            : int</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">                                Number of levels in the constructed steerable pyramid.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        multiple_highpass   : bool</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                                If true, computes a highpass for each level of the pyramid.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                                These extra levels are redundant (not used for reconstruction).</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Returns</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        -------</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        pyramid             : list of dicts of torch.tensor</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                                The computed steerable pyramid.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">                                Each level is stored as a dict, with the following keys:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                                "h" Highpass residual</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                                "l" Lowpass residual</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                                "b" Oriented bands (a list of torch.tensor)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        """</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">pyramid</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="c1"># Make level 0, containing highpass, lowpass and the bands</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">level0</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level0</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># Make intermediate levels</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_levels</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>                    <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">if</span> <span class="n">multiple_highpass</span><span class="p">:</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">level</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="c1"># Make final level (lowpass residual)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="k">return</span> <span class="n">pyramid</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_from_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyramid</span><span class="p">):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Reconstructs an input image from a steerable pyramid.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        ----------</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        pyramid : list of dicts of torch.tensor</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                    The steerable pyramid.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                    Should be in the same format as output by construct_steerable_pyramid().</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                    The number of channels should match num_channels when the pyramid maker was created.</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Returns</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        -------</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                    The reconstructed image, in NCHW format.         </span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        """</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                                    <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">zeros</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="k">return</span> <span class="n">zeros</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'l'</span><span class="p">]</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="n">b_filtered</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="n">b</span><span class="p">]),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">image</span> <span class="o">+=</span> <span class="n">b_filtered</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">image</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.SpatialSteerablePyramid.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s1">'full'</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.SpatialSteerablePyramid.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>use_bilinear_downup</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    This uses bilinear filtering when upsampling/downsampling, rather than the original approach
                    of applying a large lowpass kernel and sampling even rows/columns
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_channels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of channels in the input images (e.g. 3 for RGB input)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Desired size of filters (e.g. 3 will use 3x3 filters).
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of oriented bands in each level of the pyramid.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_type</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    This can be used to select smaller filters than the original ones if desired.
                    full: Original filter sizes
                    cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.
                    trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    torch device the input images will be supplied from.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>             <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>             <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    ----------</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    use_bilinear_downup     : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                This uses bilinear filtering when upsampling/downsampling, rather than the original approach</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                of applying a large lowpass kernel and sampling even rows/columns</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    n_channels              : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                Number of channels in the input images (e.g. 3 for RGB input)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    filter_size             : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                Desired size of filters (e.g. 3 will use 3x3 filters).</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    n_orientations          : int</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                Number of oriented bands in each level of the pyramid.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    filter_type             : str</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                This can be used to select smaller filters than the original ones if desired.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                full: Original filter sizes</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    device                  : torch.device</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                                torch device the input images will be supplied from.</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    """</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span> <span class="o">=</span> <span class="n">use_bilinear_downup</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">filters</span> <span class="o">=</span> <span class="n">get_steerable_pyramid_filters</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">filter_size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_pad</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">filter_size</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">pad_amt</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">((</span><span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">))</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">if</span> <span class="n">n_channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_channels_to_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">padded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                                 <span class="mi">2</span><span class="p">],</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">padded</span><span class="p">[</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">return</span> <span class="n">padded</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)):</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.SpatialSteerablePyramid.construct_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.SpatialSteerablePyramid.construct_pyramid" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Constructs and returns a steerable pyramid for the provided image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The input image, in NCHW format. The number of channels C should match num_channels
                when the pyramid maker was created.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Number of levels in the constructed steerable pyramid.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>multiple_highpass</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                If true, computes a highpass for each level of the pyramid.
                These extra levels are redundant (not used for reconstruction).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pyramid</code></b> (              <code>list of dicts of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The computed steerable pyramid.
Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.
Each level is stored as a dict, with the following keys:
"h" Highpass residual
"l" Lowpass residual
"b" Oriented bands (a list of torch.tensor)</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Constructs and returns a steerable pyramid for the provided image.</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    ----------</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                            The input image, in NCHW format. The number of channels C should match num_channels</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                            when the pyramid maker was created.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    n_levels            : int</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">                            Number of levels in the constructed steerable pyramid.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    multiple_highpass   : bool</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                            If true, computes a highpass for each level of the pyramid.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                            These extra levels are redundant (not used for reconstruction).</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Returns</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    -------</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    pyramid             : list of dicts of torch.tensor</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                            The computed steerable pyramid.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                            Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">                            Each level is stored as a dict, with the following keys:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                            "h" Highpass residual</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                            "l" Lowpass residual</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                            "b" Oriented bands (a list of torch.tensor)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    """</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">pyramid</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Make level 0, containing highpass, lowpass and the bands</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">level0</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level0</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># Make intermediate levels</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_levels</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">if</span> <span class="n">multiple_highpass</span><span class="p">:</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="c1"># Make final level (lowpass residual)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">return</span> <span class="n">pyramid</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.SpatialSteerablePyramid.reconstruct_from_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_from_pyramid</span><span class="p">(</span><span class="n">pyramid</span><span class="p">)</span></code>

<a href="#odak.learn.perception.SpatialSteerablePyramid.reconstruct_from_pyramid" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Reconstructs an input image from a steerable pyramid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>pyramid</code></b>
              (<code>list of dicts of torch.tensor</code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The steerable pyramid.
    Should be in the same format as output by construct_steerable_pyramid().
    The number of channels should match num_channels when the pyramid maker was created.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The reconstructed image, in NCHW format.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_from_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyramid</span><span class="p">):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Reconstructs an input image from a steerable pyramid.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    ----------</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    pyramid : list of dicts of torch.tensor</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                The steerable pyramid.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                Should be in the same format as output by construct_steerable_pyramid().</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                The number of channels should match num_channels when the pyramid maker was created.</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Returns</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    -------</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                The reconstructed image, in NCHW format.         </span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    """</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                                <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">zeros</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">return</span> <span class="n">zeros</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'l'</span><span class="p">]</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">b_filtered</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="n">b</span><span class="p">]),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">image</span> <span class="o">+=</span> <span class="n">b_filtered</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">image</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.display_color_hvs" class="doc doc-heading">
            <code>display_color_hvs</code>


<a href="#odak.learn.perception.display_color_hvs" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">display_color_hvs</span><span class="p">():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>                 <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>                 <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>                 <span class="n">distance_from_screen</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>                 <span class="n">pixel_pitch</span> <span class="o">=</span> <span class="mf">0.311</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>                 <span class="n">read_spectrum</span> <span class="o">=</span> <span class="s1">'tensor'</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>                 <span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>                 <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                <span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        resolution                  : list</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                      Resolution of the display in pixels.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        distance_from_screen        : int</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                      Distance from the screen in mm.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        pixel_pitch                 : float</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                      Pixel pitch of the display in mm.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        read_spectrum               : str</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                      Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        device                      : torch.device</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                      Device to run the code on. Default is None which means the code will run on CPU.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        '''</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">=</span> <span class="n">read_spectrum</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distance_from_screen</span> <span class="o">=</span> <span class="n">distance_from_screen</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_pitch</span> <span class="o">=</span> <span class="n">pixel_pitch</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_cones_normalized</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_lms</span><span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                                                   <span class="p">)</span>   
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_primaries</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                                               <span class="p">)</span>   
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">return</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Evaluating an input image against a target ground truth image for a given gaze of a viewer.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">lms_image_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">lms_ground_truth_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">lms_image_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image_second</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">lms_ground_truth_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_ground_truth_second</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">loss_metamer_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">lms_ground_truth_third</span> <span class="o">-</span> <span class="n">lms_image_third</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">return</span> <span class="n">loss_metamer_color</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_cones_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Returns</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        -------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        l_cone_n                     : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                       Normalised L cone distribution.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        m_cone_n                     : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                                       Normalised M cone distribution.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        s_cone_n                     : torch.tensor</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                                       Normalised S cone distribution.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        """</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">dist_l</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">32.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">567.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">32.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">dist_m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">27.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">545.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">27.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">dist_s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">17.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">447.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">17.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">l_cone_n</span> <span class="o">=</span> <span class="n">dist_l</span> <span class="o">/</span> <span class="n">dist_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">m_cone_n</span> <span class="o">=</span> <span class="n">dist_m</span> <span class="o">/</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">s_cone_n</span> <span class="o">=</span> <span class="n">dist_s</span> <span class="o">/</span> <span class="n">dist_s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">return</span> <span class="n">l_cone_n</span><span class="p">,</span> <span class="n">m_cone_n</span><span class="p">,</span> <span class="n">s_cone_n</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_rgb_backlight_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        Internal function to initialize baclight spectrum for color primaries. </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Returns</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        -------</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        red_spectrum                 : torch.tensor</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                                       Normalised backlight spectrum for red color primary.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        green_spectrum               : torch.tensor</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                                       Normalised backlight spectrum for green color primary.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        blue_spectrum                : torch.tensor</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                                       Normalised backlight spectrum for blue color primary.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">red_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">14.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">650</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">14.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">green_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">550</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">450</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">red_spectrum</span> <span class="o">=</span> <span class="n">red_spectrum</span> <span class="o">/</span> <span class="n">red_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">green_spectrum</span> <span class="o">=</span> <span class="n">green_spectrum</span> <span class="o">/</span> <span class="n">green_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="n">blue_spectrum</span> <span class="o">/</span> <span class="n">blue_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">return</span> <span class="n">red_spectrum</span><span class="p">,</span> <span class="n">green_spectrum</span><span class="p">,</span> <span class="n">blue_spectrum</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        ----------</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        dataset                                : torch.tensor </span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                                 spectrum value against wavelength </span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">x_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">301</span><span class="p">)</span> <span class="o">-</span> <span class="mi">550</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">y_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np_cpu</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">max_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">y_spectrum</span> <span class="o">/=</span> <span class="n">max_spectrum</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">centre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> \
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centre</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span> 
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">return</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">([</span><span class="n">weights</span><span class="p">],</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">line_search_fn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">closure</span><span class="p">():</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">spectrum</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Internal function to provide light spectrum response at particular wavelength</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        wavelength                          : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                                              Wavelength in nm [400...700]</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        function                            : torch.tensor</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                                              Display light spectrum distribution function</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Returns</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        -------</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        ligth_response_dict                  : float</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">                                               Display light spectrum response value</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        """</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">:</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="n">wavelength</span> <span class="o">-</span> <span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">elif</span> <span class="n">wavelength</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cone_response_to_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Internal function to calculate cone response at particular light spectrum. </span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        ----------</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        cone_spectrum                         : torch.tensor</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                                                Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        light_spectrum                        : torch.tensor</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">                                                Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        Returns</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        -------</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        response_to_spectrum                  : float</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">                                                Response of cone to light spectrum [1x1] </span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        """</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">response_to_spectrum</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">return</span> <span class="n">response_to_spectrum</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        ----------</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        l_response                             : torch.tensor</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        m_response                             : torch.tensor</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        s_response                             : torch.tensor</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        Returns</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        -------</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">                                                3x3 LMSrgb tensor</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        '''</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">m_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">s_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span>    
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        ----------</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        l_response                             : torch.tensor</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        m_response                             : torch.tensor</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        s_response                             : torch.tensor</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Returns</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        -------</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">                                                3x3 LMSrgb tensor</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        '''</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>                                                                         <span class="n">l_response</span><span class="p">,</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>                                                                        <span class="p">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                                                         <span class="n">m_response</span><span class="p">,</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                                                        <span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>                                                                         <span class="n">s_response</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                                                        <span class="p">)</span> 
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span>    
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">primaries_to_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaries</span><span class="p">):</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        Internal function to convert primaries space to LMS space </span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        ----------</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        primaries                              : torch.tensor</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">                                                 Primaries data to be transformed to LMS space [BxPHxW]</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        Returns</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        -------</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        lms_color                              : torch.tensor</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">                                                 LMS data transformed from Primaries space [BxPxHxW]</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        """</span>                
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">primaries_flatten</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">lms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">lms_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">primaries_flatten</span> <span class="o">*</span> <span class="n">lms</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">return</span> <span class="n">lms_color</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lms_to_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_color_tensor</span><span class="p">):</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        Internal function to convert LMS image to primaries space</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        ----------</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        lms_color_tensor                        : torch.tensor</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                                                  LMS data to be transformed to primaries space [Bx3xHxW]</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Returns</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        -------</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        primaries                              : torch.tensor</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                                               : Primaries data transformed from LMS space [BxPxHxW]</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        """</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">lms_color_tensor</span> <span class="o">=</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">lms_color_flatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">,</span> <span class="n">start_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unflatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">converted_unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">lms_color_flatten</span><span class="o">.</span><span class="n">double</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">pinverse</span><span class="p">()</span><span class="o">.</span><span class="n">double</span><span class="p">())</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">primaries</span> <span class="o">=</span> <span class="n">unflatten</span><span class="p">(</span><span class="n">converted_unflatten</span><span class="p">)</span>     
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">primaries</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">return</span> <span class="n">primaries</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">second_to_third_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_image</span><span class="p">):</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], </span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        ----------</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        lms_image                             : torch.tensor</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">                                                 Image data at LMS space (second stage)</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Returns</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        -------</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        third_stage                            : torch.tensor</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                                                 Image data at LMS space (third stage)</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        '''</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">third_stage</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">return</span> <span class="n">third_stage</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluating an input image against a target ground truth image for a given gaze of a viewer.</p>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Evaluating an input image against a target ground truth image for a given gaze of a viewer.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">lms_image_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">lms_ground_truth_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">lms_image_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image_second</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">lms_ground_truth_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_ground_truth_second</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">loss_metamer_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">lms_ground_truth_third</span> <span class="o">-</span> <span class="n">lms_image_third</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">return</span> <span class="n">loss_metamer_color</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span> <span class="n">distance_from_screen</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">pixel_pitch</span><span class="o">=</span><span class="mf">0.311</span><span class="p">,</span> <span class="n">read_spectrum</span><span class="o">=</span><span class="s1">'tensor'</span><span class="p">,</span> <span class="n">primaries_spectrum</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.display_color_hvs.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>resolution</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Resolution of the display in pixels.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>distance_from_screen</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Distance from the screen in mm.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>pixel_pitch</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Pixel pitch of the display in mm.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>read_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Device to run the code on. Default is None which means the code will run on CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>             <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>             <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>             <span class="n">distance_from_screen</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>             <span class="n">pixel_pitch</span> <span class="o">=</span> <span class="mf">0.311</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>             <span class="n">read_spectrum</span> <span class="o">=</span> <span class="s1">'tensor'</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>             <span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>             <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    resolution                  : list</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                  Resolution of the display in pixels.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    distance_from_screen        : int</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                  Distance from the screen in mm.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    pixel_pitch                 : float</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                  Pixel pitch of the display in mm.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    read_spectrum               : str</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                  Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    device                      : torch.device</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                  Device to run the code on. Default is None which means the code will run on CPU.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    '''</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">=</span> <span class="n">read_spectrum</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">distance_from_screen</span> <span class="o">=</span> <span class="n">distance_from_screen</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pixel_pitch</span> <span class="o">=</span> <span class="n">pixel_pitch</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_cones_normalized</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_lms</span><span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                                               <span class="p">)</span>   
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_primaries</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                                           <span class="p">)</span>   
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">return</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.cone_response_to_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.cone_response_to_spectrum" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>cone_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                Spectrum, Wavelength [2,300] tensor
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>light_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                Spectrum, Wavelength [2,300] tensor
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>response_to_spectrum</code></b> (              <code><span title="float">float</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Response of cone to light spectrum [1x1]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span><span class="w"> </span><span class="nf">cone_response_to_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Internal function to calculate cone response at particular light spectrum. </span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    ----------</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    cone_spectrum                         : torch.tensor</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                                            Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    light_spectrum                        : torch.tensor</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">                                            Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    Returns</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    -------</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    response_to_spectrum                  : float</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">                                            Response of cone to light spectrum [1x1] </span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    """</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">response_to_spectrum</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">response_to_spectrum</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.construct_matrix_lms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_matrix_lms</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.construct_matrix_lms" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone  response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>l_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>m_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>s_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_image_tensor</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>3x3 LMSrgb tensor</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    ----------</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    l_response                             : torch.tensor</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    m_response                             : torch.tensor</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    s_response                             : torch.tensor</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    Returns</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    -------</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">                                            3x3 LMSrgb tensor</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    '''</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">m_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">s_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.construct_matrix_primaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_matrix_primaries</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.construct_matrix_primaries" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone  response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>l_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>m_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>s_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_image_tensor</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>3x3 LMSrgb tensor</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    ----------</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    l_response                             : torch.tensor</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    m_response                             : torch.tensor</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    s_response                             : torch.tensor</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Returns</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    -------</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">                                            3x3 LMSrgb tensor</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    '''</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>                                                                     <span class="n">l_response</span><span class="p">,</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>                                                                    <span class="p">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                                                     <span class="n">m_response</span><span class="p">,</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                                                    <span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>                                                                     <span class="n">s_response</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                                                    <span class="p">)</span> 
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.display_spectrum_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.display_spectrum_response" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to provide light spectrum response at particular wavelength</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>wavelength</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                              Wavelength in nm [400...700]
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>function</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                              Display light spectrum distribution function
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ligth_response_dict</code></b> (              <code><span title="float">float</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Display light spectrum response value</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="k">def</span><span class="w"> </span><span class="nf">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Internal function to provide light spectrum response at particular wavelength</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    wavelength                          : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                                          Wavelength in nm [400...700]</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    function                            : torch.tensor</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                                          Display light spectrum distribution function</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Returns</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    -------</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    ligth_response_dict                  : float</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">                                           Display light spectrum response value</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    """</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">:</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="n">wavelength</span> <span class="o">-</span> <span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">elif</span> <span class="n">wavelength</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.initialize_cones_normalized" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_cones_normalized</span><span class="p">()</span></code>

<a href="#odak.learn.perception.display_color_hvs.initialize_cones_normalized" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>l_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised L cone distribution.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>m_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised M cone distribution.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>s_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised S cone distribution.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_cones_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Returns</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    -------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    l_cone_n                     : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                   Normalised L cone distribution.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    m_cone_n                     : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                                   Normalised M cone distribution.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    s_cone_n                     : torch.tensor</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                                   Normalised S cone distribution.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    """</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">dist_l</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">32.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">567.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">32.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">dist_m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">27.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">545.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">27.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">dist_s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">17.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">447.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">17.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">l_cone_n</span> <span class="o">=</span> <span class="n">dist_l</span> <span class="o">/</span> <span class="n">dist_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">m_cone_n</span> <span class="o">=</span> <span class="n">dist_m</span> <span class="o">/</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">s_cone_n</span> <span class="o">=</span> <span class="n">dist_s</span> <span class="o">/</span> <span class="n">dist_s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">l_cone_n</span><span class="p">,</span> <span class="n">m_cone_n</span><span class="p">,</span> <span class="n">s_cone_n</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.initialize_random_spectrum_normalized" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.initialize_random_spectrum_normalized" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>dataset</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 spectrum value against wavelength
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    ----------</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    dataset                                : torch.tensor </span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                             spectrum value against wavelength </span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">dataset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">x_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">301</span><span class="p">)</span> <span class="o">-</span> <span class="mi">550</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">y_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np_cpu</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">max_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">y_spectrum</span> <span class="o">/=</span> <span class="n">max_spectrum</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">centre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> \
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centre</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span> 
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">return</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">([</span><span class="n">weights</span><span class="p">],</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">line_search_fn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closure</span><span class="p">():</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.initialize_rgb_backlight_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_rgb_backlight_spectrum</span><span class="p">()</span></code>

<a href="#odak.learn.perception.display_color_hvs.initialize_rgb_backlight_spectrum" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to initialize baclight spectrum for color primaries. </p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>red_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for red color primary.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>green_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for green color primary.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>blue_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for blue color primary.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_rgb_backlight_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Internal function to initialize baclight spectrum for color primaries. </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Returns</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    -------</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    red_spectrum                 : torch.tensor</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                                   Normalised backlight spectrum for red color primary.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    green_spectrum               : torch.tensor</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                                   Normalised backlight spectrum for green color primary.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    blue_spectrum                : torch.tensor</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                                   Normalised backlight spectrum for blue color primary.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">red_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">14.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">650</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">14.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">green_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">550</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">450</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">red_spectrum</span> <span class="o">=</span> <span class="n">red_spectrum</span> <span class="o">/</span> <span class="n">red_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">green_spectrum</span> <span class="o">=</span> <span class="n">green_spectrum</span> <span class="o">/</span> <span class="n">green_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="n">blue_spectrum</span> <span class="o">/</span> <span class="n">blue_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">return</span> <span class="n">red_spectrum</span><span class="p">,</span> <span class="n">green_spectrum</span><span class="p">,</span> <span class="n">blue_spectrum</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.lms_to_primaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lms_to_primaries</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.lms_to_primaries" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to convert LMS image to primaries space</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>lms_color_tensor</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                  LMS data to be transformed to primaries space [Bx3xHxW]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>primaries</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>: Primaries data transformed from LMS space [BxPxHxW]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="k">def</span><span class="w"> </span><span class="nf">lms_to_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_color_tensor</span><span class="p">):</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    Internal function to convert LMS image to primaries space</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    ----------</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    lms_color_tensor                        : torch.tensor</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                                              LMS data to be transformed to primaries space [Bx3xHxW]</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    Returns</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    -------</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    primaries                              : torch.tensor</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                                           : Primaries data transformed from LMS space [BxPxHxW]</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    """</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">lms_color_tensor</span> <span class="o">=</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">lms_color_flatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">,</span> <span class="n">start_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unflatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">converted_unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">lms_color_flatten</span><span class="o">.</span><span class="n">double</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">pinverse</span><span class="p">()</span><span class="o">.</span><span class="n">double</span><span class="p">())</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">primaries</span> <span class="o">=</span> <span class="n">unflatten</span><span class="p">(</span><span class="n">converted_unflatten</span><span class="p">)</span>     
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">primaries</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">return</span> <span class="n">primaries</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.primaries_to_lms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">primaries</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.primaries_to_lms" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to convert primaries space to LMS space </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>primaries</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Primaries data to be transformed to LMS space [BxPHxW]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_color</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>LMS data transformed from Primaries space [BxPxHxW]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">primaries_to_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaries</span><span class="p">):</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    Internal function to convert primaries space to LMS space </span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    ----------</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    primaries                              : torch.tensor</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">                                             Primaries data to be transformed to LMS space [BxPHxW]</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    Returns</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    -------</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    lms_color                              : torch.tensor</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">                                             LMS data transformed from Primaries space [BxPxHxW]</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    """</span>                
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">primaries_flatten</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">lms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">lms_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">primaries_flatten</span> <span class="o">*</span> <span class="n">lms</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">return</span> <span class="n">lms_color</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.display_color_hvs.second_to_third_stage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.display_color_hvs.second_to_third_stage" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], 
See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>lms_image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Image data at LMS space (second stage)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>third_stage</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image data at LMS space (third stage)</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="k">def</span><span class="w"> </span><span class="nf">second_to_third_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_image</span><span class="p">):</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], </span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    ----------</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    lms_image                             : torch.tensor</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">                                             Image data at LMS space (second stage)</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Returns</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    -------</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    third_stage                            : torch.tensor</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                                             Image data at LMS space (third stage)</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    '''</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">third_stage</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">return</span> <span class="n">third_stage</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">color_map</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">target_image</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">'Lab Stats'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Internal function to map the color of an image to another image.
Reference: Color transfer between images, Reinhard et al., 2001.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>input_image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Input image in RGB color space [3 x m x n].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_image</code></b>
          â€“
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>mapped_image</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Input image with the color the distribution of the target image [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="k">def</span><span class="w"> </span><span class="nf">color_map</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">target_image</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">'Lab Stats'</span><span class="p">):</span>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    Internal function to map the color of an image to another image.</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    Reference: Color transfer between images, Reinhard et al., 2001.</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    ----------</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">    input_image         : torch.Tensor</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">                          Input image in RGB color space [3 x m x n].</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    target_image        : torch.Tensor</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    Returns</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    -------</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    mapped_image           : torch.Tensor</span>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">                             Input image with the color the distribution of the target image [3 x m x n].</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    """</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">'Lab Stats'</span><span class="p">:</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">lab_input</span> <span class="o">=</span> <span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="n">lab_target</span> <span class="o">=</span> <span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">target_image</span><span class="p">)</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="n">input_mean_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">input_mean_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">input_mean_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">input_std_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">input_std_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">input_std_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">target_mean_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">target_mean_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">target_mean_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">target_std_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="n">target_std_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">target_std_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_L</span> <span class="o">/</span> <span class="n">input_std_L</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_L</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_a</span> <span class="o">/</span> <span class="n">input_std_a</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_a</span>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_b</span> <span class="o">/</span> <span class="n">input_std_b</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_b</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="n">mapped_image</span> <span class="o">=</span> <span class="n">lab_to_srgb</span><span class="p">(</span><span class="n">lab_input</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="k">return</span> <span class="n">mapped_image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.crop_steerable_pyramid_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></code>

<a href="#odak.learn.perception.crop_steerable_pyramid_filters" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Given original 9x9 NYU filters, this crops them to the desired size.
The size must be an odd number &gt;= 3
Note this only crops the h0, l0 and band filters (not the l downsampling filter)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Filters to crop (should in format used by get_steerable_pyramid_filters.)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Size to crop to. For example, an input of 3 will crop the filters to a size of 3x3.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>filters</code></b> (              <code>dict of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The cropped filters.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/steerable_pyramid_filters.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Given original 9x9 NYU filters, this crops them to the desired size.</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    The size must be an odd number &gt;= 3</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Note this only crops the h0, l0 and band filters (not the l downsampling filter)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    ----------</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    filters     : dict of torch.tensor</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">                    Filters to crop (should in format used by get_steerable_pyramid_filters.)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    size        : int</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">                    Size to crop to. For example, an input of 3 will crop the filters to a size of 3x3.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    Returns</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    -------</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    filters     : dict of torch.tensor</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">                    The cropped filters.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    """</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">assert</span><span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">assert</span><span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="nb">filter</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">r2</span><span class="o">-</span><span class="n">r</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r2</span><span class="o">-</span><span class="n">r</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="k">if</span> <span class="n">normalise</span><span class="p">:</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="nb">filter</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="k">return</span> <span class="nb">filter</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">],</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">sum_l</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sum_l</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">sum_l0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">])</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sum_l0</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">])</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">return</span> <span class="n">filters</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.get_steerable_pyramid_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_steerable_pyramid_filters</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span></code>

<a href="#odak.learn.perception.get_steerable_pyramid_filters" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This returns filters for a real-valued steerable pyramid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            Width of the filters (e.g. 3 will return 3x3 filters)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            Number of oriented band filters
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_type</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            This can be used to select between the original NYU filters and cropped or trained alternatives.
            full: Original NYU filters from https://github.com/LabForComputationalVision/pyrtools/blob/master/pyrtools/pyramids/filters.py
            cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.
            trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>filters</code></b> (              <code>dict of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The steerable pyramid filters. Returned as a dict with the following keys:
"l" The lowpass downsampling filter
"l0" The lowpass residual filter
"h0" The highpass residual filter
"b" The band filters (a list of torch.tensor filters, one for each orientation).</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/steerable_pyramid_filters.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_steerable_pyramid_filters</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    This returns filters for a real-valued steerable pyramid.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    ----------</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    size            : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                        Width of the filters (e.g. 3 will return 3x3 filters)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    n_orientations  : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                        Number of oriented band filters</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    filter_type     :  str</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                        This can be used to select between the original NYU filters and cropped or trained alternatives.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                        full: Original NYU filters from https://github.com/LabForComputationalVision/pyrtools/blob/master/pyrtools/pyramids/filters.py</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                        cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                        trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    -------</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    filters         : dict of torch.tensor</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                        The steerable pyramid filters. Returned as a dict with the following keys:</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                        "l" The lowpass downsampling filter</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                        "l0" The lowpass residual filter</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                        "h0" The highpass residual filter</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">                        "b" The band filters (a list of torch.tensor filters, one for each orientation).</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    """</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"full"</span> <span class="ow">and</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"cropped"</span> <span class="ow">and</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"trained"</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="s2">"Unknown filter type </span><span class="si">%s</span><span class="s2">! Only filter types are full, cropped or trained."</span> <span class="o">%</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">if</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">],</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">],</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">],</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="p">[</span><span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">],</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">],</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">],</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.781600e-03</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span> <span class="mf">1.576508e-01</span><span class="p">,</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="mf">1.348999e-01</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">],</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">],</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">],</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="p">[</span><span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">],</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">],</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">],</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">]]</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">],</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">],</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">],</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.563200e-03</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span> <span class="mf">3.153017e-01</span><span class="p">,</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="mf">1.524935e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">],</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">],</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">],</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="p">[</span><span class="mf">5.997200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">5.997200e-04</span><span class="p">],</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="mf">3.732100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">],</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">],</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">],</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.732100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.623594e-02</span><span class="p">,</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="mf">8.554893e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.732100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">],</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">],</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">],</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="mf">3.732100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">],</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="p">[</span><span class="mf">5.997200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">5.997200e-04</span><span class="p">]]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.158605e-02</span><span class="p">,</span> <span class="mf">9.464195e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">],</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>             <span class="p">[</span><span class="mf">1.207800e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                 <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">],</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>                 <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">],</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>                 <span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">],</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>                 <span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">],</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>                 <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">],</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                 <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">],</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>                 <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">],</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>             <span class="p">[</span><span class="mf">1.262000e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.648568e-02</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span> <span class="mf">2.120374e-01</span><span class="p">,</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>                 <span class="mf">1.773651e-01</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.637220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">],</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>                 <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">],</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>                 <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">],</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>                 <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">],</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>                 <span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">],</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>                 <span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">],</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>                 <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">],</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>             <span class="p">[</span><span class="mf">1.207800e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>                 <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">],</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">]]</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">],</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>                 <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">],</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                 <span class="mf">3.297137e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">],</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>                 <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">],</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>             <span class="p">[</span><span class="mf">2.524010e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.297137e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span> <span class="mf">4.376250e-01</span><span class="p">,</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                 <span class="mf">1.811603e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.297137e-02</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">],</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>                 <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">],</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>                 <span class="mf">3.297137e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">],</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>                 <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">],</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">]]</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">],</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>                 <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">],</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>                 <span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">],</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>                 <span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">],</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.897780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.562827e-01</span><span class="p">,</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>                 <span class="mf">7.282593e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">],</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>                 <span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">],</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>                 <span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">],</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>                 <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">],</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">]]</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="p">[</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.851466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>             <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>             <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>             <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>             <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>             <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.751170e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.751170e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>             <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>             <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>             <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>             <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>             <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>             <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>             <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>             <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="mf">1.851466e-02</span><span class="p">,</span> <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">,</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>             <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>             <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>             <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>             <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>             <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>             <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>             <span class="mf">1.851466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.872620e-03</span><span class="p">,</span> <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>             <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>             <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.851466e-02</span><span class="p">,</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>             <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>             <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>             <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>             <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>             <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>             <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>             <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">],</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="p">[</span><span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">],</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">],</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">],</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">],</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">],</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">],</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">],</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="p">[</span><span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span> <span class="mf">0.2120374441</span><span class="p">,</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="mf">0.1773651242</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span> <span class="mf">1.2619999470E-3</span><span class="p">],</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">],</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">],</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">],</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">],</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">],</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">],</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="p">[</span><span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">],</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">]]</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">],</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">],</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">],</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">],</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="p">[</span><span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span> <span class="mf">0.4376249909</span><span class="p">,</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="mf">0.1811603010</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span> <span class="mf">2.5240099058E-3</span><span class="p">],</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">],</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">],</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">],</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">]]</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">,</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">],</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">],</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">],</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="p">[</span><span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">],</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="p">[</span><span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">],</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="p">[</span><span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">],</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="p">[</span><span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">],</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="p">[</span><span class="mf">2.0898699295E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1554141641</span><span class="p">,</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="mf">0.7303866148</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">],</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="p">[</span><span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">],</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="p">[</span><span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">],</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="p">[</span><span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">],</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="p">[</span><span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a>                <span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">],</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">],</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a>                <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">],</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">]]</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>  <span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>             <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>             <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a>             <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a>             <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>             <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1105690673</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a>             <span class="mf">0.1768419296</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1105690673</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>             <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a>             <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>             <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>             <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a>             <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a>             <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>             <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>             <span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="mf">8.1125000725E-4</span><span class="p">]</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="p">[</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1221499667E-3</span><span class="p">,</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>             <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>             <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>             <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>             <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>             <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a>             <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>             <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>             <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>             <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>             <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>             <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a>             <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a>             <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a>             <span class="mf">3.1221499667E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">]</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="p">[</span><span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a>             <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a>             <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>             <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a>             <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a>             <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a>             <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a>             <span class="o">-</span><span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a>             <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="mf">1.4179450460E-2</span><span class="p">,</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a>             <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>             <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a>             <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>             <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a>             <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a>             <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a>             <span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">]</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="p">[</span><span class="mf">3.1221499667E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>             <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>             <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>             <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>             <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>             <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>             <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>             <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a>             <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a>             <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>             <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a>             <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>             <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1221499667E-3</span><span class="p">]</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="p">[</span><span class="mf">0.00085404</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="mf">0.00962054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="mf">0.00085404</span><span class="p">],</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">],</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">],</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">],</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00962054</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span> <span class="mf">0.10096540</span><span class="p">,</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="mf">0.08169618</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00962054</span><span class="p">],</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">],</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">],</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">],</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="p">[</span><span class="mf">0.00085404</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00962054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="mf">0.00085404</span><span class="p">]]</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="p">[</span><span class="mf">0.00341614</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.00341614</span><span class="p">],</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">],</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.40304148</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">],</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">],</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="p">[</span><span class="mf">0.00341614</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.00341614</span><span class="p">]]</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00033429</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="mf">0.00080639</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00033429</span><span class="p">],</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">],</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">],</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">],</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00080639</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11435863</span><span class="p">,</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="mf">0.81380200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00981051</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00080639</span><span class="p">],</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a>                <span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">],</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>                <span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">],</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">],</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00033429</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00080639</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00033429</span><span class="p">]]</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span> <span class="mf">0.01455399</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">,</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="mf">0.11732297</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="mf">0.01021852</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.11732297</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="mf">0.02755155</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01455399</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00277643</span><span class="p">]</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">,</span>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="mf">0.01047717</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04435647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="mf">0.00459034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.00343249</span><span class="p">]</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="mf">0.00343249</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">,</span>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00343249</span><span class="p">]</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">,</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a>             <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a>             <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>             <span class="o">-</span><span class="mf">0.01455399</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.11732297</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11732297</span><span class="p">,</span> <span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.01455399</span><span class="p">,</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a>             <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>             <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>             <span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">]</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="mf">0.00343249</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">]</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.00343249</span><span class="p">,</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="mf">0.00459034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04435647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="mf">0.01047717</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">]</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="s2">"Steerable filters not implemented for </span><span class="si">%d</span><span class="s2"> orientations"</span> <span class="o">%</span> <span class="n">n_orientations</span><span class="p">)</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">"trained"</span><span class="p">:</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="c1"># TODO maybe also train h0 and l0 filters</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">filters</span> <span class="o">=</span> <span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0356752239</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0223877281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0009542659</span><span class="p">,</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a>                    <span class="mf">0.0244821459</span><span class="p">,</span> <span class="mf">0.0322226137</span><span class="p">],</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0593218654</span><span class="p">,</span>  <span class="mf">0.1245803162</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>                    <span class="mf">0.0023863907</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1230178699</span><span class="p">,</span> <span class="mf">0.0589442067</span><span class="p">],</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0281576272</span><span class="p">,</span>  <span class="mf">0.2976626456</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="mf">0.0020888755</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2953369915</span><span class="p">,</span> <span class="mf">0.0284542721</span><span class="p">],</span>
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0586092323</span><span class="p">,</span>  <span class="mf">0.1251581162</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a>                    <span class="mf">0.0024624448</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1227868199</span><span class="p">,</span> <span class="mf">0.0587830991</span><span class="p">],</span>
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0327464789</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0223652460</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a>                    <span class="mf">0.0042342511</span><span class="p">,</span>  <span class="mf">0.0245472137</span><span class="p">,</span> <span class="mf">0.0359398536</span><span class="p">]</span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a>                <span class="p">[</span><span class="mf">3.9758663625e-02</span><span class="p">,</span>  <span class="mf">6.0679119080e-02</span><span class="p">,</span>  <span class="mf">3.0146904290e-02</span><span class="p">,</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a>                    <span class="mf">6.1198268086e-02</span><span class="p">,</span>  <span class="mf">3.6218870431e-02</span><span class="p">],</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="p">[</span><span class="mf">2.3255519569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2505133450e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a>                    <span class="mf">2.9738345742e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2518258393e-01</span><span class="p">,</span>  <span class="mf">2.3592948914e-02</span><span class="p">],</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">1.3602430699e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2058277935e-04</span><span class="p">,</span>  <span class="mf">2.6399988565e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a>                    <span class="mf">2.3791544663e-04</span><span class="p">,</span>  <span class="mf">1.8450465286e-03</span><span class="p">],</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">2.1563466638e-02</span><span class="p">,</span>  <span class="mf">1.2572696805e-01</span><span class="p">,</span>  <span class="mf">2.9745018482e-01</span><span class="p">,</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>                    <span class="mf">1.2458638102e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3847281933e-02</span><span class="p">],</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">3.7941932678e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.1060950160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a>                    <span class="mf">2.9489086941e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0411967337e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8459088653e-02</span><span class="p">]</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="c1"># Below filters were optimised on 09/02/2021</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="c1"># 20K iterations with multiple images at more scales.</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.5508436859e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1767273545e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9399923622e-04</span><span class="p">,</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>                    <span class="mf">2.1200872958e-02</span><span class="p">,</span>  <span class="mf">4.5475799590e-02</span><span class="p">],</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">6.3554823399e-02</span><span class="p">,</span>  <span class="mf">1.2832683325e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>                    <span class="mf">5.3858719184e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2809979916e-01</span><span class="p">,</span>  <span class="mf">6.3842624426e-02</span><span class="p">],</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">3.4809380770e-02</span><span class="p">,</span>  <span class="mf">2.9954621196e-01</span><span class="p">,</span>  <span class="mf">2.9066693969e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>                    <span class="mf">2.9957753420e-01</span><span class="p">,</span>  <span class="mf">3.4806568176e-02</span><span class="p">],</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">6.3934154809e-02</span><span class="p">,</span>  <span class="mf">1.2806062400e-01</span><span class="p">,</span>  <span class="mf">9.0917674243e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>                    <span class="mf">1.2832444906e-01</span><span class="p">,</span>  <span class="mf">6.3572973013e-02</span><span class="p">],</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.5492250472e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1125273779e-02</span><span class="p">,</span>  <span class="mf">4.2229349492e-04</span><span class="p">,</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a>                    <span class="mf">2.1804777905e-02</span><span class="p">,</span>  <span class="mf">4.5236673206e-02</span><span class="p">]</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="p">[</span><span class="mf">4.8947390169e-02</span><span class="p">,</span>  <span class="mf">6.3575074077e-02</span><span class="p">,</span>  <span class="mf">3.4955859184e-02</span><span class="p">,</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="mf">6.4085893333e-02</span><span class="p">,</span>  <span class="mf">4.9838040024e-02</span><span class="p">],</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="p">[</span><span class="mf">2.2061849013e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2936264277e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a>                    <span class="mf">3.0093491077e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2997294962e-01</span><span class="p">,</span>  <span class="mf">2.0597217605e-02</span><span class="p">],</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">5.1290717238e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7305796064e-05</span><span class="p">,</span>  <span class="mf">2.0256420612e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>                    <span class="mf">1.1864109547e-04</span><span class="p">,</span>  <span class="mf">7.3973249528e-05</span><span class="p">],</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">2.0749464631e-02</span><span class="p">,</span>  <span class="mf">1.2988376617e-01</span><span class="p">,</span>  <span class="mf">3.0080935359e-01</span><span class="p">,</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a>                    <span class="mf">1.2921217084e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2159902379e-02</span><span class="p">],</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.9614857882e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.4021714032e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="mf">3.4676689655e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3446544111e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.8282280564e-02</span><span class="p">]</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="c1"># Trained on 17/02/2021 to match fourier pyramid in spatial domain</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="p">[</span><span class="mf">3.3370e-02</span><span class="p">,</span>  <span class="mf">9.3934e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5810e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.4038e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3115e-02</span><span class="p">],</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="p">[</span><span class="mf">1.7716e-01</span><span class="p">,</span>  <span class="mf">3.9378e-01</span><span class="p">,</span>  <span class="mf">6.8461e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9343e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7685e-01</span><span class="p">],</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="p">[</span><span class="mf">2.9213e-01</span><span class="p">,</span>  <span class="mf">6.1042e-01</span><span class="p">,</span>  <span class="mf">7.0654e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0939e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9177e-01</span><span class="p">],</span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="p">[</span><span class="mf">1.7684e-01</span><span class="p">,</span>  <span class="mf">3.9392e-01</span><span class="p">,</span>  <span class="mf">1.0517e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9268e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7668e-01</span><span class="p">],</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="p">[</span><span class="mf">3.3000e-02</span><span class="p">,</span>  <span class="mf">9.4029e-02</span><span class="p">,</span>  <span class="mf">7.3565e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3366e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3008e-02</span><span class="p">]</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a>                <span class="p">[</span><span class="mf">0.0331</span><span class="p">,</span>  <span class="mf">0.1763</span><span class="p">,</span>  <span class="mf">0.2907</span><span class="p">,</span>  <span class="mf">0.1753</span><span class="p">,</span>  <span class="mf">0.0325</span><span class="p">],</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="p">[</span><span class="mf">0.0941</span><span class="p">,</span>  <span class="mf">0.3932</span><span class="p">,</span>  <span class="mf">0.6079</span><span class="p">,</span>  <span class="mf">0.3904</span><span class="p">,</span>  <span class="mf">0.0922</span><span class="p">],</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="p">[</span><span class="mf">0.0008</span><span class="p">,</span>  <span class="mf">0.0009</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0010</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0025</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0015</span><span class="p">],</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0929</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3919</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6097</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3944</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0946</span><span class="p">],</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0328</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1760</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2915</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1768</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0333</span><span class="p">]</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="s2">"Trained filters not implemented for size </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">"cropped"</span><span class="p">:</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">filters</span> <span class="o">=</span> <span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">return</span> <span class="n">filters</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.hsv_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.hsv_to_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert HSV space to  RGB color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="k">def</span><span class="w"> </span><span class="nf">hsv_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Definition to convert HSV space to  RGB color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    ----------</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">                      Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    Returns</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    -------</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    image_rgb       : torch.tensor</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">                      Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    """</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">hi</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="n">f</span> <span class="o">=</span> <span class="p">((</span><span class="n">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">hi</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="n">one</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">hi</span><span class="p">,</span> <span class="n">hi</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">hi</span> <span class="o">+</span> <span class="mi">12</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">image_rgb</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="k">return</span> <span class="n">image_rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.lab_to_srgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lab_to_srgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.lab_to_srgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert LAB space to SRGB color space. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in LAB color space[3 x m x n]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_srgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in SRGB color space [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="k">def</span><span class="w"> </span><span class="nf">lab_to_srgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    Definition to convert LAB space to SRGB color space. </span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    ----------</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">                      Input image in LAB color space[3 x m x n]</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Returns</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    -------</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    image_srgb     : torch.tensor</span>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">                      Output image in SRGB color space [3 x m x n].</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    """</span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># C(H*W)</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="c1"># lab ---&gt; xyz</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">reference_illuminant</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mf">0.950428545</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.000000000</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.088900371</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">116</span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">a</span> <span class="o">=</span>  <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">500</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">b</span> <span class="o">=</span>  <span class="n">input_color</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">200</span>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a</span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">b</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">29</span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="n">factor</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xyz</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">,</span>  <span class="n">xyz</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">xyz</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">29</span><span class="p">))</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">*</span> <span class="n">reference_illuminant</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a>    <span class="c1"># xyz ---&gt; linear rgb</span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">3.241003275</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.537398934</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.498615861</span>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.969224334</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">1.875930071</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.041554224</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.055639423</span>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.204011202</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">1.057148933</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a>                  <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a>                  <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># C(H*W)</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">linear_rgb_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xyz_color</span><span class="p">)</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">linear_rgb_color</span> <span class="o">=</span> <span class="n">linear_rgb_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="c1"># linear rgb ---&gt; srgb</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.0031308</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="n">image_srgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_rgb_color</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">,</span> <span class="mf">1.055</span> <span class="o">*</span> <span class="p">(</span><span class="n">linear_rgb_color</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="n">linear_rgb_color</span><span class="p">)</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">return</span> <span class="n">image_srgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.linear_rgb_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">linear_rgb_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0031308</span><span class="p">)</span></code>

<a href="#odak.learn.perception.linear_rgb_to_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert linear RGB images to RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Threshold used in calculations.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_rgb_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0031308</span><span class="p">):</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    Definition to convert linear RGB images to RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    ----------</span>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">                      Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    threshold       : float</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">                      Threshold used in calculations.</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    Returns</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    -------</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    image_linear    : torch.tensor</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">                      Output image in RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    """</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="n">image_linear</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mf">1.055</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">threshold</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">return</span> <span class="n">image_linear</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.linear_rgb_to_xyz" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">linear_rgb_to_xyz</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.linear_rgb_to_xyz" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB space to CIE XYZ color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_xyz</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in XYZ (CIE 1931) color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_rgb_to_xyz</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    Definition to convert RGB space to CIE XYZ color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    ----------</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">                      Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    Returns</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    -------</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    image_xyz       : torch.tensor</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">                      Output image in XYZ (CIE 1931) color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    """</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">0.412453</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.357580</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.180423</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="mf">0.212671</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">0.715160</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.072169</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.019334</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.119193</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.950227</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span> 
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>                      <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a>                      <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]])</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># NC(HW)</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">image_xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">image_xyz</span> <span class="o">=</span> <span class="n">image_xyz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">return</span> <span class="n">image_xyz</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_3d_location_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_3d_location_map</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_3d_location_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the real 3D location that each pixel in an image corresponds to, when displayed to
a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed 3D location map, of size 3xWxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_3d_location_map</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Makes a map of the real 3D location that each pixel in an image corresponds to, when displayed to</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    perpendicular to the viewing direction.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    ----------</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    image_pixel_size        : tuple of ints </span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Returns</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    -------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    map                     : torch.tensor</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                The computed 3D location map, of size 3xWxH.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    """</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">real_image_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_image_width</span> <span class="o">/</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>                         <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">real_image_width</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>                              <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">real_image_height</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">y_coords</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">z_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">z_coords</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_eccentricity_distance_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_eccentricity_distance_maps</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_eccentricity_distance_maps" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the eccentricity of each pixel in an image for a given fixation point, when displayed to
a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction. Output in radians.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>eccentricity_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed eccentricity map, of size WxH.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>distance_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed distance map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_eccentricity_distance_maps</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Makes a map of the eccentricity of each pixel in an image for a given fixation point, when displayed to</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    perpendicular to the viewing direction. Output in radians.</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    ----------</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    -------</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    eccentricity_map        : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                                The computed eccentricity map, of size WxH.</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    distance_map            : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                                The computed distance map, of size WxH.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    """</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">real_image_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_image_width</span> <span class="o">/</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>                         <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">location_map</span> <span class="o">=</span> <span class="n">make_3d_location_map</span><span class="p">(</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">distance_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">location_map</span><span class="o">*</span><span class="n">location_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">direction_map</span> <span class="o">=</span> <span class="n">location_map</span> <span class="o">/</span> <span class="n">distance_map</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">gaze_location_3d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="p">(</span><span class="n">gaze_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">real_image_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="p">(</span><span class="n">gaze_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">real_image_height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">real_viewing_distance</span><span class="p">])</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">gaze_dir</span> <span class="o">=</span> <span class="n">gaze_location_3d</span> <span class="o">/</span> \
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaze_location_3d</span> <span class="o">*</span> <span class="n">gaze_location_3d</span><span class="p">))</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">gaze_dir</span> <span class="o">=</span> <span class="n">gaze_dir</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">dot_prod_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaze_dir</span> <span class="o">*</span> <span class="n">direction_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">dot_prod_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">dot_prod_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">eccentricity_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">dot_prod_map</span><span class="p">)</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">return</span> <span class="n">eccentricity_map</span><span class="p">,</span> <span class="n">distance_map</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_equi_pooling_size_map_lod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_equi_pooling_size_map_lod" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function is similar to make_equi_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from
to achieve the correct pooling region areas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_angles</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze direction expressed as angles, in radians.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Dimensions of the image in pixels, as a tuple of (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Parameter controlling extent of foveation
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size HxW.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_equi_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    This function is similar to make_equi_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    to achieve the correct pooling region areas.</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    ----------</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    gaze_angles         : tuple of 2 floats</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">                            Gaze direction expressed as angles, in radians.</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    image_pixel_size    : tuple of 2 ints</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">                            Dimensions of the image in pixels, as a tuple of (height, width)</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    alpha               : float</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">                            Parameter controlling extent of foveation</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    mode                : str</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">                            Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Returns</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    -------</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">                                The computed pooling size map, of size HxW.</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    """</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">pooling_lod</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mf">1e-6</span> <span class="o">+</span> <span class="n">pooling_pixel</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">pooling_lod</span><span class="p">[</span><span class="n">pooling_lod</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="n">pooling_lod</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_equi_pooling_size_map_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_equi_pooling_size_map_pixels" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function makes a map of pooling sizes in pixels, similarly to make_pooling_size_map_pixels, but works on 360 equirectangular images.
Input images are assumed to be in equirectangular form - i.e. if you consider a 3D viewing setup where y is the vertical axis, 
the x location in the image corresponds to rotation around the y axis (yaw), ranging from -pi to pi. The y location in the image
corresponds to pitch, ranging from -pi/2 to pi/2.</p>
<p>In this setup real_image_width and real_viewing_distance have no effect.</p>
<p>Note that rather than a 2D image gaze location in [0,1]^2, the gaze should be specified as gaze angles in [-pi,pi]x[-pi/2,pi/2] (yaw, then pitch).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_angles</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze direction expressed as angles, in radians.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Dimensions of the image in pixels, as a tuple of (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Parameter controlling extent of foveation
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    This function makes a map of pooling sizes in pixels, similarly to make_pooling_size_map_pixels, but works on 360 equirectangular images.</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    Input images are assumed to be in equirectangular form - i.e. if you consider a 3D viewing setup where y is the vertical axis, </span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    the x location in the image corresponds to rotation around the y axis (yaw), ranging from -pi to pi. The y location in the image</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    corresponds to pitch, ranging from -pi/2 to pi/2.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    In this setup real_image_width and real_viewing_distance have no effect.</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Note that rather than a 2D image gaze location in [0,1]^2, the gaze should be specified as gaze angles in [-pi,pi]x[-pi/2,pi/2] (yaw, then pitch).</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    ----------</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    gaze_angles         : tuple of 2 floats</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                            Gaze direction expressed as angles, in radians.</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    image_pixel_size    : tuple of 2 ints</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">                            Dimensions of the image in pixels, as a tuple of (height, width)</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    alpha               : float</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">                            Parameter controlling extent of foveation</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    mode                : str</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">                            Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    """</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">view_direction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">yaw_angle_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">yaw_angle_map</span> <span class="o">=</span> <span class="n">yaw_angle_map</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">pitch_angle_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">pitch_angle_map</span> <span class="o">=</span> <span class="n">pitch_angle_map</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="kc">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">dir_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yaw_angle_map</span><span class="p">)</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yaw_angle_map</span><span class="p">)</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">)])</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="c1"># Work out the pooling region diameter in radians</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">view_dot_dir</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">view_direction</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">dir_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">eccentricity</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">view_dot_dir</span><span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">pooling_rad</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">eccentricity</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"quadratic"</span><span class="p">:</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">pooling_rad</span> <span class="o">*=</span> <span class="n">eccentricity</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># The actual pooling region will be an ellipse in the equirectangular image - the length of the major &amp; minor axes</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1"># depend on the x &amp; y resolution of the image. We find these two axis lengths (in pixels) and then the area of the ellipse</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">pixels_per_rad_x</span> <span class="o">=</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">pixels_per_rad_y</span> <span class="o">=</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">pooling_axis_x</span> <span class="o">=</span> <span class="n">pooling_rad</span> <span class="o">*</span> <span class="n">pixels_per_rad_x</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">pooling_axis_y</span> <span class="o">=</span> <span class="n">pooling_rad</span> <span class="o">*</span> <span class="n">pixels_per_rad_y</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">pooling_axis_x</span> <span class="o">*</span> <span class="n">pooling_axis_y</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="c1"># Now finally find the length of the side of a square of the same area.</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">area</span><span class="p">))</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="k">return</span> <span class="n">size</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_pooling_size_map_lod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_pooling_size_map_lod" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function is similar to make_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from
to achieve the correct pooling region areas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    This function is similar to make_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    to achieve the correct pooling region areas.</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    ----------</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Returns</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    -------</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">                                The computed pooling size map, of size WxH.</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    """</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="n">make_pooling_size_map_pixels</span><span class="p">(</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">pooling_lod</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">+</span><span class="n">pooling_pixel</span><span class="p">)</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">pooling_lod</span><span class="p">[</span><span class="n">pooling_lod</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">return</span> <span class="n">pooling_lod</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_pooling_size_map_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_pooling_size_map_pixels" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the pooling size associated with each pixel in an image for a given fixation point, when displayed to
a user on a flat screen. Follows the idea that pooling size (in radians) should be directly proportional to eccentricity
(also in radians). </p>
<p>Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction. Output is the width of the pooling region in pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    Makes a map of the pooling size associated with each pixel in an image for a given fixation point, when displayed to</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    a user on a flat screen. Follows the idea that pooling size (in radians) should be directly proportional to eccentricity</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    (also in radians). </span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    perpendicular to the viewing direction. Output is the width of the pooling region in pixels.</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    ----------</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Returns</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    -------</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                                The computed pooling size map, of size WxH.</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    """</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">eccentricity</span><span class="p">,</span> <span class="n">distance_to_pixel</span> <span class="o">=</span> <span class="n">make_eccentricity_distance_maps</span><span class="p">(</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">eccentricity_centre</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_eccentricity_distance_maps</span><span class="p">(</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">pooling_rad</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">eccentricity</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"quadratic"</span><span class="p">:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">pooling_rad</span> <span class="o">*=</span> <span class="n">eccentricity</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">angle_min</span> <span class="o">=</span> <span class="n">eccentricity_centre</span> <span class="o">-</span> <span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">angle_max</span> <span class="o">=</span> <span class="n">eccentricity_centre</span> <span class="o">+</span> <span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">major_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angle_max</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angle_min</span><span class="p">))</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">real_viewing_distance</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">minor_axis</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance_to_pixel</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">major_axis</span> <span class="o">*</span> <span class="n">minor_axis</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="c1"># Should be +ve anyway, but check to ensure we don't take sqrt of negative number</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">pooling_real</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">pooling_real</span> <span class="o">/</span> <span class="n">real_image_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">return</span> <span class="n">pooling_pixel</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.make_radial_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_radial_map</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span></code>

<a href="#odak.learn.perception.make_radial_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a simple radial map where each pixel contains distance in pixels from the chosen gaze location.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    Dimensions of the image
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_radial_map</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Makes a simple radial map where each pixel contains distance in pixels from the chosen gaze location.</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    ----------</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    size    : tuple of ints</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">                Dimensions of the image</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    gaze    : tuple of floats</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    """</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">pix_gaze</span> <span class="o">=</span> <span class="p">[</span><span class="n">gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">dist_sq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="n">pix_gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="n">pix_gaze</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">radii</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist_sq</span><span class="p">)</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">return</span> <span class="n">radii</span><span class="o">/</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.pad_image_for_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="p">)</span></code>

<a href="#odak.learn.perception.pad_image_for_pyramid" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Pads an image to the extent necessary to compute a steerable pyramid of the input image.
This involves padding so both height and width are divisible by 2**n_pyramid_levels.
Uses reflection padding.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <p>Image to pad, in NCHW format</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <p>Number of levels in the pyramid you plan to construct.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Pads an image to the extent necessary to compute a steerable pyramid of the input image.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    This involves padding so both height and width are divisible by 2**n_pyramid_levels.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Uses reflection padding.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    ----------</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    image: torch.tensor</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        Image to pad, in NCHW format</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    n_pyramid_levels: int</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Number of levels in the pyramid you plan to construct.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    """</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">min_divisor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">required_height</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">min_divisor</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_divisor</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">required_width</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">min_divisor</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_divisor</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">if</span> <span class="n">required_height</span> <span class="o">&gt;</span> <span class="n">height</span> <span class="ow">or</span> <span class="n">required_width</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="c1"># We need to pad!</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">pad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">required_height</span><span class="o">-</span><span class="n">height</span><span class="p">,</span> <span class="n">required_width</span><span class="o">-</span><span class="n">width</span><span class="p">))</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="k">return</span> <span class="n">pad</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.rgb_2_ycrcb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.rgb_2_ycrcb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Converts an image from RGB colourspace to YCrCb colourspace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Input image. Should be an RGB floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ycrcb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image converted to YCrCb colourspace [k x 3 m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    Converts an image from RGB colourspace to YCrCb colourspace.</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    ----------</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">              Input image. Should be an RGB floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Returns</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    -------</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    ycrcb   : torch.tensor</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">              Image converted to YCrCb colourspace [k x 3 m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    """</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a>       <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">ycrcb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.299</span> <span class="o">*</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.587</span> <span class="o">*</span> \
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.114</span> <span class="o">*</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.713</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.564</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">return</span> <span class="n">ycrcb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.rgb_to_hsv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

<a href="#odak.learn.perception.rgb_to_hsv" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB space to HSV color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_hsv</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_to_hsv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">):</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    Definition to convert RGB space to HSV color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    ----------</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">                      Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    Returns</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    -------</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    image_hsv       : torch.tensor</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">                      Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    """</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">max_rgb</span><span class="p">,</span> <span class="n">argmax_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">min_rgb</span><span class="p">,</span> <span class="n">argmin_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">deltac</span> <span class="o">=</span> <span class="n">max_rgb</span> <span class="o">-</span> <span class="n">min_rgb</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">max_rgb</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">deltac</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_rgb</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="n">deltac</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">deltac</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">deltac</span><span class="p">),</span> <span class="n">deltac</span><span class="p">)</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">rc</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">((</span><span class="n">max_rgb</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">image</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">h1</span> <span class="o">=</span> <span class="n">bc</span> <span class="o">-</span> <span class="n">gc</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">rc</span> <span class="o">-</span> <span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">deltac</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span><span class="n">gc</span> <span class="o">-</span> <span class="n">rc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">deltac</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">h3</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltac</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">argmax_rgb</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">h</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">h</span> 
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">image_hsv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="k">return</span> <span class="n">image_hsv</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.rgb_to_linear_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0031308</span><span class="p">)</span></code>

<a href="#odak.learn.perception.rgb_to_linear_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB images to linear RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Threshold used in calculations.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in linear RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0031308</span><span class="p">):</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    Definition to convert RGB images to linear RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    ----------</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">                      Input image in RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    threshold       : float</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">                      Threshold used in calculations.</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    Returns</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    -------</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    image_linear    : torch.tensor</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">                      Output image in linear RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    """</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">image_linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(((</span><span class="n">image</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">),</span> <span class="mf">2.4</span><span class="p">),</span> <span class="n">image</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">return</span> <span class="n">image_linear</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.srgb_to_lab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.srgb_to_lab" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert SRGB space to LAB color space. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in SRGB color space[3 x m x n]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_lab</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in LAB color space [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="k">def</span><span class="w"> </span><span class="nf">srgb_to_lab</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>    
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    Definition to convert SRGB space to LAB color space. </span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    ----------</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">                      Input image in SRGB color space[3 x m x n]</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    Returns</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    -------</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    image_lab       : torch.tensor</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">                      Output image in LAB color space [3 x m x n].</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    """</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># C(H*W)</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="c1"># rgb ---&gt; linear rgb</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.04045</span>        
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="c1"># linear rgb ---&gt; xyz</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">linrgb_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">input_color</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">((</span><span class="n">input_color</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">),</span> <span class="n">input_color</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mi">10135552</span> <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="mi">4435075</span>  <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="mi">2613072</span>  <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mi">887015</span>   <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mi">1425312</span>  <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mi">70074185</span> <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>                    <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="n">linrgb_color</span> <span class="o">=</span> <span class="n">linrgb_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># C(H*W)</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">linrgb_color</span><span class="p">)</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="c1"># xyz ---&gt; lab</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">inv_reference_illuminant</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mf">1.052156925</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.000000000</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.918357670</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="n">input_color</span> <span class="o">=</span> <span class="n">xyz_color</span> <span class="o">*</span> <span class="n">inv_reference_illuminant</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">29</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="n">delta_square</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="n">delta_cube</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta_square</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>    <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delta_square</span><span class="p">)</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="n">input_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">input_color</span> <span class="o">&gt;</span> <span class="n">delta_cube</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">input_color</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">input_color</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">29</span><span class="p">))</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">l</span> <span class="o">=</span> <span class="mi">116</span> <span class="o">*</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mi">16</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="n">a</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="n">b</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="n">image_lab</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">return</span> <span class="n">image_lab</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.xyz_to_linear_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">xyz_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.xyz_to_linear_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert CIE XYZ space to linear RGB color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>           Input image in XYZ (CIE 1931) color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear_rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in linear RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="k">def</span><span class="w"> </span><span class="nf">xyz_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    Definition to convert CIE XYZ space to linear RGB color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    ----------</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    image            : torch.tensor</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">                       Input image in XYZ (CIE 1931) color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Returns</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    -------</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    image_linear_rgb : torch.tensor</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">                       Output image in linear RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    """</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">3.240479</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.537150</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.498535</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.969256</span> 
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">1.875992</span> 
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.041556</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.055648</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.204043</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">1.057311</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span> 
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                      <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a>                      <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]])</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="n">image_linear_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="n">image_linear_rgb</span> <span class="o">=</span> <span class="n">image_linear_rgb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="k">return</span> <span class="n">image_linear_rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.ycrcb_2_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.ycrcb_2_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Converts an image from YCrCb colourspace to RGB colourspace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Input image. Should be a YCrCb floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image converted to RGB colourspace [k x 3 m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="k">def</span><span class="w"> </span><span class="nf">ycrcb_2_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    Converts an image from YCrCb colourspace to RGB colourspace.</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    ----------</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">              Input image. Should be a YCrCb floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    Returns</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    -------</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    rgb     : torch.tensor</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">              Image converted to RGB colourspace [k x 3 m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    """</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>       <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">1.403</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.714</span> <span class="o">*</span> \
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.344</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">1.773</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="k">return</span> <span class="n">rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.blur_loss"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.blur_loss.BlurLoss" class="doc doc-heading">
            <code>BlurLoss</code>


<a href="#odak.learn.perception.blur_loss.BlurLoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p><code>BlurLoss</code> implements two different blur losses. When <code>blur_source</code> is set to <code>False</code>, it implements blur_match, trying to match the input image to the blurred target image. This tries to match the source input image to a blurred version of the target.</p>
<p>When <code>blur_source</code> is set to <code>True</code>, it implements blur_lowpass, matching the blurred version of the input image to the blurred target image. This tries to match only the low frequencies of the source input image to the low frequencies of the target.</p>
<p>The interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">BlurLoss</span><span class="p">():</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    `BlurLoss` implements two different blur losses. When `blur_source` is set to `False`, it implements blur_match, trying to match the input image to the blurred target image. This tries to match the source input image to a blurred version of the target.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    When `blur_source` is set to `True`, it implements blur_lowpass, matching the blurred version of the input image to the blurred target image. This tries to match only the low frequencies of the source input image to the low frequencies of the target.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    The interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        ----------</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        blur_source             : bool</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    If true, blurs the source image as well as the target before computing the loss.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        """</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span> <span class="o">=</span> <span class="n">blur_source</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">blur_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="n">RadiallyVaryingBlur</span><span class="p">()</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        Calculates the Blur Loss.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        gaze                : list</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        Returns</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        -------</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        """</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"BlurLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">blurred_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">blurred_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">blurred_image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.blur_loss.BlurLoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></code>

<a href="#odak.learn.perception.blur_loss.BlurLoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Blur Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    Calculates the Blur Loss.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    gaze                : list</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">                            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    Returns</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    -------</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    """</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"BlurLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">blurred_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span><span class="p">:</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">blurred_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">blurred_image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">blurred_target</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.blur_loss.BlurLoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.blur_loss.BlurLoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>blur_source</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, blurs the source image as well as the target before computing the loss.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/blur_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">blur_source</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    ----------</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    blur_source             : bool</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                If true, blurs the source image as well as the target before computing the loss.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    """</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blur_source</span> <span class="o">=</span> <span class="n">blur_source</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.color_conversion"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.color_conversion.display_color_hvs" class="doc doc-heading">
            <code>display_color_hvs</code>


<a href="#odak.learn.perception.color_conversion.display_color_hvs" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">display_color_hvs</span><span class="p">():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>                 <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>                 <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>                 <span class="n">distance_from_screen</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>                 <span class="n">pixel_pitch</span> <span class="o">=</span> <span class="mf">0.311</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>                 <span class="n">read_spectrum</span> <span class="o">=</span> <span class="s1">'tensor'</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>                 <span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>                 <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                <span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        resolution                  : list</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                      Resolution of the display in pixels.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        distance_from_screen        : int</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                      Distance from the screen in mm.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        pixel_pitch                 : float</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                      Pixel pitch of the display in mm.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        read_spectrum               : str</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                      Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        device                      : torch.device</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                      Device to run the code on. Default is None which means the code will run on CPU.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        '''</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">=</span> <span class="n">read_spectrum</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">distance_from_screen</span> <span class="o">=</span> <span class="n">distance_from_screen</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pixel_pitch</span> <span class="o">=</span> <span class="n">pixel_pitch</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_cones_normalized</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_lms</span><span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                                                    <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                                                   <span class="p">)</span>   
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_primaries</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                                                <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                                               <span class="p">)</span>   
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">return</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        Evaluating an input image against a target ground truth image for a given gaze of a viewer.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">lms_image_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">lms_ground_truth_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">lms_image_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image_second</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">lms_ground_truth_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_ground_truth_second</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">loss_metamer_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">lms_ground_truth_third</span> <span class="o">-</span> <span class="n">lms_image_third</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">return</span> <span class="n">loss_metamer_color</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_cones_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Returns</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        -------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        l_cone_n                     : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                       Normalised L cone distribution.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        m_cone_n                     : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                                       Normalised M cone distribution.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        s_cone_n                     : torch.tensor</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                                       Normalised S cone distribution.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        """</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">dist_l</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">32.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">567.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">32.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">dist_m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">27.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">545.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">27.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">dist_s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">17.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">447.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">17.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">l_cone_n</span> <span class="o">=</span> <span class="n">dist_l</span> <span class="o">/</span> <span class="n">dist_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">m_cone_n</span> <span class="o">=</span> <span class="n">dist_m</span> <span class="o">/</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">s_cone_n</span> <span class="o">=</span> <span class="n">dist_s</span> <span class="o">/</span> <span class="n">dist_s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">return</span> <span class="n">l_cone_n</span><span class="p">,</span> <span class="n">m_cone_n</span><span class="p">,</span> <span class="n">s_cone_n</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_rgb_backlight_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        Internal function to initialize baclight spectrum for color primaries. </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        Returns</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        -------</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        red_spectrum                 : torch.tensor</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                                       Normalised backlight spectrum for red color primary.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        green_spectrum               : torch.tensor</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                                       Normalised backlight spectrum for green color primary.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        blue_spectrum                : torch.tensor</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                                       Normalised backlight spectrum for blue color primary.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">red_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">14.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">650</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">14.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">green_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">550</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">450</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">red_spectrum</span> <span class="o">=</span> <span class="n">red_spectrum</span> <span class="o">/</span> <span class="n">red_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">green_spectrum</span> <span class="o">=</span> <span class="n">green_spectrum</span> <span class="o">/</span> <span class="n">green_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="n">blue_spectrum</span> <span class="o">/</span> <span class="n">blue_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="k">return</span> <span class="n">red_spectrum</span><span class="p">,</span> <span class="n">green_spectrum</span><span class="p">,</span> <span class="n">blue_spectrum</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        ----------</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        dataset                                : torch.tensor </span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                                 spectrum value against wavelength </span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">dataset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">x_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">301</span><span class="p">)</span> <span class="o">-</span> <span class="mi">550</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">y_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np_cpu</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">max_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">y_spectrum</span> <span class="o">/=</span> <span class="n">max_spectrum</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">centre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> \
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centre</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span> 
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="k">return</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">([</span><span class="n">weights</span><span class="p">],</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">line_search_fn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">closure</span><span class="p">():</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">spectrum</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Internal function to provide light spectrum response at particular wavelength</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        wavelength                          : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                                              Wavelength in nm [400...700]</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        function                            : torch.tensor</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                                              Display light spectrum distribution function</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        Returns</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        -------</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        ligth_response_dict                  : float</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">                                               Display light spectrum response value</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">        """</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">:</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="n">wavelength</span> <span class="o">-</span> <span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">elif</span> <span class="n">wavelength</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">cone_response_to_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Internal function to calculate cone response at particular light spectrum. </span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        ----------</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        cone_spectrum                         : torch.tensor</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                                                Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        light_spectrum                        : torch.tensor</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">                                                Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">        Returns</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        -------</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        response_to_spectrum                  : float</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">                                                Response of cone to light spectrum [1x1] </span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        """</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">response_to_spectrum</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">return</span> <span class="n">response_to_spectrum</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        ----------</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">        l_response                             : torch.tensor</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        m_response                             : torch.tensor</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">        s_response                             : torch.tensor</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">        Returns</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        -------</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">                                                3x3 LMSrgb tensor</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        '''</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">m_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">s_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span>    
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        ----------</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        l_response                             : torch.tensor</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        m_response                             : torch.tensor</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">        s_response                             : torch.tensor</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">                                                 Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">        Returns</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        -------</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">                                                3x3 LMSrgb tensor</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        '''</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>                                                                         <span class="n">l_response</span><span class="p">,</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>                                                                        <span class="p">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                                                         <span class="n">m_response</span><span class="p">,</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                                                        <span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>                                                                         <span class="n">s_response</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                                                        <span class="p">)</span> 
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span>    
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">primaries_to_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaries</span><span class="p">):</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        Internal function to convert primaries space to LMS space </span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">        ----------</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        primaries                              : torch.tensor</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">                                                 Primaries data to be transformed to LMS space [BxPHxW]</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">        Returns</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">        -------</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        lms_color                              : torch.tensor</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">                                                 LMS data transformed from Primaries space [BxPxHxW]</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        """</span>                
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">primaries_flatten</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">lms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>        <span class="n">lms_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">primaries_flatten</span> <span class="o">*</span> <span class="n">lms</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">return</span> <span class="n">lms_color</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lms_to_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_color_tensor</span><span class="p">):</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">        Internal function to convert LMS image to primaries space</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">        ----------</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">        lms_color_tensor                        : torch.tensor</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                                                  LMS data to be transformed to primaries space [Bx3xHxW]</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">        Returns</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        -------</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        primaries                              : torch.tensor</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                                               : Primaries data transformed from LMS space [BxPxHxW]</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        """</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">lms_color_tensor</span> <span class="o">=</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">lms_color_flatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">,</span> <span class="n">start_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unflatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">converted_unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">lms_color_flatten</span><span class="o">.</span><span class="n">double</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">pinverse</span><span class="p">()</span><span class="o">.</span><span class="n">double</span><span class="p">())</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">primaries</span> <span class="o">=</span> <span class="n">unflatten</span><span class="p">(</span><span class="n">converted_unflatten</span><span class="p">)</span>     
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">primaries</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>        <span class="k">return</span> <span class="n">primaries</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">second_to_third_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_image</span><span class="p">):</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">        </span><span class="sd">'''</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">        This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], </span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        ----------</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        lms_image                             : torch.tensor</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">                                                 Image data at LMS space (second stage)</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Returns</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        -------</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        third_stage                            : torch.tensor</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                                                 Image data at LMS space (third stage)</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        '''</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">third_stage</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="k">return</span> <span class="n">third_stage</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluating an input image against a target ground truth image for a given gaze of a viewer.</p>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_image</span><span class="p">,</span> <span class="n">ground_truth</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Evaluating an input image against a target ground truth image for a given gaze of a viewer.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">lms_image_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">input_image</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">lms_ground_truth_second</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">ground_truth</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">lms_image_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image_second</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">lms_ground_truth_third</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_ground_truth_second</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">loss_metamer_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">lms_ground_truth_third</span> <span class="o">-</span> <span class="n">lms_image_third</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">return</span> <span class="n">loss_metamer_color</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span> <span class="n">distance_from_screen</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">pixel_pitch</span><span class="o">=</span><span class="mf">0.311</span><span class="p">,</span> <span class="n">read_spectrum</span><span class="o">=</span><span class="s1">'tensor'</span><span class="p">,</span> <span class="n">primaries_spectrum</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>resolution</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Resolution of the display in pixels.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>distance_from_screen</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Distance from the screen in mm.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>pixel_pitch</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Pixel pitch of the display in mm.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>read_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                      Device to run the code on. Default is None which means the code will run on CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>             <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>             <span class="n">resolution</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">],</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>             <span class="n">distance_from_screen</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>             <span class="n">pixel_pitch</span> <span class="o">=</span> <span class="mf">0.311</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>             <span class="n">read_spectrum</span> <span class="o">=</span> <span class="s1">'tensor'</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>             <span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">301</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>             <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    resolution                  : list</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                  Resolution of the display in pixels.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    distance_from_screen        : int</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                  Distance from the screen in mm.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    pixel_pitch                 : float</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                  Pixel pitch of the display in mm.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    read_spectrum               : str</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                  Spectrum of the display. Default is 'default' which is the spectrum of the Dell U2415 display [3 x 301].</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    device                      : torch.device</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                  Device to run the code on. Default is None which means the code will run on CPU.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    '''</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">=</span> <span class="n">read_spectrum</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span> <span class="o">=</span> <span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">distance_from_screen</span> <span class="o">=</span> <span class="n">distance_from_screen</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pixel_pitch</span> <span class="o">=</span> <span class="n">pixel_pitch</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialize_cones_normalized</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_lms</span><span class="p">(</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                                                <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                                               <span class="p">)</span>   
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_matrix_primaries</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">l_normalized</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">m_normalized</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                                            <span class="bp">self</span><span class="o">.</span><span class="n">s_normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                                           <span class="p">)</span>   
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">return</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.cone_response_to_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.cone_response_to_spectrum" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>cone_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                Spectrum, Wavelength [2,300] tensor
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>light_spectrum</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                Spectrum, Wavelength [2,300] tensor
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>response_to_spectrum</code></b> (              <code><span title="float">float</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Response of cone to light spectrum [1x1]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="k">def</span><span class="w"> </span><span class="nf">cone_response_to_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Internal function to calculate cone response at particular light spectrum. </span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    ----------</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">    cone_spectrum                         : torch.tensor</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">                                            Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    light_spectrum                        : torch.tensor</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">                                            Spectrum, Wavelength [2,300] tensor </span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    Returns</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    -------</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    response_to_spectrum                  : float</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">                                            Response of cone to light spectrum [1x1] </span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    """</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">cone_spectrum</span><span class="p">,</span> <span class="n">light_spectrum</span><span class="p">)</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>    <span class="n">response_to_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">response_to_spectrum</span><span class="p">)</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">return</span> <span class="n">response_to_spectrum</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_lms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_matrix_lms</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_lms" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone  response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>l_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>m_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>s_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_image_tensor</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>3x3 LMSrgb tensor</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    ----------</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">    l_response                             : torch.tensor</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    m_response                             : torch.tensor</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    s_response                             : torch.tensor</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    Returns</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    -------</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">                                            3x3 LMSrgb tensor</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">    '''</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">m_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span><span class="n">s_response</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_primaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_matrix_primaries</span><span class="p">(</span><span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.construct_matrix_primaries" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to calculate cone  response at particular light spectrum. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>l_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>m_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>s_response</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Cone response spectrum tensor (normalized response vs wavelength)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_image_tensor</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>3x3 LMSrgb tensor</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_matrix_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_response</span><span class="p">,</span> <span class="n">m_response</span><span class="p">,</span> <span class="n">s_response</span><span class="p">):</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">    Internal function to calculate cone  response at particular light spectrum. </span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">    ----------</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">    l_response                             : torch.tensor</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    m_response                             : torch.tensor</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    s_response                             : torch.tensor</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">                                             Cone response spectrum tensor (normalized response vs wavelength)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    Returns</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    -------</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    lms_image_tensor                      : torch.tensor</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">                                            3x3 LMSrgb tensor</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    '''</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_spectrum</span> <span class="o">==</span> <span class="s1">'tensor'</span><span class="p">:</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'Tensor primary spectrum is used'</span><span class="p">)</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'The number of primaries used is </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No Spectrum data is provided"</span><span class="p">)</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>                                                                     <span class="n">l_response</span><span class="p">,</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>                                                                    <span class="p">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>                                                                     <span class="n">m_response</span><span class="p">,</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>                                                                    <span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cone_response_to_spectrum</span><span class="p">(</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>                                                                     <span class="n">s_response</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                                                                     <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>                                                                    <span class="p">)</span> 
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_tensor</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.display_spectrum_response" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.display_spectrum_response" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to provide light spectrum response at particular wavelength</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>wavelength</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                              Wavelength in nm [400...700]
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>function</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                              Display light spectrum distribution function
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ligth_response_dict</code></b> (              <code><span title="float">float</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Display light spectrum response value</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="k">def</span><span class="w"> </span><span class="nf">display_spectrum_response</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    Internal function to provide light spectrum response at particular wavelength</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    wavelength                          : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                                          Wavelength in nm [400...700]</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    function                            : torch.tensor</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">                                          Display light spectrum distribution function</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Returns</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    -------</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    ligth_response_dict                  : float</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">                                           Display light spectrum response value</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">    """</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">wavelength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">if</span> <span class="n">wavelength</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="ow">and</span> <span class="n">wavelength</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">:</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="n">wavelength</span> <span class="o">-</span> <span class="mi">400</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">elif</span> <span class="n">wavelength</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="k">return</span> <span class="n">function</span><span class="p">[</span><span class="mi">300</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.initialize_cones_normalized" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_cones_normalized</span><span class="p">()</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_cones_normalized" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>l_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised L cone distribution.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>m_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised M cone distribution.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>s_cone_n</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised S cone distribution.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_cones_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Internal function to initialize normalized L,M,S cones as normal distribution with given sigma, and mu values. </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Returns</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    -------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    l_cone_n                     : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                                   Normalised L cone distribution.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    m_cone_n                     : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                                   Normalised M cone distribution.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    s_cone_n                     : torch.tensor</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                                   Normalised S cone distribution.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    """</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">dist_l</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">32.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">567.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">32.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">dist_m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">27.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">545.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">27.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">dist_s</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">17.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mf">447.5</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">17.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">l_cone_n</span> <span class="o">=</span> <span class="n">dist_l</span> <span class="o">/</span> <span class="n">dist_l</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="n">m_cone_n</span> <span class="o">=</span> <span class="n">dist_m</span> <span class="o">/</span> <span class="n">dist_m</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">s_cone_n</span> <span class="o">=</span> <span class="n">dist_s</span> <span class="o">/</span> <span class="n">dist_s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="k">return</span> <span class="n">l_cone_n</span><span class="p">,</span> <span class="n">m_cone_n</span><span class="p">,</span> <span class="n">s_cone_n</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.initialize_random_spectrum_normalized" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_random_spectrum_normalized" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>dataset</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 spectrum value against wavelength
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_random_spectrum_normalized</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Initialize normalized light spectrum via combination of 3 gaussian distribution curve fitting [L-BFGS]. </span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    ----------</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    dataset                                : torch.tensor </span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                             spectrum value against wavelength </span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">dataset</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">x_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="mi">301</span><span class="p">)</span> <span class="o">-</span> <span class="mi">550</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">y_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">from_numpy</span><span class="p">(</span><span class="n">np_cpu</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">()))</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">max_spectrum</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">y_spectrum</span> <span class="o">/=</span> <span class="n">max_spectrum</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">centre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> \
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centre</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span> 
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">return</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span> <span class="o">+</span> <span class="n">gaussian</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">weights</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">weights</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">LBFGS</span><span class="p">([</span><span class="n">weights</span><span class="p">],</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">line_search_fn</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">closure</span><span class="p">():</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">mse_loss</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_spectrum</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">closure</span><span class="p">)</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="n">spectrum</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x_spectrum</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="n">spectrum</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.initialize_rgb_backlight_spectrum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_rgb_backlight_spectrum</span><span class="p">()</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.initialize_rgb_backlight_spectrum" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to initialize baclight spectrum for color primaries. </p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>red_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for red color primary.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>green_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for green color primary.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>blue_spectrum</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Normalised backlight spectrum for blue color primary.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_rgb_backlight_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    Internal function to initialize baclight spectrum for color primaries. </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">    Returns</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    -------</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    red_spectrum                 : torch.tensor</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">                                   Normalised backlight spectrum for red color primary.</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    green_spectrum               : torch.tensor</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">                                   Normalised backlight spectrum for green color primary.</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    blue_spectrum                : torch.tensor</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">                                   Normalised backlight spectrum for blue color primary.</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">wavelength_range</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaries_spectrum</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">red_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">14.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">650</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">14.5</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">green_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">550</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">wavelength_range</span> <span class="o">-</span> <span class="mi">450</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="mf">12.0</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">red_spectrum</span> <span class="o">=</span> <span class="n">red_spectrum</span> <span class="o">/</span> <span class="n">red_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">green_spectrum</span> <span class="o">=</span> <span class="n">green_spectrum</span> <span class="o">/</span> <span class="n">green_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">blue_spectrum</span> <span class="o">=</span> <span class="n">blue_spectrum</span> <span class="o">/</span> <span class="n">blue_spectrum</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">return</span> <span class="n">red_spectrum</span><span class="p">,</span> <span class="n">green_spectrum</span><span class="p">,</span> <span class="n">blue_spectrum</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.lms_to_primaries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lms_to_primaries</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.lms_to_primaries" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to convert LMS image to primaries space</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>lms_color_tensor</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                  LMS data to be transformed to primaries space [Bx3xHxW]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>primaries</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>: Primaries data transformed from LMS space [BxPxHxW]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a><span class="k">def</span><span class="w"> </span><span class="nf">lms_to_primaries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_color_tensor</span><span class="p">):</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a><span class="sd">    Internal function to convert LMS image to primaries space</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="sd">    ----------</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a><span class="sd">    lms_color_tensor                        : torch.tensor</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">                                              LMS data to be transformed to primaries space [Bx3xHxW]</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">    Returns</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">    -------</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    primaries                              : torch.tensor</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">                                           : Primaries data transformed from LMS space [BxPxHxW]</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    """</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">lms_color_tensor</span> <span class="o">=</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">lms_color_flatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">lms_color_tensor</span><span class="p">,</span> <span class="n">start_dim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">end_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Unflatten</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">lms_color_tensor</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">converted_unflatten</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">lms_color_flatten</span><span class="o">.</span><span class="n">double</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">pinverse</span><span class="p">()</span><span class="o">.</span><span class="n">double</span><span class="p">())</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">primaries</span> <span class="o">=</span> <span class="n">unflatten</span><span class="p">(</span><span class="n">converted_unflatten</span><span class="p">)</span>     
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="n">primaries</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>   
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">return</span> <span class="n">primaries</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.primaries_to_lms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">primaries_to_lms</span><span class="p">(</span><span class="n">primaries</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.primaries_to_lms" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Internal function to convert primaries space to LMS space </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>primaries</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Primaries data to be transformed to LMS space [BxPHxW]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>lms_color</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>LMS data transformed from Primaries space [BxPxHxW]</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="k">def</span><span class="w"> </span><span class="nf">primaries_to_lms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">primaries</span><span class="p">):</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    Internal function to convert primaries space to LMS space </span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    ----------</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">    primaries                              : torch.tensor</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">                                             Primaries data to be transformed to LMS space [BxPHxW]</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    Returns</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    -------</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    lms_color                              : torch.tensor</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">                                             LMS data transformed from Primaries space [BxPxHxW]</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    """</span>                
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">primaries_flatten</span> <span class="o">=</span> <span class="n">primaries</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="n">lms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lms_tensor</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">lms_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">primaries_flatten</span> <span class="o">*</span> <span class="n">lms</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">primaries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="k">return</span> <span class="n">lms_color</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.color_conversion.display_color_hvs.second_to_third_stage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">second_to_third_stage</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.display_color_hvs.second_to_third_stage" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], 
See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>lms_image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                                 Image data at LMS space (second stage)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>third_stage</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image data at LMS space (third stage)</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="k">def</span><span class="w"> </span><span class="nf">second_to_third_stage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lms_image</span><span class="p">):</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">    This function turns second stage [L,M,S] values into third stage [(M+S)-L, (L+S)-M, L+M+S], </span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">    See table 1 from Schmidt et al. "Neurobiological hypothesis of color appearance and hue perception," Optics Express 2014.</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    ----------</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    lms_image                             : torch.tensor</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">                                             Image data at LMS space (second stage)</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    Returns</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">    -------</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">    third_stage                            : torch.tensor</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">                                             Image data at LMS space (third stage)</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    '''</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="n">third_stage</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">lms_image</span><span class="p">)</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">third_stage</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="n">lms_image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="k">return</span> <span class="n">third_stage</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.color_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">color_map</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">target_image</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">'Lab Stats'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.color_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Internal function to map the color of an image to another image.
Reference: Color transfer between images, Reinhard et al., 2001.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>input_image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Input image in RGB color space [3 x m x n].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_image</code></b>
          â€“
          <div class="doc-md-description">
            
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>mapped_image</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Input image with the color the distribution of the target image [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="k">def</span><span class="w"> </span><span class="nf">color_map</span><span class="p">(</span><span class="n">input_image</span><span class="p">,</span> <span class="n">target_image</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="s1">'Lab Stats'</span><span class="p">):</span>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    Internal function to map the color of an image to another image.</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    Reference: Color transfer between images, Reinhard et al., 2001.</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    ----------</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">    input_image         : torch.Tensor</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">                          Input image in RGB color space [3 x m x n].</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">    target_image        : torch.Tensor</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">    Returns</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">    -------</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">    mapped_image           : torch.Tensor</span>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">                             Input image with the color the distribution of the target image [3 x m x n].</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">    """</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">'Lab Stats'</span><span class="p">:</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">lab_input</span> <span class="o">=</span> <span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">input_image</span><span class="p">)</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a>        <span class="n">lab_target</span> <span class="o">=</span> <span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">target_image</span><span class="p">)</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a>        <span class="n">input_mean_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">input_mean_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">input_mean_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="n">input_std_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">input_std_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">input_std_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a>        <span class="n">target_mean_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a>        <span class="n">target_mean_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="n">target_mean_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">target_std_L</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="n">target_std_a</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">target_std_b</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">lab_target</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_L</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_L</span> <span class="o">/</span> <span class="n">input_std_L</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_L</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_a</span> <span class="o">/</span> <span class="n">input_std_a</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_a</span>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lab_input</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_mean_b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_std_b</span> <span class="o">/</span> <span class="n">input_std_b</span><span class="p">)</span> <span class="o">+</span> <span class="n">target_mean_b</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="n">mapped_image</span> <span class="o">=</span> <span class="n">lab_to_srgb</span><span class="p">(</span><span class="n">lab_input</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="k">return</span> <span class="n">mapped_image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.hsv_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">hsv_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.hsv_to_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert HSV space to  RGB color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="k">def</span><span class="w"> </span><span class="nf">hsv_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Definition to convert HSV space to  RGB color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    ----------</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">                      Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">    Returns</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    -------</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a><span class="sd">    image_rgb       : torch.tensor</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a><span class="sd">                      Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a><span class="sd">    """</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="n">hi</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="n">f</span> <span class="o">=</span> <span class="p">((</span><span class="n">h</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span> <span class="o">%</span> <span class="mi">6</span><span class="p">)</span> <span class="o">-</span> <span class="n">hi</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a>    <span class="n">one</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>    <span class="n">p</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="n">q</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">f</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">v</span> <span class="o">*</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="p">(</span><span class="n">one</span> <span class="o">-</span> <span class="n">f</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="n">hi</span> <span class="o">=</span> <span class="n">hi</span><span class="o">.</span><span class="n">long</span><span class="p">()</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">hi</span><span class="p">,</span> <span class="n">hi</span> <span class="o">+</span> <span class="mi">6</span><span class="p">,</span> <span class="n">hi</span> <span class="o">+</span> <span class="mi">12</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">image_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">image_rgb</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="k">return</span> <span class="n">image_rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.lab_to_srgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lab_to_srgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.lab_to_srgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert LAB space to SRGB color space. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in LAB color space[3 x m x n]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_srgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in SRGB color space [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="k">def</span><span class="w"> </span><span class="nf">lab_to_srgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a><span class="sd">    Definition to convert LAB space to SRGB color space. </span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a><span class="sd">    ----------</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="sd">                      Input image in LAB color space[3 x m x n]</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="sd">    Returns</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    -------</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">    image_srgb     : torch.tensor</span>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">                      Output image in SRGB color space [3 x m x n].</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">    """</span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># C(H*W)</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a>    <span class="c1"># lab ---&gt; xyz</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a>    <span class="n">reference_illuminant</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mf">0.950428545</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.000000000</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.088900371</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a>    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">16</span><span class="p">)</span> <span class="o">/</span> <span class="mi">116</span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a>    <span class="n">a</span> <span class="o">=</span>  <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">500</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">b</span> <span class="o">=</span>  <span class="n">input_color</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">/</span> <span class="mi">200</span>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a</span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="n">z</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">b</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a>    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">29</span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="n">factor</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="n">xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xyz</span> <span class="o">&gt;</span> <span class="n">delta</span><span class="p">,</span>  <span class="n">xyz</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">xyz</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">29</span><span class="p">))</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz</span> <span class="o">*</span> <span class="n">reference_illuminant</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a>    <span class="c1"># xyz ---&gt; linear rgb</span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">3.241003275</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.537398934</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.498615861</span>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.969224334</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">1.875930071</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.041554224</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.055639423</span>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.204011202</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">1.057148933</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a>                  <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a>                  <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># C(H*W)</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">linear_rgb_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">xyz_color</span><span class="p">)</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">linear_rgb_color</span> <span class="o">=</span> <span class="n">linear_rgb_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="c1"># linear rgb ---&gt; srgb</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.0031308</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="n">image_srgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">linear_rgb_color</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">,</span> <span class="mf">1.055</span> <span class="o">*</span> <span class="p">(</span><span class="n">linear_rgb_color</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="n">linear_rgb_color</span><span class="p">)</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="k">return</span> <span class="n">image_srgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.linear_rgb_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">linear_rgb_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0031308</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.linear_rgb_to_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert linear RGB images to RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Threshold used in calculations.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_rgb_to_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0031308</span><span class="p">):</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    Definition to convert linear RGB images to RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    ----------</span>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a><span class="sd">                      Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    threshold       : float</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">                      Threshold used in calculations.</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    Returns</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    -------</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    image_linear    : torch.tensor</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">                      Output image in RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">    """</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="n">image_linear</span> <span class="o">=</span>  <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">,</span> <span class="mf">1.055</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">threshold</span><span class="p">),</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.055</span><span class="p">,</span> <span class="mf">12.92</span> <span class="o">*</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="k">return</span> <span class="n">image_linear</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.linear_rgb_to_xyz" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">linear_rgb_to_xyz</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.linear_rgb_to_xyz" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB space to CIE XYZ color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_xyz</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in XYZ (CIE 1931) color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a><span class="k">def</span><span class="w"> </span><span class="nf">linear_rgb_to_xyz</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">    Definition to convert RGB space to CIE XYZ color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">    ----------</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a><span class="sd">                      Input image in linear RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a><span class="sd">    Returns</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a><span class="sd">    -------</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="sd">    image_xyz       : torch.tensor</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a><span class="sd">                      Output image in XYZ (CIE 1931) color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">    """</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">0.412453</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.357580</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.180423</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="mf">0.212671</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">0.715160</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.072169</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.019334</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.119193</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.950227</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span> 
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>                      <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a>                      <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]])</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># NC(HW)</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">image_xyz</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="n">image_xyz</span> <span class="o">=</span> <span class="n">image_xyz</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="k">return</span> <span class="n">image_xyz</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.rgb_2_ycrcb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.rgb_2_ycrcb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Converts an image from RGB colourspace to YCrCb colourspace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Input image. Should be an RGB floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ycrcb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image converted to YCrCb colourspace [k x 3 m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a><span class="sd">    Converts an image from RGB colourspace to YCrCb colourspace.</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">    ----------</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">              Input image. Should be an RGB floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">    Returns</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    -------</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">    ycrcb   : torch.tensor</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">              Image converted to YCrCb colourspace [k x 3 m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">    """</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a>       <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="n">ycrcb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.299</span> <span class="o">*</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.587</span> <span class="o">*</span> \
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.114</span> <span class="o">*</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.713</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.564</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">ycrcb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a>    <span class="k">return</span> <span class="n">ycrcb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.rgb_to_hsv" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.rgb_to_hsv" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB space to HSV color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_hsv</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_to_hsv</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">):</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="sd">    Definition to convert RGB space to HSV color space. Mostly inspired from : https://kornia.readthedocs.io/en/latest/_modules/kornia/color/hsv.html</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">    ----------</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">                      Input image in HSV color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    Returns</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">    -------</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">    image_hsv       : torch.tensor</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">                      Output image in  RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    """</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>    <span class="n">max_rgb</span><span class="p">,</span> <span class="n">argmax_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a>    <span class="n">min_rgb</span><span class="p">,</span> <span class="n">argmin_rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">deltac</span> <span class="o">=</span> <span class="n">max_rgb</span> <span class="o">-</span> <span class="n">min_rgb</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>    <span class="n">v</span> <span class="o">=</span> <span class="n">max_rgb</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="n">s</span> <span class="o">=</span> <span class="n">deltac</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_rgb</span> <span class="o">+</span> <span class="n">eps</span><span class="p">)</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="n">deltac</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">deltac</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">deltac</span><span class="p">),</span> <span class="n">deltac</span><span class="p">)</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>    <span class="n">rc</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">unbind</span><span class="p">((</span><span class="n">max_rgb</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">image</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="n">h1</span> <span class="o">=</span> <span class="n">bc</span> <span class="o">-</span> <span class="n">gc</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a>    <span class="n">h2</span> <span class="o">=</span> <span class="p">(</span><span class="n">rc</span> <span class="o">-</span> <span class="n">bc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">deltac</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">h3</span> <span class="o">=</span> <span class="p">(</span><span class="n">gc</span> <span class="o">-</span> <span class="n">rc</span><span class="p">)</span> <span class="o">+</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">deltac</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">h1</span><span class="p">,</span> <span class="n">h2</span><span class="p">,</span> <span class="n">h3</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">deltac</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>    <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">argmax_rgb</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">1.0</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="n">h</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">h</span> 
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="n">image_hsv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>    <span class="k">return</span> <span class="n">image_hsv</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.rgb_to_linear_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rgb_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.0031308</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.rgb_to_linear_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert RGB images to linear RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Threshold used in calculations.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in linear RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="k">def</span><span class="w"> </span><span class="nf">rgb_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0031308</span><span class="p">):</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    Definition to convert RGB images to linear RGB color space. Mostly inspired from: https://kornia.readthedocs.io/en/latest/_modules/kornia/color/rgb.html</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a><span class="sd">    ----------</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a><span class="sd">                      Input image in RGB color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="sd">    threshold       : float</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="sd">                      Threshold used in calculations.</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">    Returns</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">    -------</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">    image_linear    : torch.tensor</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">                      Output image in linear RGB color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="sd">    """</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="n">image_linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(((</span><span class="n">image</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">),</span> <span class="mf">2.4</span><span class="p">),</span> <span class="n">image</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">return</span> <span class="n">image_linear</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.srgb_to_lab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">srgb_to_lab</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.srgb_to_lab" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert SRGB space to LAB color space. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Input image in SRGB color space[3 x m x n]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_lab</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in LAB color space [3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a><span class="k">def</span><span class="w"> </span><span class="nf">srgb_to_lab</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>    
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a><span class="sd">    Definition to convert SRGB space to LAB color space. </span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="sd">    ----------</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    image           : torch.tensor</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">                      Input image in SRGB color space[3 x m x n]</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="sd">    Returns</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    -------</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">    image_lab       : torch.tensor</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">                      Output image in LAB color space [3 x m x n].</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">    """</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># C(H*W)</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="n">input_color</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="c1"># rgb ---&gt; linear rgb</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="mf">0.04045</span>        
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>    <span class="c1"># linear rgb ---&gt; xyz</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>    <span class="n">linrgb_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">input_color</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">((</span><span class="n">input_color</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">),</span> <span class="n">input_color</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mi">10135552</span> <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="mi">4435075</span>  <span class="o">/</span> <span class="mi">24577794</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="mi">2613072</span>  <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mi">887015</span>   <span class="o">/</span> <span class="mi">12288897</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mi">1425312</span>  <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="mi">8788810</span>  <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mi">70074185</span> <span class="o">/</span> <span class="mi">73733382</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>    <span class="n">A</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>                    <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="n">linrgb_color</span> <span class="o">=</span> <span class="n">linrgb_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># C(H*W)</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">linrgb_color</span><span class="p">)</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">xyz_color</span> <span class="o">=</span> <span class="n">xyz_color</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="c1"># xyz ---&gt; lab</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">inv_reference_illuminant</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="mf">1.052156925</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">1.000000000</span><span class="p">]],</span> <span class="p">[[</span><span class="mf">0.918357670</span><span class="p">]]],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="n">input_color</span> <span class="o">=</span> <span class="n">xyz_color</span> <span class="o">*</span> <span class="n">inv_reference_illuminant</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="n">delta</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">29</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="n">delta_square</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta</span>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="n">delta_cube</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">delta_square</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>    <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">delta_square</span><span class="p">)</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a>    <span class="n">input_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">input_color</span> <span class="o">&gt;</span> <span class="n">delta_cube</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">input_color</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">input_color</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">29</span><span class="p">))</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="n">l</span> <span class="o">=</span> <span class="mi">116</span> <span class="o">*</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mi">16</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="n">a</span> <span class="o">=</span> <span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="n">b</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">*</span> <span class="p">(</span><span class="n">input_color</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">input_color</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="n">image_lab</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a>    <span class="k">return</span> <span class="n">image_lab</span>    
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.xyz_to_linear_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">xyz_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.xyz_to_linear_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Definition to convert CIE XYZ space to linear RGB color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>           Input image in XYZ (CIE 1931) color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image_linear_rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Output image in linear RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a><span class="k">def</span><span class="w"> </span><span class="nf">xyz_to_linear_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="sd">    Definition to convert CIE XYZ space to linear RGB color space. Mostly inspired from : Rochester IT Color Conversion Algorithms (https://www.cs.rit.edu/~ncs/color/)</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">    ----------</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    image            : torch.tensor</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">                       Input image in XYZ (CIE 1931) color space [k x 3 x m x n] or [3 x m x n]. Image(s) must be normalized between zero and one.</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    Returns</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a><span class="sd">    -------</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a><span class="sd">    image_linear_rgb : torch.tensor</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a><span class="sd">                       Output image in linear RGB  color space [k x 3 x m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="sd">    """</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="n">a11</span> <span class="o">=</span> <span class="mf">3.240479</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="n">a12</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.537150</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>    <span class="n">a13</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.498535</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">a21</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.969256</span> 
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="n">a22</span> <span class="o">=</span> <span class="mf">1.875992</span> 
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.041556</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">a31</span> <span class="o">=</span> <span class="mf">0.055648</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">a32</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.204043</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>    <span class="n">a33</span> <span class="o">=</span> <span class="mf">1.057311</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">M</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">],</span> 
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                      <span class="p">[</span><span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">],</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a>                      <span class="p">[</span><span class="n">a31</span><span class="p">,</span> <span class="n">a32</span><span class="p">,</span> <span class="n">a33</span><span class="p">]])</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a>    <span class="n">image_linear_rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>    <span class="n">image_linear_rgb</span> <span class="o">=</span> <span class="n">image_linear_rgb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="k">return</span> <span class="n">image_linear_rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.color_conversion.ycrcb_2_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.color_conversion.ycrcb_2_rgb" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Converts an image from YCrCb colourspace to RGB colourspace.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Input image. Should be a YCrCb floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>rgb</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Image converted to RGB colourspace [k x 3 m x n] or [1 x 3 x m x n].</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/color_conversion.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="k">def</span><span class="w"> </span><span class="nf">ycrcb_2_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    Converts an image from YCrCb colourspace to RGB colourspace.</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">    ----------</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">              Input image. Should be a YCrCb floating-point image with values in the range [0, 1]. Should be in NCHW format [3 x m x n] or [k x 3 x m x n].</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">    Returns</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    -------</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="sd">    rgb     : torch.tensor</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a><span class="sd">              Image converted to RGB colourspace [k x 3 m x n] or [1 x 3 x m x n].</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="sd">    """</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>       <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">rgb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">1.403</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.714</span> <span class="o">*</span> \
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.344</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">rgb</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">image</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">1.773</span> <span class="o">*</span> <span class="p">(</span><span class="n">image</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a>    <span class="k">return</span> <span class="n">rgb</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.foveation"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_3d_location_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_3d_location_map</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_3d_location_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the real 3D location that each pixel in an image corresponds to, when displayed to
a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed 3D location map, of size 3xWxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_3d_location_map</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Makes a map of the real 3D location that each pixel in an image corresponds to, when displayed to</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    perpendicular to the viewing direction.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    ----------</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    image_pixel_size        : tuple of ints </span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Returns</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    -------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    map                     : torch.tensor</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                                The computed 3D location map, of size 3xWxH.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    """</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">real_image_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_image_width</span> <span class="o">/</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>                         <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">real_image_width</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">x_coords</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>                              <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">real_image_height</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">y_coords</span> <span class="o">=</span> <span class="n">y_coords</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">z_coords</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="o">*</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">z_coords</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_eccentricity_distance_maps" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_eccentricity_distance_maps</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_eccentricity_distance_maps" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the eccentricity of each pixel in an image for a given fixation point, when displayed to
a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction. Output in radians.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>eccentricity_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed eccentricity map, of size WxH.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>distance_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed distance map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_eccentricity_distance_maps</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Makes a map of the eccentricity of each pixel in an image for a given fixation point, when displayed to</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    a user on a flat screen. Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    perpendicular to the viewing direction. Output in radians.</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    ----------</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    -------</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    eccentricity_map        : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                                The computed eccentricity map, of size WxH.</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    distance_map            : torch.tensor</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                                The computed distance map, of size WxH.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    """</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">real_image_height</span> <span class="o">=</span> <span class="p">(</span><span class="n">real_image_width</span> <span class="o">/</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>                         <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">location_map</span> <span class="o">=</span> <span class="n">make_3d_location_map</span><span class="p">(</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">distance_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">location_map</span><span class="o">*</span><span class="n">location_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="n">direction_map</span> <span class="o">=</span> <span class="n">location_map</span> <span class="o">/</span> <span class="n">distance_map</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">gaze_location_3d</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="p">(</span><span class="n">gaze_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">real_image_width</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="p">(</span><span class="n">gaze_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">real_image_height</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">real_viewing_distance</span><span class="p">])</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">gaze_dir</span> <span class="o">=</span> <span class="n">gaze_location_3d</span> <span class="o">/</span> \
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaze_location_3d</span> <span class="o">*</span> <span class="n">gaze_location_3d</span><span class="p">))</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">gaze_dir</span> <span class="o">=</span> <span class="n">gaze_dir</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">dot_prod_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gaze_dir</span> <span class="o">*</span> <span class="n">direction_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">dot_prod_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="n">dot_prod_map</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">eccentricity_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">dot_prod_map</span><span class="p">)</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">return</span> <span class="n">eccentricity_map</span><span class="p">,</span> <span class="n">distance_map</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_equi_pooling_size_map_lod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_lod" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function is similar to make_equi_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from
to achieve the correct pooling region areas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_angles</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze direction expressed as angles, in radians.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Dimensions of the image in pixels, as a tuple of (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Parameter controlling extent of foveation
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size HxW.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_equi_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="sd">    This function is similar to make_equi_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    to achieve the correct pooling region areas.</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    ----------</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    gaze_angles         : tuple of 2 floats</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">                            Gaze direction expressed as angles, in radians.</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    image_pixel_size    : tuple of 2 ints</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">                            Dimensions of the image in pixels, as a tuple of (height, width)</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="sd">    alpha               : float</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">                            Parameter controlling extent of foveation</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    mode                : str</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">                            Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    Returns</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    -------</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">                                The computed pooling size map, of size HxW.</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">    """</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">pooling_lod</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mf">1e-6</span> <span class="o">+</span> <span class="n">pooling_pixel</span><span class="p">)</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">pooling_lod</span><span class="p">[</span><span class="n">pooling_lod</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="n">pooling_lod</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_equi_pooling_size_map_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_equi_pooling_size_map_pixels" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function makes a map of pooling sizes in pixels, similarly to make_pooling_size_map_pixels, but works on 360 equirectangular images.
Input images are assumed to be in equirectangular form - i.e. if you consider a 3D viewing setup where y is the vertical axis, 
the x location in the image corresponds to rotation around the y axis (yaw), ranging from -pi to pi. The y location in the image
corresponds to pitch, ranging from -pi/2 to pi/2.</p>
<p>In this setup real_image_width and real_viewing_distance have no effect.</p>
<p>Note that rather than a 2D image gaze location in [0,1]^2, the gaze should be specified as gaze angles in [-pi,pi]x[-pi/2,pi/2] (yaw, then pitch).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_angles</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze direction expressed as angles, in radians.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Dimensions of the image in pixels, as a tuple of (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Parameter controlling extent of foveation
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_equi_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    This function makes a map of pooling sizes in pixels, similarly to make_pooling_size_map_pixels, but works on 360 equirectangular images.</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">    Input images are assumed to be in equirectangular form - i.e. if you consider a 3D viewing setup where y is the vertical axis, </span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    the x location in the image corresponds to rotation around the y axis (yaw), ranging from -pi to pi. The y location in the image</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    corresponds to pitch, ranging from -pi/2 to pi/2.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    In this setup real_image_width and real_viewing_distance have no effect.</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    Note that rather than a 2D image gaze location in [0,1]^2, the gaze should be specified as gaze angles in [-pi,pi]x[-pi/2,pi/2] (yaw, then pitch).</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    ----------</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">    gaze_angles         : tuple of 2 floats</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">                            Gaze direction expressed as angles, in radians.</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">    image_pixel_size    : tuple of 2 ints</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">                            Dimensions of the image in pixels, as a tuple of (height, width)</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a><span class="sd">    alpha               : float</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">                            Parameter controlling extent of foveation</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">    mode                : str</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">                            Foveation mode (how pooling size varies with eccentricity). Should be "quadratic" or "linear"</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">    """</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">view_direction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">gaze_angles</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="n">yaw_angle_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="n">yaw_angle_map</span> <span class="o">=</span> <span class="n">yaw_angle_map</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="n">pitch_angle_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="n">pitch_angle_map</span> <span class="o">=</span> <span class="n">pitch_angle_map</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="kc">None</span><span class="p">,</span><span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="n">dir_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yaw_angle_map</span><span class="p">)</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">),</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yaw_angle_map</span><span class="p">)</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_angle_map</span><span class="p">)])</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="c1"># Work out the pooling region diameter in radians</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="n">view_dot_dir</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">view_direction</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">dir_map</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="n">eccentricity</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">view_dot_dir</span><span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="n">pooling_rad</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">eccentricity</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"quadratic"</span><span class="p">:</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">pooling_rad</span> <span class="o">*=</span> <span class="n">eccentricity</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="c1"># The actual pooling region will be an ellipse in the equirectangular image - the length of the major &amp; minor axes</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="c1"># depend on the x &amp; y resolution of the image. We find these two axis lengths (in pixels) and then the area of the ellipse</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="n">pixels_per_rad_x</span> <span class="o">=</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="n">pixels_per_rad_y</span> <span class="o">=</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="n">pooling_axis_x</span> <span class="o">=</span> <span class="n">pooling_rad</span> <span class="o">*</span> <span class="n">pixels_per_rad_x</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">pooling_axis_y</span> <span class="o">=</span> <span class="n">pooling_rad</span> <span class="o">*</span> <span class="n">pixels_per_rad_y</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">pooling_axis_x</span> <span class="o">*</span> <span class="n">pooling_axis_y</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="c1"># Now finally find the length of the side of a square of the same area.</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">area</span><span class="p">))</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="k">return</span> <span class="n">size</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_pooling_size_map_lod" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_pooling_size_map_lod" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This function is similar to make_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from
to achieve the correct pooling region areas.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_pooling_size_map_lod</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">    This function is similar to make_pooling_size_map_pixels, but instead returns a map of LOD levels to sample from</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    to achieve the correct pooling region areas.</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    ----------</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Returns</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">    -------</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">                                The computed pooling size map, of size WxH.</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">    """</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="n">make_pooling_size_map_pixels</span><span class="p">(</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">pooling_lod</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="mf">1e-6</span><span class="o">+</span><span class="n">pooling_pixel</span><span class="p">)</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">pooling_lod</span><span class="p">[</span><span class="n">pooling_lod</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">return</span> <span class="n">pooling_lod</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_pooling_size_map_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_pooling_size_map_pixels" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a map of the pooling size associated with each pixel in an image for a given fixation point, when displayed to
a user on a flat screen. Follows the idea that pooling size (in radians) should be directly proportional to eccentricity
(also in radians). </p>
<p>Assumes the viewpoint is located at the centre of the image, and the screen is 
perpendicular to the viewing direction. Output is the width of the pooling region in pixels.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>gaze_location</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
                    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_pixel_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The size of the image in pixels, as a tuple of form (height, width)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed. Units not important, as long as they
                    are the same as those used for real_viewing_distance
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance from the user's viewpoint to the screen.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pooling_size_map</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed pooling size map, of size WxH.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_pooling_size_map_pixels</span><span class="p">(</span><span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">):</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    Makes a map of the pooling size associated with each pixel in an image for a given fixation point, when displayed to</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    a user on a flat screen. Follows the idea that pooling size (in radians) should be directly proportional to eccentricity</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    (also in radians). </span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    Assumes the viewpoint is located at the centre of the image, and the screen is </span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">    perpendicular to the viewing direction. Output is the width of the pooling region in pixels.</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">    ----------</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    gaze_location           : tuple of floats</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">                                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">                                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    image_pixel_size        : tuple of ints</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">                                The size of the image in pixels, as a tuple of form (height, width)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    real_image_width        : float</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">                                The real width of the image as displayed. Units not important, as long as they</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">                                are the same as those used for real_viewing_distance</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    real_viewing_distance   : float</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                                The real distance from the user's viewpoint to the screen.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Returns</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    -------</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    pooling_size_map        : torch.tensor</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                                The computed pooling size map, of size WxH.</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    """</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>    <span class="n">eccentricity</span><span class="p">,</span> <span class="n">distance_to_pixel</span> <span class="o">=</span> <span class="n">make_eccentricity_distance_maps</span><span class="p">(</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">gaze_location</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="n">eccentricity_centre</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_eccentricity_distance_maps</span><span class="p">(</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">)</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="n">pooling_rad</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">eccentricity</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">"quadratic"</span><span class="p">:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">pooling_rad</span> <span class="o">*=</span> <span class="n">eccentricity</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">angle_min</span> <span class="o">=</span> <span class="n">eccentricity_centre</span> <span class="o">-</span> <span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">angle_max</span> <span class="o">=</span> <span class="n">eccentricity_centre</span> <span class="o">+</span> <span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">major_axis</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angle_max</span><span class="p">)</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">angle_min</span><span class="p">))</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">real_viewing_distance</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="n">minor_axis</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">distance_to_pixel</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">pooling_rad</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">major_axis</span> <span class="o">*</span> <span class="n">minor_axis</span> <span class="o">*</span> <span class="mf">0.25</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="c1"># Should be +ve anyway, but check to ensure we don't take sqrt of negative number</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">area</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">pooling_real</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">pooling_pixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">pooling_real</span> <span class="o">/</span> <span class="n">real_image_width</span><span class="p">)</span> <span class="o">*</span> <span class="n">image_pixel_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="k">return</span> <span class="n">pooling_pixel</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.foveation.make_radial_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_radial_map</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span></code>

<a href="#odak.learn.perception.foveation.make_radial_map" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Makes a simple radial map where each pixel contains distance in pixels from the chosen gaze location.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    Dimensions of the image
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    User's gaze (fixation point) in the image. Should be given as a tuple with normalized
    image coordinates (ranging from 0 to 1)
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/foveation.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_radial_map</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">    Makes a simple radial map where each pixel contains distance in pixels from the chosen gaze location.</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    ----------</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    size    : tuple of ints</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">                Dimensions of the image</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    gaze    : tuple of floats</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">                User's gaze (fixation point) in the image. Should be given as a tuple with normalized</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">                image coordinates (ranging from 0 to 1)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    """</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">pix_gaze</span> <span class="o">=</span> <span class="p">[</span><span class="n">gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">gaze</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">dist_sq</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">rows</span> <span class="o">-</span> <span class="n">pix_gaze</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">cols</span> <span class="o">-</span> <span class="n">pix_gaze</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">radii</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dist_sq</span><span class="p">)</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">return</span> <span class="n">radii</span><span class="o">/</span><span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">radii</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.image_quality_losses"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.image_quality_losses.MSSSIM" class="doc doc-heading">
            <code>MSSSIM</code>


<a href="#odak.learn.perception.image_quality_losses.MSSSIM" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate multi-scale structural similarity index of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">class</span><span class="w"> </span><span class="nc">MSSSIM</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    A class to calculate multi-scale structural similarity index of an image with respect to a ground truth image.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    '''</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">MSSSIM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        ----------</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        predictions : torch.tensor</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                      The predicted images.</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">        targets     : torch.tensor</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                      The ground truth images.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        Returns</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        -------</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        result      : torch.tensor </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                      The computed MS-SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        """</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">multiscale_structural_similarity_index_measure</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">l_MSSSIM</span> <span class="o">=</span> <span class="n">multiscale_structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_range</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">return</span> <span class="n">l_MSSSIM</span>  
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'MS-SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.image_quality_losses.MSSSIM.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.image_quality_losses.MSSSIM.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
              (<code><span title="torch.tensor">tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed MS-SSIM value if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    ----------</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    predictions : torch.tensor</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                  The predicted images.</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    targets     : torch.tensor</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">                  The ground truth images.</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    Returns</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    -------</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">    result      : torch.tensor </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">                  The computed MS-SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">    """</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">multiscale_structural_similarity_index_measure</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">l_MSSSIM</span> <span class="o">=</span> <span class="n">multiscale_structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">data_range</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="k">return</span> <span class="n">l_MSSSIM</span>  
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'MS-SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.image_quality_losses.PSNR" class="doc doc-heading">
            <code>PSNR</code>


<a href="#odak.learn.perception.image_quality_losses.PSNR" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">PSNR</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    A class to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    '''</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">PSNR</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">        ----------</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                        Image to be tested.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                        Ground truth image.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        peak_value    : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                        Peak value that given tensors could have.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Returns</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        -------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                        Peak-signal-to-noise ratio.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        """</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="n">mse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">targets</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>        <span class="n">result</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">peak_value</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.image_quality_losses.PSNR.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

<a href="#odak.learn.perception.image_quality_losses.PSNR.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Image to be tested.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Ground truth image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>peak_value</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Peak value that given tensors could have.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>Peak-signal-to-noise ratio.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">peak_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    A function to calculate peak-signal-to-noise ratio of an image with respect to a ground truth image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    ----------</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                    Image to be tested.</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                    Ground truth image.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    peak_value    : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                    Peak value that given tensors could have.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Returns</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    -------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                    Peak-signal-to-noise ratio.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    """</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">mse</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">targets</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">result</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">peak_value</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">))</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.image_quality_losses.SSIM" class="doc doc-heading">
            <code>SSIM</code>


<a href="#odak.learn.perception.image_quality_losses.SSIM" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>


        <p>A class to calculate structural similarity index of an image with respect to a ground truth image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="k">class</span><span class="w"> </span><span class="nc">SSIM</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="sd">'''</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    A class to calculate structural similarity index of an image with respect to a ground truth image.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    '''</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SSIM</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        ----------</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        predictions : torch.tensor</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                      The predicted images.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        targets     : torch.tensor</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                      The ground truth images.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        Returns</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        -------</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        result      : torch.tensor </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                      The computed SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        """</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">structural_similarity_index_measure</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="n">l_SSIM</span> <span class="o">=</span> <span class="n">structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">return</span> <span class="n">l_SSIM</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.image_quality_losses.SSIM.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.image_quality_losses.SSIM.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
              (<code><span title="torch.tensor">tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>      The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed SSIM value if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/image_quality_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    ----------</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    predictions : torch.tensor</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                  The predicted images.</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    targets     : torch.tensor</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                  The ground truth images.</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    -------</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    result      : torch.tensor </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                  The computed SSIM value if successful, otherwise 0.0.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    """</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">torchmetrics.functional.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">structural_similarity_index_measure</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">l_SSIM</span> <span class="o">=</span> <span class="n">structural_similarity_index_measure</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="k">return</span> <span class="n">l_SSIM</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'SSIM failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.learned_perceptual_losses"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.learned_perceptual_losses.CVVDP" class="doc doc-heading">
            <code>CVVDP</code>


<a href="#odak.learn.perception.learned_perceptual_losses.CVVDP" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">CVVDP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">        Initializes the CVVDP model with a specified device.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">        ----------</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">        device   : torch.device</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">                    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">        """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">CVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">pycvvdp</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span> <span class="o">=</span> <span class="n">pycvvdp</span><span class="o">.</span><span class="n">cvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP is missing, consider installing by running "pip install -U git+https://github.com/gfxdisp/ColorVideoVDP"'</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        targets    h  : torch.tensor</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        dim_order     : str</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        Returns</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        -------</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                        The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        """</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="n">l_ColorVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="k">return</span> <span class="n">l_ColorVideoVDP</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.CVVDP.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the CVVDP model with a specified device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Initializes the CVVDP model with a specified device.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    ----------</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    device   : torch.device</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">                The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    """</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">CVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">pycvvdp</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span> <span class="o">=</span> <span class="n">pycvvdp</span><span class="o">.</span><span class="n">cvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP is missing, consider installing by running "pip install -U git+https://github.com/gfxdisp/ColorVideoVDP"'</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.CVVDP.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span><span class="o">=</span><span class="s1">'BCHW'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.CVVDP.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dim_order</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    targets    h  : torch.tensor</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    dim_order     : str</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                    The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Returns</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    -------</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                    The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    """</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">l_ColorVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="k">return</span> <span class="n">l_ColorVideoVDP</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'ColorVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.learned_perceptual_losses.FVVDP" class="doc doc-heading">
            <code>FVVDP</code>


<a href="#odak.learn.perception.learned_perceptual_losses.FVVDP" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">FVVDP</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Initializes the FVVDP model with a specified device.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        ----------</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        device   : torch.device</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        """</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">FVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">pyfvvdp</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span> <span class="o">=</span> <span class="n">pyfvvdp</span><span class="o">.</span><span class="n">fvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">heatmap</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP is missing, consider installing by running "pip install pyfvvdp"'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        ----------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        dim_order     : str</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Returns</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        -------</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                          The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        """</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">l_FovVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="k">return</span> <span class="n">l_FovVideoVDP</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.FVVDP.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the FVVDP model with a specified device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Initializes the FVVDP model with a specified device.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    ----------</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    device   : torch.device</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                The device (CPU/GPU) on which the computations will be performed. Defaults to CPU.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    """</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">FVVDP</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">pyfvvdp</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span> <span class="o">=</span> <span class="n">pyfvvdp</span><span class="o">.</span><span class="n">fvvdp</span><span class="p">(</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">'standard_4k'</span><span class="p">,</span> <span class="n">heatmap</span> <span class="o">=</span> <span class="s1">'none'</span><span class="p">,</span> <span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP is missing, consider installing by running "pip install pyfvvdp"'</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.FVVDP.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span><span class="o">=</span><span class="s1">'BCHW'</span><span class="p">)</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.FVVDP.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dim_order</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="s1">'BCHW'</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    ----------</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    dim_order     : str</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                    The dimension order of the input images. Defaults to 'BCHW' (channels, height, width).</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    Returns</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">    -------</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">                      The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    """</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">l_FovVideoVDP</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fvvdp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">dim_order</span> <span class="o">=</span> <span class="n">dim_order</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">return</span> <span class="n">l_FovVideoVDP</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'FovVideoVDP failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.learned_perceptual_losses.LPIPS" class="doc doc-heading">
            <code>LPIPS</code>


<a href="#odak.learn.perception.learned_perceptual_losses.LPIPS" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>









              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="k">class</span><span class="w"> </span><span class="nc">LPIPS</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="nb">super</span><span class="p">(</span><span class="n">LPIPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="kn">import</span><span class="w"> </span><span class="nn">torchmetrics</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span> <span class="o">=</span> <span class="n">torchmetrics</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">lpip</span><span class="o">.</span><span class="n">LearnedPerceptualImagePatchSimilarity</span><span class="p">(</span><span class="n">net_type</span> <span class="o">=</span> <span class="s1">'squeeze'</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'torchmetrics is missing, consider installing by running "pip install torchmetrics"'</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        ----------</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        predictions   : torch.tensor</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                        The predicted images.</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        targets       : torch.tensor</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">                        The ground truth images.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Returns</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        -------</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        result        : torch.tensor</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                        The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        """</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">predictions</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">targets</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>                <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_image</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_target</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">l_LPIPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span><span class="p">(</span><span class="n">lpips_image</span><span class="p">,</span> <span class="n">lpips_target</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">return</span> <span class="n">l_LPIPS</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'LPIPS failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.LPIPS.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</p>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    Initializes the LPIPS (Learned Perceptual Image Patch Similarity) model.</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    """</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">LPIPS</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">torchmetrics</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span> <span class="o">=</span> <span class="n">torchmetrics</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">lpip</span><span class="o">.</span><span class="n">LearnedPerceptualImagePatchSimilarity</span><span class="p">(</span><span class="n">net_type</span> <span class="o">=</span> <span class="s1">'squeeze'</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'torchmetrics is missing, consider installing by running "pip install torchmetrics"'</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.learned_perceptual_losses.LPIPS.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span></code>

<a href="#odak.learn.perception.learned_perceptual_losses.LPIPS.forward" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>predictions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The predicted images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>targets</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        The ground truth images.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss if successful, otherwise 0.0.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/learned_perceptual_losses.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    ----------</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    predictions   : torch.tensor</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">                    The predicted images.</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    targets       : torch.tensor</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">                    The ground truth images.</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Returns</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    -------</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    result        : torch.tensor</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                    The computed loss if successful, otherwise 0.0.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    """</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">targets</span> <span class="o">=</span> <span class="n">targets</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">predictions</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">targets</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">if</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">lpips_image</span> <span class="o">=</span> <span class="n">lpips_image</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="n">lpips_target</span> <span class="o">=</span> <span class="n">lpips_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">lpips_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_image</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">lpips_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">lpips_target</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clamp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">l_LPIPS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lpips</span><span class="p">(</span><span class="n">lpips_image</span><span class="p">,</span> <span class="n">lpips_target</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">return</span> <span class="n">l_LPIPS</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">'LPIPS failed to compute.'</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.metameric_loss"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.metameric_loss.MetamericLoss" class="doc doc-heading">
            <code>MetamericLoss</code>


<a href="#odak.learn.perception.metameric_loss.MetamericLoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>MetamericLoss</code> class provides a perceptual loss function.</p>
<p>Rather than exactly match the source image to the target, it tries to ensure the source is a <em>metamer</em> to the target image.</p>
<p>Its interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamericLoss</span><span class="p">():</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    The `MetamericLoss` class provides a perceptual loss function.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    Rather than exactly match the source image to the target, it tries to ensure the source is a *metamer* to the target image.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Its interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    """</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>                 <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>                 <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        ----------</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                    Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    too high will slow down the calculation a lot.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    Increasing this will increase runtime.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        use_l2_foveal_loss      : bool </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    If true, for all the pixels that have pooling size 1 pixel in the </span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                    largest scale will use direct L2 against target rather than pooling over pyramid levels.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                                    In practice this gives better results when the loss is used for holography.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        fovea_weight            : float </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    A weight to apply to the foveal region if use_l2_foveal_loss is set to True.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        use_radial_weight       : bool </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    If True, will apply a radial weighting when calculating the difference between</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                                    the source and target stats maps. This weights stats closer to the fovea more than those</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                    further away.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        use_fullres_l0          : bool </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                    If true, stats for the lowpass residual are replaced with blurred versions</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                    of the full-resolution source and target images.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        """</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span> <span class="o">=</span> <span class="n">use_l2_foveal_loss</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">=</span> <span class="n">fovea_weight</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span> <span class="o">=</span> <span class="n">use_radial_weight</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="o">=</span> <span class="n">use_fullres_l0</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="s2">"Can't use use_fullres_l0 and use_l2_foveal_loss options together in MetamericLoss!"</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>                       <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">or</span> \
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="ow">or</span>\
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">filt_h0</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="n">SpatialSteerablePyramid</span><span class="p">(</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"cropped"</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="p">[</span><span class="n">RadiallyVaryingBlur</span><span class="p">()</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)]</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">find_stats</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">blur</span><span class="p">):</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">image_means</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">image_meansq</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="o">*</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                                     <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>            <span class="n">image_vars</span> <span class="o">=</span> <span class="n">image_meansq</span> <span class="o">-</span> <span class="p">(</span><span class="n">image_means</span><span class="o">*</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">image_vars</span><span class="p">[</span><span class="n">image_vars</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">image_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">image_vars</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_means</span><span class="p">)):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image means!"</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_std</span><span class="p">)):</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_std</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image stdevs!"</span><span class="p">)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span><span class="p">:</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">blur</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>                <span class="k">if</span> <span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>                    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image_means</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>                <span class="n">matte</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>                <span class="n">matte</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="k">return</span> <span class="n">image_means</span> <span class="o">*</span> <span class="n">matte</span><span class="p">,</span> <span class="n">image_std</span> <span class="o">*</span> <span class="n">matte</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">return</span> <span class="n">image_means</span><span class="p">,</span> <span class="n">image_std</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="n">output_stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">image_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="n">base_mask</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span><span class="p">))</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">base_mask</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span> <span class="o">=</span> <span class="n">base_mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="c1">#self.fovea_mask     = torch.nn.functional.interpolate(self.fovea_mask, scale_factor=0.125, mode="area")</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="c1">#self.fovea_mask     = torch.nn.functional.interpolate(self.fovea_mask, size=(image.size(-2), image.size(-1)), mode="bilinear")</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">periphery_mask</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">periphery_mask</span> <span class="o">=</span> <span class="n">periphery_mask</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>                <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>                    <span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="n">l</span><span class="p">])</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                    <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>                <span class="n">periphery_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>                    <span class="n">periphery_mask</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">*</span> <span class="n">periphery_mask</span><span class="p">)</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span><span class="p">:</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">blurs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">blur</span><span class="p">(</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">gaze</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">return</span> <span class="n">output_stats</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metameric_loss_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span><span class="p">:</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="n">radii</span> <span class="o">=</span> <span class="n">make_radial_map</span><span class="p">(</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span> <span class="n">gaze</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="o">-</span> <span class="p">(</span><span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span> <span class="o">*</span> <span class="n">radii</span><span class="p">)</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">a</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>                <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">weights</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">weights</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">loss</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualise_loss_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_stats</span><span class="p">):</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">loss_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,)</span> <span class="o">+</span> <span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">stats</span> <span class="o">-</span> <span class="n">target_stats</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">stat_mse_map</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">loss_map</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">:],</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="n">loss_map</span> <span class="o">+=</span> <span class="n">stat_mse_map</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_map</span> <span class="o">=</span> <span class="n">loss_map</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Calculates the Metameric Loss.</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        ----------</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        image_colorspace    : str</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">                                The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                                accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        gaze                : list</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">                                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">        visualise_loss      : bool</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">                                Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        Returns</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        -------</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">        """</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="n">target</span><span class="p">,</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>            <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>            <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>            <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="p">)</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">peripheral_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="n">foveal_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="c1"># New weighting - evenly weight fovea and periphery.</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="n">peripheral_loss</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">*</span> <span class="n">foveal_loss</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metameric_loss.MetamericLoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s1">'RGB'</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metameric_loss.MetamericLoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metameric Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_colorspace</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The current colorspace of your image and target. Ignored if input does not have 3 channels.
                accepted values: RGB, YCrCb.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>visualise_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Shows a heatmap indicating which parts of the image contributed most to the loss.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    Calculates the Metameric Loss.</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    ----------</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    image_colorspace    : str</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">                            The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                            accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    gaze                : list</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">                            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    visualise_loss      : bool</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a><span class="sd">                            Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">    Returns</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">    -------</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    """</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">target</span><span class="p">,</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">real_image_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="p">)</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">peripheral_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">foveal_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_mask</span><span class="o">*</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="c1"># New weighting - evenly weight fovea and periphery.</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">peripheral_loss</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">*</span> <span class="n">foveal_loss</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="k">return</span> <span class="n">loss</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metameric_loss.MetamericLoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metameric_loss.MetamericLoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of levels of the steerable pyramid. Note that the image is padded
                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                    too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                    Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_l2_foveal_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, for all the pixels that have pooling size 1 pixel in the 
                    largest scale will use direct L2 against target rather than pooling over pyramid levels.
                    In practice this gives better results when the loss is used for holography.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>fovea_weight</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    A weight to apply to the foveal region if use_l2_foveal_loss is set to True.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_radial_weight</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If True, will apply a radial weighting when calculating the difference between
                    the source and target stats maps. This weights stats closer to the fovea more than those
                    further away.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>use_fullres_l0</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, stats for the lowpass residual are replaced with blurred versions
                    of the full-resolution source and target images.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>             <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fovea_weight</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">use_radial_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>             <span class="n">use_fullres_l0</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    ----------</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                too high will slow down the calculation a lot.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                Increasing this will increase runtime.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    use_l2_foveal_loss      : bool </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                If true, for all the pixels that have pooling size 1 pixel in the </span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                largest scale will use direct L2 against target rather than pooling over pyramid levels.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                                In practice this gives better results when the loss is used for holography.</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    fovea_weight            : float </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                A weight to apply to the foveal region if use_l2_foveal_loss is set to True.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    use_radial_weight       : bool </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                If True, will apply a radial weighting when calculating the difference between</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">                                the source and target stats maps. This weights stats closer to the fovea more than those</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                further away.</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    use_fullres_l0          : bool </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                If true, stats for the lowpass residual are replaced with blurred versions</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                                of the full-resolution source and target images.</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    """</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">blurs</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span> <span class="o">=</span> <span class="n">use_l2_foveal_loss</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">fovea_weight</span> <span class="o">=</span> <span class="n">fovea_weight</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_radial_weight</span> <span class="o">=</span> <span class="n">use_radial_weight</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="o">=</span> <span class="n">use_fullres_l0</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fullres_l0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_l2_foveal_loss</span><span class="p">:</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="s2">"Can't use use_fullres_l0 and use_l2_foveal_loss options together in MetamericLoss!"</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.metameric_loss_uniform"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.metameric_loss_uniform.MetamericLossUniform" class="doc doc-heading">
            <code>MetamericLossUniform</code>


<a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>Measures metameric loss between a given image and a metamer of the given target image.
This variant of the metameric loss is not foveated - it applies uniform pooling sizes to the whole input image.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamericLossUniform</span><span class="p">():</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Measures metameric loss between a given image and a metamer of the given target image.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    This variant of the metameric loss is not foveated - it applies uniform pooling sizes to the whole input image.</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    """</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        pooling_size            : int</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                  Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                  Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                  so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                                  too high will slow down the calculation a lot.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                  Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                  Increasing this will increase runtime.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        """</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">):</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> \
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="ow">or</span> \
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="ow">or</span>\
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">filt_h0</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="n">SpatialSteerablePyramid</span><span class="p">(</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>                <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"cropped"</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">find_stats</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="n">image_means</span> <span class="o">=</span> <span class="n">uniform_blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="n">image_meansq</span> <span class="o">=</span> <span class="n">uniform_blur</span><span class="p">(</span><span class="n">image_pyr_level</span><span class="o">*</span><span class="n">image_pyr_level</span><span class="p">,</span> <span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="n">image_vars</span> <span class="o">=</span> <span class="n">image_meansq</span> <span class="o">-</span> <span class="p">(</span><span class="n">image_means</span><span class="o">*</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">image_vars</span><span class="p">[</span><span class="n">image_vars</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-7</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="n">image_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">image_vars</span><span class="p">)</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_means</span><span class="p">)):</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_means</span><span class="p">)</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image means!"</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">image_std</span><span class="p">)):</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">image_std</span><span class="p">)</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"NaN in image stdevs!"</span><span class="p">)</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="k">return</span> <span class="n">image_means</span><span class="p">,</span> <span class="n">image_std</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="n">output_stats</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">image_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">curr_pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">],</span> <span class="n">curr_pooling_size</span><span class="p">)</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">means</span><span class="p">,</span> <span class="n">variances</span> <span class="o">=</span> <span class="n">find_stats</span><span class="p">(</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>                    <span class="n">image_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s1">'b'</span><span class="p">][</span><span class="n">o</span><span class="p">],</span> <span class="n">curr_pooling_size</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variances</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">curr_pooling_size</span> <span class="o">/=</span> <span class="mi">2</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">output_stats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">return</span> <span class="n">output_stats</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">metameric_loss_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">,</span> <span class="n">statsmap_b</span><span class="p">):</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">loss</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="n">loss</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">statsmap_a</span><span class="p">)</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">visualise_loss_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_stats</span><span class="p">):</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">loss_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)):</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">stats</span> <span class="o">=</span> <span class="n">image_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">stats</span> <span class="o">-</span> <span class="n">target_stats</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">stat_mse_map</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">stat_mse_map</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">loss_map</span><span class="o">.</span><span class="n">size</span><span class="p">(</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">loss_map</span> <span class="o">+=</span> <span class="n">stat_mse_map</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_map</span> <span class="o">=</span> <span class="n">loss_map</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        Calculates the Metameric Loss.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        ----------</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        target              : torch.tensor</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">                                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        image_colorspace    : str</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                                The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                                accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        visualise_loss      : bool</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                                Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        Returns</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        -------</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        loss                : torch.tensor</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                The computed loss.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLossUniform"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)):</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>                <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Target of incorrect type"</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">                  Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        Returns</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">        -------</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">        metamer : torch.tensor</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">                  The generated metamer image</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        """</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>            <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                    <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>        <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">return</span> <span class="n">metamer</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s1">'RGB'</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metameric Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>image_colorspace</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The current colorspace of your image and target. Ignored if input does not have 3 channels.
                accepted values: RGB, YCrCb.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>visualise_loss</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Shows a heatmap indicating which parts of the image contributed most to the loss.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">image_colorspace</span><span class="o">=</span><span class="s2">"RGB"</span><span class="p">,</span> <span class="n">visualise_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    Calculates the Metameric Loss.</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">    ----------</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                            Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    target              : torch.tensor</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">                            Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    image_colorspace    : str</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">                            The current colorspace of your image and target. Ignored if input does not have 3 channels.</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                            accepted values: RGB, YCrCb.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    visualise_loss      : bool</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">                            Shows a heatmap indicating which parts of the image contributed most to the loss. </span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Returns</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    -------</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    loss                : torch.tensor</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                            The computed loss.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    """</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamericLossUniform"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="c1"># If input is RGB, convert to YCrCb.</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">image_colorspace</span> <span class="o">==</span> <span class="s2">"RGB"</span><span class="p">:</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">):</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">)):</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">image_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="k">if</span> <span class="n">visualise_loss</span><span class="p">:</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">visualise_loss_map</span><span class="p">(</span><span class="n">image_stats</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss_stats</span><span class="p">(</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="n">image_stats</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_stats</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="k">return</span> <span class="n">loss</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">"Target of incorrect type"</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>pooling_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Number of levels of the steerable pyramid. Note that the image is padded
                  so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                  too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                  Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                  Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">pooling_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    pooling_size            : int</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                              Pooling size, in pixels. For example 32 will pool over 32x32 blocks of the image.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                              Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                              so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">                              too high will slow down the calculation a lot.</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                              Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                              Increasing this will increase runtime.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    """</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span> <span class="o">=</span> <span class="n">pooling_size</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span> <span class="o">=</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">n_orientations</span> <span class="o">=</span> <span class="n">n_orientations</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.gen_metamer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_metamer</span><span class="p">(</span><span class="n">image</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metameric_loss_uniform.MetamericLossUniform.gen_metamer" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Generates a metamer for an image, following the method in <a href="https://dl.acm.org/doi/abs/10.1145/3450626.3459943">this paper</a>
This function can be used on its own to generate a metamer for a desired image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>metamer</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The generated metamer image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metameric_loss_uniform.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">    Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">    This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    ----------</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">              Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    Returns</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="sd">    -------</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    metamer : torch.tensor</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">              The generated metamer image</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    """</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pooling_size</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>        <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">return</span> <span class="n">metamer</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.metamer_mse_loss"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.metamer_mse_loss.MetamerMSELoss" class="doc doc-heading">
            <code>MetamerMSELoss</code>


<a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>MetamerMSELoss</code> class provides a perceptual loss function. This generates a metamer for the target image, and then optimises the source image to be the same as this target image metamer.</p>
<p>Please note this is different to <code>MetamericLoss</code> which optimises the source image to be any metamer of the target image.</p>
<p>Its interface is similar to other <code>pytorch</code> loss functions, but note that the gaze location must be provided in addition to the source and target images.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">MetamerMSELoss</span><span class="p">():</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    The `MetamerMSELoss` class provides a perceptual loss function. This generates a metamer for the target image, and then optimises the source image to be the same as this target image metamer.</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    Please note this is different to `MetamericLoss` which optimises the source image to be any metamer of the target image.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Its interface is similar to other `pytorch` loss functions, but note that the gaze location must be provided in addition to the source and target images.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    """</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>                 <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>                 <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        n_pyramid_levels        : int </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                    Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    too high will slow down the calculation a lot.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        n_orientations          : int </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                    Increasing this will increase runtime.</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">                                    The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        """</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="n">MetamericLoss</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                            <span class="n">real_viewing_distance</span><span class="o">=</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                            <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="n">n_pyramid_levels</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        gaze    : list</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Returns</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        -------</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        metamer : torch.tensor</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">                The generated metamer image</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">        """</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                    <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">return</span> <span class="n">metamer</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">        </span><span class="sd">""" </span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        Calculates the Metamer MSE Loss.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        ----------</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                  Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        target  : torch.tensor</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">                  Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        gaze    : list</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">                   Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        Returns</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">        -------</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        loss    : torch.tensor</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">                  The computed loss.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        """</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamerMSELoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_metamer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="k">return</span> <span class="bp">self</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__call__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span></code>

<a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__call__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Calculates the Metamer MSE Loss.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>  Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>   Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>loss</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The computed loss.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">gaze</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]):</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    Calculates the Metamer MSE Loss.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    ----------</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">              Image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    target  : torch.tensor</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">              Ground truth target image to compute loss for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    gaze    : list</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">               Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">    Returns</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    -------</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    loss    : torch.tensor</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">              The computed loss.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    """</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">check_loss_inputs</span><span class="p">(</span><span class="s2">"MetamerMSELoss"</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="c1"># Pad image and target if necessary</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_metamer</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of levels of the steerable pyramid. Note that the image is padded
                    so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value
                    too high will slow down the calculation a lot.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.
                    Increasing this will increase runtime.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The gaze argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">),</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>             <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>             <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    ----------</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    n_pyramid_levels        : int </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">                                Number of levels of the steerable pyramid. Note that the image is padded</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                so that both height and width are multiples of 2^(n_pyramid_levels), so setting this value</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                too high will slow down the calculation a lot.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    n_orientations          : int </span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Number of orientations in the steerable pyramid. Can be 1, 2, 4 or 6.</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">                                Increasing this will increase runtime.</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                If true, run the loss in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">                                The gaze argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    """</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">target_metamer</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span> <span class="o">=</span> <span class="n">MetamericLoss</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="n">real_image_width</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>                                        <span class="n">real_viewing_distance</span><span class="o">=</span><span class="n">real_viewing_distance</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>                                        <span class="n">n_pyramid_levels</span><span class="o">=</span><span class="n">n_pyramid_levels</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="n">n_orientations</span><span class="p">,</span> <span class="n">use_l2_foveal_loss</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="n">equi</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="o">=</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.metamer_mse_loss.MetamerMSELoss.gen_metamer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">gen_metamer</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">)</span></code>

<a href="#odak.learn.perception.metamer_mse_loss.MetamerMSELoss.gen_metamer" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Generates a metamer for an image, following the method in <a href="https://dl.acm.org/doi/abs/10.1145/3450626.3459943">this paper</a>
This function can be used on its own to generate a metamer for a desired image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gaze</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>metamer</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The generated metamer image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/metamer_mse_loss.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_metamer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="p">):</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    Generates a metamer for an image, following the method in [this paper](https://dl.acm.org/doi/abs/10.1145/3450626.3459943)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">    This function can be used on its own to generate a metamer for a desired image.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    ----------</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Image to compute metamer for. Should be an RGB image in NCHW format (4 dimensions)</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">    gaze    : list</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">            Gaze location in the image, in normalized image coordinates (range [0, 1]) relative to the top left of the image.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    Returns</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    -------</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    metamer : torch.tensor</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            The generated metamer image</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">    """</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">rgb_2_ycrcb</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">image_size</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">target_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">calc_statsmaps</span><span class="p">(</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">image</span><span class="p">,</span> <span class="n">gaze</span><span class="o">=</span><span class="n">gaze</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">alpha</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="n">target_means</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="n">target_stdevs</span> <span class="o">=</span> <span class="n">target_stats</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="n">noise_image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">noise_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">noise_image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="n">input_pyramid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">construct_pyramid</span><span class="p">(</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="n">image</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">n_pyramid_levels</span><span class="p">)</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">match_level</span><span class="p">(</span><span class="n">input_level</span><span class="p">,</span> <span class="n">target_mean</span><span class="p">,</span> <span class="n">target_std</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">level</span> <span class="o">=</span> <span class="n">input_level</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">level</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="n">input_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">level</span> <span class="o">*</span> <span class="n">level</span><span class="p">))</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="c1"># Safeguard against divide by zero</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">input_std</span><span class="p">[</span><span class="n">input_std</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">level</span> <span class="o">/=</span> <span class="n">input_std</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">level</span> <span class="o">*=</span> <span class="n">target_std</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">level</span> <span class="o">+=</span> <span class="n">target_mean</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="k">return</span> <span class="n">level</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">nbands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"b"</span><span class="p">])</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">noise_pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">"h"</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">noise_pyramid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbands</span><span class="p">):</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">match_level</span><span class="p">(</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="n">noise_pyramid</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">target_means</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">],</span> <span class="n">target_stdevs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">l</span> <span class="o">*</span> <span class="n">nbands</span> <span class="o">+</span> <span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="n">noise_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"l"</span><span class="p">]</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metameric_loss</span><span class="o">.</span><span class="n">pyramid_maker</span><span class="o">.</span><span class="n">reconstruct_from_pyramid</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>        <span class="n">noise_pyramid</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">ycrcb_2_rgb</span><span class="p">(</span><span class="n">metamer</span><span class="p">)</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="c1"># Crop to remove any padding</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">metamer</span> <span class="o">=</span> <span class="n">metamer</span><span class="p">[:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">:</span><span class="n">image_size</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="k">return</span> <span class="n">metamer</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.radially_varying_blur"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur" class="doc doc-heading">
            <code>RadiallyVaryingBlur</code>


<a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>The <code>RadiallyVaryingBlur</code> class provides a way to apply a radially varying blur to an image. Given a gaze location and information about the image and foveation, it applies a blur that will achieve the proper pooling size. The pooling size is chosen to appear the same at a range of display sizes and viewing distances, for a given <code>alpha</code> parameter value. For more information on how the pooling sizes are computed, please see <a href="">link coming soon</a>.</p>
<p>The blur is accelerated by generating and sampling from MIP maps of the input image.</p>
<p>This class caches the foveation information. This means that if it is run repeatedly with the same foveation parameters, gaze location and image size (e.g. in an optimisation loop) it won't recalculate the pooling maps.</p>
<p>If you are repeatedly applying blur to images of different sizes (e.g. a pyramid) for best performance use one instance of this class per image size.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/radially_varying_blur.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6">  6</a></span>
<span class="normal"><a href="#__codelineno-0-7">  7</a></span>
<span class="normal"><a href="#__codelineno-0-8">  8</a></span>
<span class="normal"><a href="#__codelineno-0-9">  9</a></span>
<span class="normal"><a href="#__codelineno-0-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-0-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-0-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-0-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-0-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-0-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-0-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-0-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-0-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-0-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-0-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-0-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-0-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">RadiallyVaryingBlur</span><span class="p">():</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">""" </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    The `RadiallyVaryingBlur` class provides a way to apply a radially varying blur to an image. Given a gaze location and information about the image and foveation, it applies a blur that will achieve the proper pooling size. The pooling size is chosen to appear the same at a range of display sizes and viewing distances, for a given `alpha` parameter value. For more information on how the pooling sizes are computed, please see [link coming soon]().</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    The blur is accelerated by generating and sampling from MIP maps of the input image.</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    This class caches the foveation information. This means that if it is run repeatedly with the same foveation parameters, gaze location and image size (e.g. in an optimisation loop) it won't recalculate the pooling maps.</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    If you are repeatedly applying blur to images of different sizes (e.g. a pyramid) for best performance use one instance of this class per image size.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    """</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">blur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Apply the radially varying blur to an image.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        image                   : torch.tensor</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                    The image to blur, in NCHW format.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        alpha                   : float</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                    parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        real_image_width        : float </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                    The real width of the image as displayed to the user.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                    Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        real_viewing_distance   : float </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                    The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                    Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                    Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        centre                  : tuple of floats</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                                    The centre of the radially varying blur (the gaze location).</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                    Should be a tuple of floats containing normalised image coordinates in range [0,1]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                    In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        mode                    : str </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                    as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        equi                    : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                    If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                    The centre argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        Returns</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        -------</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        output                  : torch.tensor</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                    The blurred image</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="c1"># LOD map caching</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>\
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">size</span> <span class="ow">or</span>\
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>\
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="n">alpha</span> <span class="ow">or</span>\
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">!=</span> <span class="n">real_image_width</span> <span class="ow">or</span>\
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">!=</span> <span class="n">real_viewing_distance</span> <span class="ow">or</span>\
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">!=</span> <span class="n">centre</span> <span class="ow">or</span>\
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span> <span class="ow">or</span>\
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">!=</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>                    <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                    <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="n">mipmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="k">while</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>            <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                    <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="k">for</span> <span class="n">l2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                    <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                        <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="n">blended_levels</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="n">blended_levels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                    <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">*</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">output</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">blended_levels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="k">return</span> <span class="n">output</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur.blur" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">blur</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'quadratic'</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.radially_varying_blur.RadiallyVaryingBlur.blur" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Apply the radially varying blur to an image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The image to blur, in NCHW format.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>alpha</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    parameter controlling foveation - larger values mean bigger pooling regions.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_image_width</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real width of the image as displayed to the user.
                    Units don't matter as long as they are the same as for real_viewing_distance.
                    Ignored in equirectangular mode (equi==True)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>real_viewing_distance</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The real distance of the observer's eyes to the image plane.
                    Units don't matter as long as they are the same as for real_image_width.
                    Ignored in equirectangular mode (equi==True)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>centre</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    The centre of the radially varying blur (the gaze location).
                    Should be a tuple of floats containing normalised image coordinates in range [0,1]
                    In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>mode</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow
                    as you move away from the fovea. We got best results with "quadratic".
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>equi</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular
                    format 360 image. The settings real_image_width and real_viewing distance are ignored.
                    The centre argument is instead interpreted as gaze angles, and should be in the range
                    [-pi,pi]x[-pi/2,pi]
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>output</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The blurred image</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/radially_varying_blur.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-0-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-0-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-0-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-0-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-0-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-0-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-0-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-0-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-0-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">blur</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_image_width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"quadratic"</span><span class="p">,</span> <span class="n">equi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    Apply the radially varying blur to an image.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    ----------</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    image                   : torch.tensor</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">                                The image to blur, in NCHW format.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    alpha                   : float</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                                parameter controlling foveation - larger values mean bigger pooling regions.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    real_image_width        : float </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                                The real width of the image as displayed to the user.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">                                Units don't matter as long as they are the same as for real_viewing_distance.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">                                Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    real_viewing_distance   : float </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">                                The real distance of the observer's eyes to the image plane.</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">                                Units don't matter as long as they are the same as for real_image_width.</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">                                Ignored in equirectangular mode (equi==True)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">    centre                  : tuple of floats</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">                                The centre of the radially varying blur (the gaze location).</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">                                Should be a tuple of floats containing normalised image coordinates in range [0,1]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">                                In equirectangular mode this should be yaw &amp; pitch angles in [-pi,pi]x[-pi/2,pi/2]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    mode                    : str </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">                                Foveation mode, either "quadratic" or "linear". Controls how pooling regions grow</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                                as you move away from the fovea. We got best results with "quadratic".</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    equi                    : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                If true, run the blur function in equirectangular mode. The input is assumed to be an equirectangular</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                format 360 image. The settings real_image_width and real_viewing distance are ignored.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                                The centre argument is instead interpreted as gaze angles, and should be in the range</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                [-pi,pi]x[-pi/2,pi]</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Returns</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    -------</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    output                  : torch.tensor</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                The blurred image</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    """</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="c1"># LOD map caching</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span>\
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">size</span> <span class="ow">or</span>\
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">or</span>\
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">!=</span> <span class="n">alpha</span> <span class="ow">or</span>\
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">!=</span> <span class="n">real_image_width</span> <span class="ow">or</span>\
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">!=</span> <span class="n">real_viewing_distance</span> <span class="ow">or</span>\
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">!=</span> <span class="n">centre</span> <span class="ow">or</span>\
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="n">mode</span> <span class="ow">or</span>\
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">!=</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">equi</span><span class="p">:</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">real_image_width</span><span class="p">,</span> <span class="n">real_viewing_distance</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="n">make_equi_pooling_size_map_lod</span><span class="p">(</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">centre</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_channels</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_image_width</span> <span class="o">=</span> <span class="n">real_image_width</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">real_viewing_distance</span> <span class="o">=</span> <span class="n">real_viewing_distance</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">centre</span> <span class="o">=</span> <span class="n">centre</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">fmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>            <span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">equi</span> <span class="o">=</span> <span class="n">equi</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">mipmap</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span><span class="p">]</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="k">while</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">if</span> <span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">final_mip</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">mipmap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_mip</span><span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">*</span> \
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>            <span class="k">for</span> <span class="n">l2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                    <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">device</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)):</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">elif</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&gt;=</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_map</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="k">if</span> <span class="n">l</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">mipmap</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>            <span class="n">blended_levels</span> <span class="o">=</span> <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="n">blended_levels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="p">)</span> <span class="o">*</span> \
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>                <span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lod_fraction</span><span class="o">*</span><span class="n">mipmap</span><span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">output</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">blended_levels</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="k">return</span> <span class="n">output</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.spatial_steerable_pyramid"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid" class="doc doc-heading">
            <code>SpatialSteerablePyramid</code>


<a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">


        <p>This implements a real-valued steerable pyramid where the filtering is carried out spatially (using convolution)
as opposed to multiplication in the Fourier domain.
This has a number of optimisations over previous implementations that increase efficiency, but introduce some
reconstruction error.</p>








              <details class="quote">
                <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-0-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-0-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-0-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-0-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-0-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-0-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-0-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-0-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpatialSteerablePyramid</span><span class="p">():</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    This implements a real-valued steerable pyramid where the filtering is carried out spatially (using convolution)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    as opposed to multiplication in the Fourier domain.</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    This has a number of optimisations over previous implementations that increase efficiency, but introduce some</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    reconstruction error.</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    """</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>                 <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                 <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        ----------</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        use_bilinear_downup     : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                    This uses bilinear filtering when upsampling/downsampling, rather than the original approach</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                    of applying a large lowpass kernel and sampling even rows/columns</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        n_channels              : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                    Number of channels in the input images (e.g. 3 for RGB input)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        filter_size             : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                    Desired size of filters (e.g. 3 will use 3x3 filters).</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        n_orientations          : int</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                    Number of oriented bands in each level of the pyramid.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        filter_type             : str</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                    This can be used to select smaller filters than the original ones if desired.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                    full: Original filter sizes</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                    cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                    trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        device                  : torch.device</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                                    torch device the input images will be supplied from.</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        """</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span> <span class="o">=</span> <span class="n">use_bilinear_downup</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="n">filters</span> <span class="o">=</span> <span class="n">get_steerable_pyramid_filters</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">filter_size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">make_pad</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>            <span class="n">filter_size</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="n">pad_amt</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">((</span><span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">))</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="k">if</span> <span class="n">n_channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>            <span class="k">def</span><span class="w"> </span><span class="nf">add_channels_to_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="n">padded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                                     <span class="mi">2</span><span class="p">],</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>                <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                    <span class="n">padded</span><span class="p">[</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>                <span class="k">return</span> <span class="n">padded</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)):</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">construct_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        Constructs and returns a steerable pyramid for the provided image.</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        ----------</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                                The input image, in NCHW format. The number of channels C should match num_channels</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                                when the pyramid maker was created.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        n_levels            : int</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">                                Number of levels in the constructed steerable pyramid.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        multiple_highpass   : bool</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                                If true, computes a highpass for each level of the pyramid.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                                These extra levels are redundant (not used for reconstruction).</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        Returns</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        -------</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        pyramid             : list of dicts of torch.tensor</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                                The computed steerable pyramid.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                                Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">                                Each level is stored as a dict, with the following keys:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                                "h" Highpass residual</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                                "l" Lowpass residual</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                                "b" Oriented bands (a list of torch.tensor)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        """</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">pyramid</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="c1"># Make level 0, containing highpass, lowpass and the bands</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">level0</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">level0</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level0</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="c1"># Make intermediate levels</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_levels</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>                    <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>                <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>                <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="k">if</span> <span class="n">multiple_highpass</span><span class="p">:</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">level</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="c1"># Make final level (lowpass residual)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>                <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="k">return</span> <span class="n">pyramid</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_from_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyramid</span><span class="p">):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">        </span><span class="sd">"""</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Reconstructs an input image from a steerable pyramid.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        ----------</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">        pyramid : list of dicts of torch.tensor</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                    The steerable pyramid.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                    Should be in the same format as output by construct_steerable_pyramid().</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                    The number of channels should match num_channels when the pyramid maker was created.</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        Returns</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        -------</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        image   : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                    The reconstructed image, in NCHW format.         </span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        """</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>                <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>                <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                                    <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">zeros</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>                <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="k">return</span> <span class="n">zeros</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'l'</span><span class="p">]</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>                <span class="n">b_filtered</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="n">b</span><span class="p">]),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>                <span class="n">image</span> <span class="o">+=</span> <span class="n">b_filtered</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">image</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s1">'full'</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">))</span></code>

<a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.__init__" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>use_bilinear_downup</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    This uses bilinear filtering when upsampling/downsampling, rather than the original approach
                    of applying a large lowpass kernel and sampling even rows/columns
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_channels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of channels in the input images (e.g. 3 for RGB input)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Desired size of filters (e.g. 3 will use 3x3 filters).
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    Number of oriented bands in each level of the pyramid.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_type</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    This can be used to select smaller filters than the original ones if desired.
                    full: Original filter sizes
                    cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.
                    trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>device</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                    torch device the input images will be supplied from.
</code></pre></div>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-0-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-0-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_bilinear_downup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>             <span class="n">filter_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">n_orientations</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">filter_type</span><span class="o">=</span><span class="s2">"full"</span><span class="p">,</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>             <span class="n">device</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">'cpu'</span><span class="p">)):</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    ----------</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    use_bilinear_downup     : bool</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">                                This uses bilinear filtering when upsampling/downsampling, rather than the original approach</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                                of applying a large lowpass kernel and sampling even rows/columns</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    n_channels              : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                                Number of channels in the input images (e.g. 3 for RGB input)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    filter_size             : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                                Desired size of filters (e.g. 3 will use 3x3 filters).</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    n_orientations          : int</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                                Number of oriented bands in each level of the pyramid.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    filter_type             : str</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                                This can be used to select smaller filters than the original ones if desired.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                                full: Original filter sizes</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">                                cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">                                trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    device                  : torch.device</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">                                torch device the input images will be supplied from.</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">    """</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span> <span class="o">=</span> <span class="n">use_bilinear_downup</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">filters</span> <span class="o">=</span> <span class="n">get_steerable_pyramid_filters</span><span class="p">(</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">filter_size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">make_pad</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">filter_size</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>        <span class="n">pad_amt</span> <span class="o">=</span> <span class="p">(</span><span class="n">filter_size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">((</span><span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">,</span> <span class="n">pad_amt</span><span class="p">))</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span> <span class="o">=</span> <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span> <span class="o">=</span> <span class="n">make_pad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>    <span class="k">if</span> <span class="n">n_channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_channels_to_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">):</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="n">padded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_channels</span><span class="p">,</span> <span class="n">n_channels</span><span class="p">,</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                                 <span class="mi">2</span><span class="p">],</span> <span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_channels</span><span class="p">):</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="n">padded</span><span class="p">[</span><span class="n">channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="nb">filter</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="k">return</span> <span class="n">padded</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">)):</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span> <span class="o">=</span> <span class="n">add_channels_to_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.construct_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">construct_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.construct_pyramid" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Constructs and returns a steerable pyramid for the provided image.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                The input image, in NCHW format. The number of channels C should match num_channels
                when the pyramid maker was created.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_levels</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                Number of levels in the constructed steerable pyramid.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>multiple_highpass</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                If true, computes a highpass for each level of the pyramid.
                These extra levels are redundant (not used for reconstruction).
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>pyramid</code></b> (              <code>list of dicts of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The computed steerable pyramid.
Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.
Each level is stored as a dict, with the following keys:
"h" Highpass residual
"l" Lowpass residual
"b" Oriented bands (a list of torch.tensor)</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="k">def</span><span class="w"> </span><span class="nf">construct_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">n_levels</span><span class="p">,</span> <span class="n">multiple_highpass</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">    Constructs and returns a steerable pyramid for the provided image.</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    ----------</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    image               : torch.tensor</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">                            The input image, in NCHW format. The number of channels C should match num_channels</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">                            when the pyramid maker was created.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">    n_levels            : int</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">                            Number of levels in the constructed steerable pyramid.</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">    multiple_highpass   : bool</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">                            If true, computes a highpass for each level of the pyramid.</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">                            These extra levels are redundant (not used for reconstruction).</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    Returns</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    -------</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    pyramid             : list of dicts of torch.tensor</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                            The computed steerable pyramid.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                            Each level is an entry in a list. The pyramid is ordered from largest levels to smallest levels.</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">                            Each level is stored as a dict, with the following keys:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                            "h" Highpass residual</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                            "l" Lowpass residual</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">                            "b" Oriented bands (a list of torch.tensor)</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    """</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="n">pyramid</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="c1"># Make level 0, containing highpass, lowpass and the bands</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="n">level0</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">level0</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level0</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="c1"># Make intermediate levels</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_levels</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>                <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">bands</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="k">for</span> <span class="n">filt_b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="n">bands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="n">filt_b</span><span class="p">))</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">]</span> <span class="o">=</span> <span class="n">bands</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="k">if</span> <span class="n">multiple_highpass</span><span class="p">:</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">level</span><span class="p">[</span><span class="s1">'h'</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="c1"># Make final level (lowpass residual)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">level</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="n">lowpass</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"area"</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">lowpass</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="n">lowpass</span> <span class="o">=</span> <span class="n">lowpass</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="n">level</span><span class="p">[</span><span class="s1">'l'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lowpass</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">pyramid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">return</span> <span class="n">pyramid</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.reconstruct_from_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reconstruct_from_pyramid</span><span class="p">(</span><span class="n">pyramid</span><span class="p">)</span></code>

<a href="#odak.learn.perception.spatial_steerable_pyramid.SpatialSteerablePyramid.reconstruct_from_pyramid" class="headerlink" title="Permanent link">Â¶</a></h3>


    <div class="doc doc-contents ">

        <p>Reconstructs an input image from a steerable pyramid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>pyramid</code></b>
              (<code>list of dicts of torch.tensor</code>)
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>    The steerable pyramid.
    Should be in the same format as output by construct_steerable_pyramid().
    The number of channels should match num_channels when the pyramid maker was created.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>image</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>The reconstructed image, in NCHW format.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct_from_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyramid</span><span class="p">):</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Reconstructs an input image from a steerable pyramid.</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    ----------</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    pyramid : list of dicts of torch.tensor</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                The steerable pyramid.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                Should be in the same format as output by construct_steerable_pyramid().</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                The number of channels should match num_channels when the pyramid maker was created.</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    Returns</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    -------</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    image   : torch.tensor</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                The reconstructed image, in NCHW format.         </span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    """</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_bilinear_downup</span><span class="p">:</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>            <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"bilinear"</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recompute_scale_factor</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                                <span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">zeros</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_l</span><span class="p">(</span><span class="n">zeros</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="k">return</span> <span class="n">zeros</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">pyramid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'l'</span><span class="p">]</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="n">image</span> <span class="o">=</span> <span class="n">upsample</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">])):</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="n">b_filtered</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">pad_b</span><span class="p">(</span><span class="n">level</span><span class="p">[</span><span class="s1">'b'</span><span class="p">][</span><span class="n">b</span><span class="p">]),</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">band_filters</span><span class="p">[</span><span class="n">b</span><span class="p">])</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">image</span> <span class="o">+=</span> <span class="n">b_filtered</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_l0</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_l0</span><span class="p">)</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">image</span> <span class="o">+=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">conv2d</span><span class="p">(</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pad_h0</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'h'</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">filt_h0</span><span class="p">)</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.spatial_steerable_pyramid.pad_image_for_pyramid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="p">)</span></code>

<a href="#odak.learn.perception.spatial_steerable_pyramid.pad_image_for_pyramid" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Pads an image to the extent necessary to compute a steerable pyramid of the input image.
This involves padding so both height and width are divisible by 2**n_pyramid_levels.
Uses reflection padding.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>image</code></b>
          â€“
          <div class="doc-md-description">
            <p>Image to pad, in NCHW format</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_pyramid_levels</code></b>
          â€“
          <div class="doc-md-description">
            <p>Number of levels in the pyramid you plan to construct.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/spatial_steerable_pyramid.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">pad_image_for_pyramid</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n_pyramid_levels</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Pads an image to the extent necessary to compute a steerable pyramid of the input image.</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    This involves padding so both height and width are divisible by 2**n_pyramid_levels.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Uses reflection padding.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    ----------</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    image: torch.tensor</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        Image to pad, in NCHW format</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    n_pyramid_levels: int</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Number of levels in the pyramid you plan to construct.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    """</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">min_divisor</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n_pyramid_levels</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">required_height</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">height</span> <span class="o">/</span> <span class="n">min_divisor</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_divisor</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">required_width</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="n">min_divisor</span><span class="p">)</span> <span class="o">*</span> <span class="n">min_divisor</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="k">if</span> <span class="n">required_height</span> <span class="o">&gt;</span> <span class="n">height</span> <span class="ow">or</span> <span class="n">required_width</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">:</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>        <span class="c1"># We need to pad!</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">pad</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">required_height</span><span class="o">-</span><span class="n">height</span><span class="p">,</span> <span class="n">required_width</span><span class="o">-</span><span class="n">width</span><span class="p">))</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="k">return</span> <span class="n">pad</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">return</span> <span class="n">image</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.steerable_pyramid_filters"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.steerable_pyramid_filters.crop_steerable_pyramid_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></code>

<a href="#odak.learn.perception.steerable_pyramid_filters.crop_steerable_pyramid_filters" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Given original 9x9 NYU filters, this crops them to the desired size.
The size must be an odd number &gt;= 3
Note this only crops the h0, l0 and band filters (not the l downsampling filter)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>filters</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Filters to crop (should in format used by get_steerable_pyramid_filters.)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>        Size to crop to. For example, an input of 3 will crop the filters to a size of 3x3.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>filters</code></b> (              <code>dict of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The cropped filters.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/steerable_pyramid_filters.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="sd">    Given original 9x9 NYU filters, this crops them to the desired size.</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    The size must be an odd number &gt;= 3</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="sd">    Note this only crops the h0, l0 and band filters (not the l downsampling filter)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    ----------</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    filters     : dict of torch.tensor</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">                    Filters to crop (should in format used by get_steerable_pyramid_filters.)</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    size        : int</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">                    Size to crop to. For example, an input of 3 will crop the filters to a size of 3x3.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    Returns</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    -------</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    filters     : dict of torch.tensor</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">                    The cropped filters.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    """</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="k">assert</span><span class="p">(</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="k">assert</span><span class="p">(</span><span class="n">size</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">crop_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="n">r2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">filter</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="nb">filter</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">r2</span><span class="o">-</span><span class="n">r</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">r2</span><span class="o">-</span><span class="n">r</span><span class="p">:</span><span class="n">r2</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="k">if</span> <span class="n">normalise</span><span class="p">:</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>            <span class="nb">filter</span> <span class="o">-=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="k">return</span> <span class="nb">filter</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">],</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">sum_l</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sum_l</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">])</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">sum_l0</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">])</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">*=</span> <span class="n">sum_l0</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">])</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">])):</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">crop_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="n">b</span><span class="p">],</span> <span class="n">r</span><span class="p">,</span> <span class="n">normalise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="k">return</span> <span class="n">filters</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.steerable_pyramid_filters.get_steerable_pyramid_filters" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_steerable_pyramid_filters</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">)</span></code>

<a href="#odak.learn.perception.steerable_pyramid_filters.get_steerable_pyramid_filters" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>This returns filters for a real-valued steerable pyramid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            Width of the filters (e.g. 3 will return 3x3 filters)
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n_orientations</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            Number of oriented band filters
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filter_type</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>            This can be used to select between the original NYU filters and cropped or trained alternatives.
            full: Original NYU filters from https://github.com/LabForComputationalVision/pyrtools/blob/master/pyrtools/pyramids/filters.py
            cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.
            trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>filters</code></b> (              <code>dict of torch.tensor</code>
)          â€“
          <div class="doc-md-description">
            <p>The steerable pyramid filters. Returned as a dict with the following keys:
"l" The lowpass downsampling filter
"l0" The lowpass residual filter
"h0" The highpass residual filter
"b" The band filters (a list of torch.tensor filters, one for each orientation).</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/steerable_pyramid_filters.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-0-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-0-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-0-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-0-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-0-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span>
<span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_steerable_pyramid_filters</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">n_orientations</span><span class="p">,</span> <span class="n">filter_type</span><span class="p">):</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    This returns filters for a real-valued steerable pyramid.</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    ----------</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">    size            : int</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">                        Width of the filters (e.g. 3 will return 3x3 filters)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    n_orientations  : int</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">                        Number of oriented band filters</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    filter_type     :  str</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                        This can be used to select between the original NYU filters and cropped or trained alternatives.</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">                        full: Original NYU filters from https://github.com/LabForComputationalVision/pyrtools/blob/master/pyrtools/pyramids/filters.py</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">                        cropped: Some filters are cut back in size by extracting the centre and scaling as appropriate.</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">                        trained: Same as reduced, but the oriented kernels are replaced by learned 5x5 kernels.</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">    Returns</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">    -------</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">    filters         : dict of torch.tensor</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">                        The steerable pyramid filters. Returned as a dict with the following keys:</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">                        "l" The lowpass downsampling filter</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">                        "l0" The lowpass residual filter</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">                        "h0" The highpass residual filter</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">                        "b" The band filters (a list of torch.tensor filters, one for each orientation).</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">    """</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"full"</span> <span class="ow">and</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"cropped"</span> <span class="ow">and</span> <span class="n">filter_type</span> <span class="o">!=</span> <span class="s2">"trained"</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="s2">"Unknown filter type </span><span class="si">%s</span><span class="s2">! Only filter types are full, cropped or trained."</span> <span class="o">%</span> <span class="n">filter_type</span><span class="p">)</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">if</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">],</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">],</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">],</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="p">[</span><span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a>                <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">],</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">],</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">],</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.781600e-03</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span> <span class="mf">1.576508e-01</span><span class="p">,</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>                <span class="mf">1.348999e-01</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">],</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">1.348999e-01</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>                <span class="mf">1.116388e-01</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">],</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">7.624674e-02</span><span class="p">,</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>                <span class="mf">6.306262e-02</span><span class="p">,</span> <span class="mf">3.220744e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">],</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="p">[</span><span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">2.449600e-02</span><span class="p">,</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="mf">1.722078e-02</span><span class="p">,</span> <span class="mf">3.938620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.260020e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">],</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="mf">3.781600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.236180e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.720800e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.401000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.059760e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">],</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="mf">6.948900e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.006740e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.596420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.449060e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.903800e-04</span><span class="p">,</span> <span class="mf">1.417620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">],</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.871920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.031640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.862800e-04</span><span class="p">,</span> <span class="mf">8.741400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.686000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.064400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.257000e-04</span><span class="p">]]</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>                <span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">],</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>                <span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">],</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>                <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">],</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.563200e-03</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span> <span class="mf">3.153017e-01</span><span class="p">,</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a>                <span class="mf">1.524935e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">],</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="mf">1.524935e-01</span><span class="p">,</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>                <span class="mf">6.441488e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">],</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>                <span class="mf">7.563200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.344160e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.119520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">],</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.743860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.725800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.137100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.514000e-04</span><span class="p">]]</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>            <span class="p">[</span><span class="mf">5.997200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>                <span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">5.997200e-04</span><span class="p">],</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a>                <span class="mf">3.732100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">],</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a>                <span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">],</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a>                <span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">],</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.732100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.623594e-02</span><span class="p">,</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>                <span class="mf">8.554893e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.732100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">],</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>                <span class="mf">9.623594e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.300923e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">],</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>                <span class="mf">2.420138e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.437358e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.616650e-03</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">],</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a>                <span class="mf">3.732100e-04</span><span class="p">,</span> <span class="mf">1.459700e-04</span><span class="p">,</span> <span class="mf">4.927100e-04</span><span class="p">,</span> <span class="mf">1.263100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">],</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="p">[</span><span class="mf">5.997200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.406600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.325600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.324900e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.068000e-05</span><span class="p">,</span> <span class="mf">5.997200e-04</span><span class="p">]]</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>            <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>            <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.158605e-02</span><span class="p">,</span> <span class="mf">9.464195e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="mf">3.158605e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.730466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="mf">3.487008e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.435662e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.129540e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="mf">9.091950e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.623410e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.272540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.625150e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.009473e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.889390e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.942500e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.738640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.066000e-05</span><span class="p">]</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">],</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>             <span class="p">[</span><span class="mf">1.207800e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>                 <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">],</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>                 <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">],</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>                 <span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">],</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>                 <span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">],</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>                 <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">],</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>                 <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">],</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>                 <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">],</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>             <span class="p">[</span><span class="mf">1.262000e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.648568e-02</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span> <span class="mf">2.120374e-01</span><span class="p">,</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>                 <span class="mf">1.773651e-01</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.637220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">],</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">1.773651e-01</span><span class="p">,</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>                 <span class="mf">1.445500e-01</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">],</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">9.058014e-02</span><span class="p">,</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a>                 <span class="mf">6.806584e-02</span><span class="p">,</span> <span class="mf">2.190660e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">],</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="mf">1.438512e-02</span><span class="p">,</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a>                 <span class="mf">3.955660e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.109170e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.022938e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">],</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>                 <span class="mf">1.648568e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.750818e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.884744e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.260420e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.530640e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">],</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>                 <span class="mf">9.637220e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.056920e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.431700e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.777480e-03</span><span class="p">,</span> <span class="mf">3.184680e-03</span><span class="p">,</span> <span class="mf">3.175780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">],</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">5.538200e-04</span><span class="p">,</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a>                 <span class="mf">2.221220e-03</span><span class="p">,</span> <span class="mf">4.112200e-03</span><span class="p">,</span> <span class="mf">3.080980e-03</span><span class="p">,</span> <span class="mf">3.761360e-03</span><span class="p">,</span> <span class="mf">2.160540e-03</span><span class="p">,</span> <span class="mf">1.460780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">],</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>             <span class="p">[</span><span class="mf">1.207800e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">5.589400e-03</span><span class="p">,</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a>                 <span class="mf">4.287280e-03</span><span class="p">,</span> <span class="mf">2.889860e-03</span><span class="p">,</span> <span class="mf">2.325540e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.368800e-04</span><span class="p">,</span> <span class="mf">5.621600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.814600e-04</span><span class="p">,</span> <span class="mf">4.460600e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">],</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="mf">1.262000e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.202000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.516800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.597040e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.006400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.243400e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.771400e-04</span><span class="p">,</span> <span class="mf">1.207800e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.350000e-05</span><span class="p">]]</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">],</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>                 <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">],</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>                 <span class="mf">3.297137e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">],</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>                 <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">],</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>             <span class="p">[</span><span class="mf">2.524010e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.297137e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span> <span class="mf">4.376250e-01</span><span class="p">,</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>                 <span class="mf">1.811603e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.297137e-02</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">],</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="mf">1.811603e-01</span><span class="p">,</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>                 <span class="mf">4.381320e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">],</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>                 <span class="mf">3.297137e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.769487e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.061290e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">],</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">1.107620e-03</span><span class="p">,</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>                 <span class="mf">8.224420e-03</span><span class="p">,</span> <span class="mf">7.522720e-03</span><span class="p">,</span> <span class="mf">2.921580e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">],</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="mf">2.524010e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.033700e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.601260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.354280e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.701000e-05</span><span class="p">]]</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>            <span class="p">[[</span><span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">],</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>                 <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">],</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>                 <span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">],</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a>                 <span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">],</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.897780e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.562827e-01</span><span class="p">,</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a>                 <span class="mf">7.282593e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">],</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>                 <span class="mf">1.562827e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.841370e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">],</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>                 <span class="mf">5.897780e-03</span><span class="p">,</span> <span class="mf">1.094866e-02</span><span class="p">,</span> <span class="mf">1.706347e-02</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">],</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">1.098012e-02</span><span class="p">,</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>                 <span class="mf">9.156420e-03</span><span class="p">,</span> <span class="mf">8.998600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.317530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">],</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>             <span class="p">[</span><span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.166810e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.742600e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.424720e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.424100e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.570000e-04</span><span class="p">]]</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="p">[</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.851466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">,</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>             <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>             <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>             <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a>             <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>             <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.751170e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.751170e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a>             <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a>             <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a>             <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a>             <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>             <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>             <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>             <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>             <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="mf">1.851466e-02</span><span class="p">,</span> <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">,</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>             <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a>             <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a>             <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a>             <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a>             <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>             <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>             <span class="mf">1.851466e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.872620e-03</span><span class="p">,</span> <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>             <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">2.996168e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>             <span class="mf">2.076086e-02</span><span class="p">,</span> <span class="mf">1.872620e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.851466e-02</span><span class="p">,</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>             <span class="mf">1.536890e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.009450e-03</span><span class="p">,</span> <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>             <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="mf">1.265655e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>             <span class="mf">5.375324e-02</span><span class="p">,</span> <span class="mf">6.009450e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.536890e-02</span><span class="p">,</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>             <span class="mf">2.103714e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.023569e-02</span><span class="p">,</span> <span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>             <span class="mf">1.836909e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.382180e-02</span><span class="p">,</span> <span class="mf">1.023569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.103714e-02</span><span class="p">,</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a>             <span class="mf">8.052600e-03</span><span class="p">,</span> <span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.168400e-03</span><span class="p">,</span> <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>             <span class="mf">1.751170e-03</span><span class="p">,</span> <span class="mf">4.168400e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.611520e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.052600e-03</span><span class="p">,</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>             <span class="o">-</span><span class="mf">6.125880e-03</span><span class="p">,</span> <span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">5.641530e-03</span><span class="p">,</span> <span class="mf">8.957260e-03</span><span class="p">,</span> <span class="mf">0.000000e+00</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.957260e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.641530e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.287416e-02</span><span class="p">,</span> <span class="mf">6.125880e-03</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>                <span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">],</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>            <span class="p">[</span><span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>                <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">],</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>                <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">],</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">],</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a>                <span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">],</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a>                <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">],</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">],</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>                <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">],</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="p">[</span><span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span> <span class="mf">0.2120374441</span><span class="p">,</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>                <span class="mf">0.1773651242</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span> <span class="mf">1.2619999470E-3</span><span class="p">],</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">0.1773651242</span><span class="p">,</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>                <span class="mf">0.1445499808</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">],</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">9.0580143034E-2</span><span class="p">,</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>                <span class="mf">6.8065837026E-2</span><span class="p">,</span> <span class="mf">2.1906599402E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">],</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="mf">1.4385120012E-2</span><span class="p">,</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="mf">3.9556599222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.1091699824E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0229380578E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">],</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="mf">1.6485679895E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7508180812E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.8847439438E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2604200281E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5306399222E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">],</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="mf">9.6372198313E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.0569201857E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4316998944E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7774800071E-3</span><span class="p">,</span> <span class="mf">3.1846798956E-3</span><span class="p">,</span> <span class="mf">3.1757799443E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">],</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">5.5381999118E-4</span><span class="p">,</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="mf">2.2212199401E-3</span><span class="p">,</span> <span class="mf">4.1121998802E-3</span><span class="p">,</span> <span class="mf">3.0809799209E-3</span><span class="p">,</span> <span class="mf">3.7613599561E-3</span><span class="p">,</span> <span class="mf">2.1605400834E-3</span><span class="p">,</span> <span class="mf">1.4607800404E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">],</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="p">[</span><span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">5.5893999524E-3</span><span class="p">,</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="mf">4.2872801423E-3</span><span class="p">,</span> <span class="mf">2.8898599558E-3</span><span class="p">,</span> <span class="mf">2.3255399428E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3688000035E-4</span><span class="p">,</span> <span class="mf">5.6215998484E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8146001538E-4</span><span class="p">,</span> <span class="mf">4.4606000301E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">],</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="mf">1.2619999470E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.2019999819E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5168000138E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5970399836E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0063997302E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2434000382E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.7714002216E-4</span><span class="p">,</span> <span class="mf">1.2078000145E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.3500000174E-5</span><span class="p">]]</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">],</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>                <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">],</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>                <span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">],</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>                <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">],</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="p">[</span><span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span> <span class="mf">0.4376249909</span><span class="p">,</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>                <span class="mf">0.1811603010</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span> <span class="mf">2.5240099058E-3</span><span class="p">],</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="mf">0.1811603010</span><span class="p">,</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>                <span class="mf">4.3813198805E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">],</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>                <span class="mf">3.2971370965E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7694871426E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0612900890E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">],</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">1.1076199589E-3</span><span class="p">,</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a>                <span class="mf">8.2244202495E-3</span><span class="p">,</span> <span class="mf">7.5227199122E-3</span><span class="p">,</span> <span class="mf">2.9215801042E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">],</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="mf">2.5240099058E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0337001448E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.6012600390E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3542800443E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.7009997515E-5</span><span class="p">]]</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">,</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a>                <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">],</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>                <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">],</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>                <span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">],</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a>            <span class="p">[</span><span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a>                <span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">],</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>            <span class="p">[</span><span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a>                <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">],</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="p">[</span><span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a>                <span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">],</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="p">[</span><span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a>                <span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">],</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a>            <span class="p">[</span><span class="mf">2.0898699295E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1554141641</span><span class="p">,</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>                <span class="mf">0.7303866148</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">],</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>            <span class="p">[</span><span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>                <span class="mf">0.1554141641</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.9501636326E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">],</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="p">[</span><span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>                <span class="mf">9.3812197447E-3</span><span class="p">,</span> <span class="mf">7.8046298586E-3</span><span class="p">,</span> <span class="mf">1.3962360099E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">],</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="p">[</span><span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="mf">7.3032598011E-3</span><span class="p">,</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>                <span class="mf">5.3632198833E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.7556000277E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3222697936E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">],</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="p">[</span><span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a>                <span class="mf">5.1014497876E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5751798898E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1295299996E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.9274001503E-4</span><span class="p">,</span> <span class="mf">1.2960999738E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">],</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a>                <span class="mf">8.3368999185E-4</span><span class="p">,</span> <span class="mf">3.3578000148E-4</span><span class="p">,</span> <span class="mf">2.1145299543E-3</span><span class="p">,</span> <span class="mf">2.2253401112E-3</span><span class="p">,</span> <span class="mf">1.4050999889E-3</span><span class="p">,</span> <span class="mf">1.1793200392E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">],</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">1.9755100366E-3</span><span class="p">,</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a>                <span class="mf">2.2892199922E-3</span><span class="p">,</span> <span class="mf">2.5626500137E-3</span><span class="p">,</span> <span class="mf">2.1750701126E-3</span><span class="p">,</span> <span class="mf">1.5874400269E-3</span><span class="p">,</span> <span class="mf">7.7435001731E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2734998967E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">],</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">2.0898699295E-3</span><span class="p">,</span> <span class="mf">2.0687500946E-3</span><span class="p">,</span> <span class="mf">1.9235999789E-3</span><span class="p">,</span> <span class="mf">1.5450799838E-3</span><span class="p">,</span> <span class="mf">8.8387000142E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7829999201E-5</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.2596000498E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0483998600E-4</span><span class="p">]]</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>  <span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>             <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>             <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a>             <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a>             <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a>             <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1105690673</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a>             <span class="mf">0.1768419296</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1105690673</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a>             <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a>             <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>             <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>             <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a>             <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a>             <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>             <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>             <span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="mf">8.1125000725E-4</span><span class="p">]</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>            <span class="p">[</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1221499667E-3</span><span class="p">,</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a>             <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>             <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a>             <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a>             <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a>             <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a>             <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>             <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>             <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a>             <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>             <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a>             <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a>             <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a>             <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a>             <span class="mf">3.1221499667E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">]</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a>            <span class="p">[</span><span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">,</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a>             <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a>             <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>             <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a>             <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a>             <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a>             <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a>             <span class="o">-</span><span class="mf">1.4179450460E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a>             <span class="mf">0.1768419296</span><span class="p">,</span> <span class="mf">5.3605638444E-2</span><span class="p">,</span> <span class="mf">8.5267601535E-3</span><span class="p">,</span> <span class="mf">1.4179450460E-2</span><span class="p">,</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a>             <span class="o">-</span><span class="mf">1.3955879956E-2</span><span class="p">,</span> <span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a>             <span class="mf">0.1105690673</span><span class="p">,</span> <span class="mf">3.9442278445E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.8760801069E-3</span><span class="p">,</span> <span class="mf">1.3955879956E-2</span><span class="p">,</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a>             <span class="o">-</span><span class="mf">1.2316980399E-2</span><span class="p">,</span> <span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a>             <span class="mf">2.2522680461E-2</span><span class="p">,</span> <span class="mf">8.2581602037E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.8724298142E-3</span><span class="p">,</span> <span class="mf">1.2316980399E-2</span><span class="p">,</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a>             <span class="o">-</span><span class="mf">4.4451598078E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a>             <span class="mf">3.6522001028E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.7740699481E-3</span><span class="p">,</span> <span class="mf">4.4565401040E-3</span><span class="p">,</span> <span class="mf">4.4451598078E-3</span><span class="p">,</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a>             <span class="mf">8.1125000725E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="mf">7.4700999539E-4</span><span class="p">,</span> <span class="mf">1.3462699717E-3</span><span class="p">,</span> <span class="mf">3.9103501476E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.1125000725E-4</span><span class="p">]</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>            <span class="p">[</span><span class="mf">3.1221499667E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>             <span class="o">-</span><span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a>             <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a>             <span class="o">-</span><span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a>             <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a>             <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a>             <span class="o">-</span><span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>             <span class="o">-</span><span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">0.1510555595</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a>             <span class="o">-</span><span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>             <span class="mf">0.1510555595</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2495503128E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a>             <span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2145539746E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>             <span class="mf">2.4427289143E-2</span><span class="p">,</span> <span class="mf">5.0797060132E-2</span><span class="p">,</span> <span class="mf">3.2785870135E-2</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a>             <span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.7479997203E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.9718998857E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>             <span class="mf">2.0865600090E-3</span><span class="p">,</span> <span class="mf">2.3298799060E-3</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>             <span class="mf">4.4814897701E-3</span><span class="p">,</span> <span class="mf">1.4917500317E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>             <span class="mf">0.0000000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.2846998703E-4</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.7109999034E-5</span><span class="p">,</span> <span class="mf">4.0110000555E-5</span><span class="p">,</span> <span class="mf">4.6670897864E-3</span><span class="p">,</span> <span class="mf">8.0871898681E-3</span><span class="p">,</span> <span class="mf">1.4807609841E-2</span><span class="p">,</span> <span class="mf">8.6204400286E-3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.1221499667E-3</span><span class="p">]</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="k">elif</span> <span class="n">n_orientations</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="p">[</span><span class="mf">0.00085404</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="mf">0.00962054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="mf">0.00085404</span><span class="p">],</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">],</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">],</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">],</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00962054</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span> <span class="mf">0.10096540</span><span class="p">,</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a>                <span class="mf">0.08169618</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00962054</span><span class="p">],</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.08169618</span><span class="p">,</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="mf">0.06426333</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">],</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.03981393</span><span class="p">,</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a>                <span class="mf">0.03277038</span><span class="p">,</span> <span class="mf">0.01396746</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">],</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="mf">0.00410600</span><span class="p">,</span> <span class="mf">0.01002988</span><span class="p">,</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="mf">0.00410600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00661117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00523281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">],</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="p">[</span><span class="mf">0.00085404</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00962054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00944432</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00387812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00244917</span><span class="p">,</span> <span class="mf">0.00085404</span><span class="p">]]</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"l0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="p">[</span><span class="mf">0.00341614</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.00341614</span><span class="p">],</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">],</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.40304148</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">],</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="mf">0.15925570</span><span class="p">,</span> <span class="mf">0.05586982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">],</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="p">[</span><span class="mf">0.00341614</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03848215</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01551246</span><span class="p">,</span> <span class="mf">0.00341614</span><span class="p">]]</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"h0"</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00033429</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a>                <span class="mf">0.00080639</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00033429</span><span class="p">],</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">],</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">],</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>                <span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">],</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00080639</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11435863</span><span class="p">,</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>                <span class="mf">0.81380200</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00981051</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00080639</span><span class="p">],</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a>                <span class="mf">0.11435863</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.07027679</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">],</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>                <span class="mf">0.00981051</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00673482</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290081</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">],</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="mf">0.00631653</span><span class="p">,</span> <span class="mf">0.01261227</span><span class="p">,</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a>                <span class="mf">0.00631653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00243812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00350017</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">],</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00033429</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00080639</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00133542</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00171484</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113093</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00033429</span><span class="p">]]</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a>            <span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span> <span class="mf">0.01455399</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">,</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="mf">0.11732297</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span> <span class="mf">0.00000000</span><span class="p">,</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="mf">0.01021852</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.11732297</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="mf">0.02755155</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a>            <span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01455399</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00277643</span><span class="p">]</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">,</span>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>            <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>            <span class="mf">0.01047717</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>            <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04435647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="mf">0.00459034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>            <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.00343249</span><span class="p">]</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="mf">0.00343249</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">,</span>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a>            <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a>            <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00343249</span><span class="p">]</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="p">[</span><span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">,</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a>             <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a>             <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a>             <span class="o">-</span><span class="mf">0.01455399</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.11732297</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.11732297</span><span class="p">,</span> <span class="mf">0.02755155</span><span class="p">,</span> <span class="mf">0.01455399</span><span class="p">,</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a>             <span class="o">-</span><span class="mf">0.01026699</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.08226445</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.08226445</span><span class="p">,</span> <span class="mf">0.01189859</span><span class="p">,</span> <span class="mf">0.01026699</span><span class="p">,</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>             <span class="o">-</span><span class="mf">0.00496194</span><span class="p">,</span> <span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>             <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03075356</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00893064</span><span class="p">,</span> <span class="mf">0.00496194</span><span class="p">,</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>             <span class="o">-</span><span class="mf">0.00277643</span><span class="p">,</span> <span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01021852</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00986904</span><span class="p">,</span> <span class="mf">0.00277643</span><span class="p">]</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="o">-</span><span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a>            <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a>            <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>            <span class="mf">0.00343249</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">]</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>        <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>            <span class="o">-</span><span class="mf">0.01166982</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00285723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00182078</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.00640815</span><span class="p">,</span> <span class="mf">0.00343249</span><span class="p">,</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>            <span class="o">-</span><span class="mf">0.00128000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01161195</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.04084211</span><span class="p">,</span> <span class="mf">0.01977507</span><span class="p">,</span> <span class="mf">0.00358461</span><span class="p">,</span>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>            <span class="mf">0.00459034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00853965</span><span class="p">,</span> <span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.12227230</span><span class="p">,</span> <span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01047717</span><span class="p">,</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="mf">0.00790407</span><span class="p">,</span> <span class="mf">0.04435647</span><span class="p">,</span> <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00000000</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="mf">0.09454202</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04435647</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00790407</span><span class="p">,</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="mf">0.01047717</span><span class="p">,</span> <span class="mf">0.01486305</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04819057</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="mf">0.12227230</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05394139</span><span class="p">,</span> <span class="mf">0.00853965</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00459034</span><span class="p">,</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="o">-</span><span class="mf">0.00358461</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01977507</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.04084211</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="mf">0.00228219</span><span class="p">,</span> <span class="mf">0.03930573</span><span class="p">,</span> <span class="mf">0.01161195</span><span class="p">,</span> <span class="mf">0.00128000</span><span class="p">,</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="o">-</span><span class="mf">0.00343249</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00640815</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00073141</span><span class="p">,</span> <span class="mf">0.01124321</span><span class="p">,</span> <span class="mf">0.00182078</span><span class="p">,</span> <span class="mf">0.00285723</span><span class="p">,</span> <span class="mf">0.01166982</span><span class="p">]</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="s2">"Steerable filters not implemented for </span><span class="si">%d</span><span class="s2"> orientations"</span> <span class="o">%</span> <span class="n">n_orientations</span><span class="p">)</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">"trained"</span><span class="p">:</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>            <span class="c1"># TODO maybe also train h0 and l0 filters</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="n">filters</span> <span class="o">=</span> <span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0356752239</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0223877281</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0009542659</span><span class="p">,</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a>                    <span class="mf">0.0244821459</span><span class="p">,</span> <span class="mf">0.0322226137</span><span class="p">],</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0593218654</span><span class="p">,</span>  <span class="mf">0.1245803162</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>                    <span class="mf">0.0023863907</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1230178699</span><span class="p">,</span> <span class="mf">0.0589442067</span><span class="p">],</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0281576272</span><span class="p">,</span>  <span class="mf">0.2976626456</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575"></a>                    <span class="mf">0.0020888755</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2953369915</span><span class="p">,</span> <span class="mf">0.0284542721</span><span class="p">],</span>
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0586092323</span><span class="p">,</span>  <span class="mf">0.1251581162</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a>                    <span class="mf">0.0024624448</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1227868199</span><span class="p">,</span> <span class="mf">0.0587830991</span><span class="p">],</span>
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0327464789</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0223652460</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a>                    <span class="mf">0.0042342511</span><span class="p">,</span>  <span class="mf">0.0245472137</span><span class="p">,</span> <span class="mf">0.0359398536</span><span class="p">]</span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a>                <span class="p">[</span><span class="mf">3.9758663625e-02</span><span class="p">,</span>  <span class="mf">6.0679119080e-02</span><span class="p">,</span>  <span class="mf">3.0146904290e-02</span><span class="p">,</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a>                    <span class="mf">6.1198268086e-02</span><span class="p">,</span>  <span class="mf">3.6218870431e-02</span><span class="p">],</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a>                <span class="p">[</span><span class="mf">2.3255519569e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2505133450e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a>                    <span class="mf">2.9738345742e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2518258393e-01</span><span class="p">,</span>  <span class="mf">2.3592948914e-02</span><span class="p">],</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">1.3602430699e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2058277935e-04</span><span class="p">,</span>  <span class="mf">2.6399988565e-04</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a>                    <span class="mf">2.3791544663e-04</span><span class="p">,</span>  <span class="mf">1.8450465286e-03</span><span class="p">],</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">2.1563466638e-02</span><span class="p">,</span>  <span class="mf">1.2572696805e-01</span><span class="p">,</span>  <span class="mf">2.9745018482e-01</span><span class="p">,</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a>                    <span class="mf">1.2458638102e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.3847281933e-02</span><span class="p">],</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">3.7941932678e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.1060950160e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a>                    <span class="mf">2.9489086941e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0411967337e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8459088653e-02</span><span class="p">]</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>            <span class="c1"># Below filters were optimised on 09/02/2021</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>            <span class="c1"># 20K iterations with multiple images at more scales.</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.5508436859e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1767273545e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9399923622e-04</span><span class="p">,</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>                    <span class="mf">2.1200872958e-02</span><span class="p">,</span>  <span class="mf">4.5475799590e-02</span><span class="p">],</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">6.3554823399e-02</span><span class="p">,</span>  <span class="mf">1.2832683325e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>                    <span class="mf">5.3858719184e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2809979916e-01</span><span class="p">,</span>  <span class="mf">6.3842624426e-02</span><span class="p">],</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">3.4809380770e-02</span><span class="p">,</span>  <span class="mf">2.9954621196e-01</span><span class="p">,</span>  <span class="mf">2.9066693969e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>                    <span class="mf">2.9957753420e-01</span><span class="p">,</span>  <span class="mf">3.4806568176e-02</span><span class="p">],</span>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">6.3934154809e-02</span><span class="p">,</span>  <span class="mf">1.2806062400e-01</span><span class="p">,</span>  <span class="mf">9.0917674243e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a>                    <span class="mf">1.2832444906e-01</span><span class="p">,</span>  <span class="mf">6.3572973013e-02</span><span class="p">],</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.5492250472e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.1125273779e-02</span><span class="p">,</span>  <span class="mf">4.2229349492e-04</span><span class="p">,</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a>                    <span class="mf">2.1804777905e-02</span><span class="p">,</span>  <span class="mf">4.5236673206e-02</span><span class="p">]</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>                <span class="p">[</span><span class="mf">4.8947390169e-02</span><span class="p">,</span>  <span class="mf">6.3575074077e-02</span><span class="p">,</span>  <span class="mf">3.4955859184e-02</span><span class="p">,</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>                    <span class="mf">6.4085893333e-02</span><span class="p">,</span>  <span class="mf">4.9838040024e-02</span><span class="p">],</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>                <span class="p">[</span><span class="mf">2.2061849013e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2936264277e-01</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a>                    <span class="mf">3.0093491077e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2997294962e-01</span><span class="p">,</span>  <span class="mf">2.0597217605e-02</span><span class="p">],</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">5.1290717238e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7305796064e-05</span><span class="p">,</span>  <span class="mf">2.0256420612e-05</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>                    <span class="mf">1.1864109547e-04</span><span class="p">,</span>  <span class="mf">7.3973249528e-05</span><span class="p">],</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">2.0749464631e-02</span><span class="p">,</span>  <span class="mf">1.2988376617e-01</span><span class="p">,</span>  <span class="mf">3.0080935359e-01</span><span class="p">,</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a>                    <span class="mf">1.2921217084e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.2159902379e-02</span><span class="p">],</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">4.9614857882e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.4021714032e-02</span><span class="p">,</span> <span class="o">-</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a>                    <span class="mf">3.4676689655e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.3446544111e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.8282280564e-02</span><span class="p">]</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a>            <span class="c1"># Trained on 17/02/2021 to match fourier pyramid in spatial domain</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a>                <span class="p">[</span><span class="mf">3.3370e-02</span><span class="p">,</span>  <span class="mf">9.3934e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5810e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.4038e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3115e-02</span><span class="p">],</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="p">[</span><span class="mf">1.7716e-01</span><span class="p">,</span>  <span class="mf">3.9378e-01</span><span class="p">,</span>  <span class="mf">6.8461e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9343e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7685e-01</span><span class="p">],</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="p">[</span><span class="mf">2.9213e-01</span><span class="p">,</span>  <span class="mf">6.1042e-01</span><span class="p">,</span>  <span class="mf">7.0654e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0939e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.9177e-01</span><span class="p">],</span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a>                <span class="p">[</span><span class="mf">1.7684e-01</span><span class="p">,</span>  <span class="mf">3.9392e-01</span><span class="p">,</span>  <span class="mf">1.0517e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.9268e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.7668e-01</span><span class="p">],</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a>                <span class="p">[</span><span class="mf">3.3000e-02</span><span class="p">,</span>  <span class="mf">9.4029e-02</span><span class="p">,</span>  <span class="mf">7.3565e-04</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.3366e-02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.3008e-02</span><span class="p">]</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a>            <span class="n">filters</span><span class="p">[</span><span class="s2">"b"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a>                <span class="p">[</span><span class="mf">0.0331</span><span class="p">,</span>  <span class="mf">0.1763</span><span class="p">,</span>  <span class="mf">0.2907</span><span class="p">,</span>  <span class="mf">0.1753</span><span class="p">,</span>  <span class="mf">0.0325</span><span class="p">],</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="p">[</span><span class="mf">0.0941</span><span class="p">,</span>  <span class="mf">0.3932</span><span class="p">,</span>  <span class="mf">0.6079</span><span class="p">,</span>  <span class="mf">0.3904</span><span class="p">,</span>  <span class="mf">0.0922</span><span class="p">],</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a>                <span class="p">[</span><span class="mf">0.0008</span><span class="p">,</span>  <span class="mf">0.0009</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0010</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0025</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0015</span><span class="p">],</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0929</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3919</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6097</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3944</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0946</span><span class="p">],</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a>                <span class="p">[</span><span class="o">-</span><span class="mf">0.0328</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1760</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2915</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1768</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0333</span><span class="p">]</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a>            <span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a>                <span class="s2">"Trained filters not implemented for size </span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">size</span><span class="p">)</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a>    <span class="k">if</span> <span class="n">filter_type</span> <span class="o">==</span> <span class="s2">"cropped"</span><span class="p">:</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">filters</span> <span class="o">=</span> <span class="n">crop_steerable_pyramid_filters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">return</span> <span class="n">filters</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="odak.learn.perception.util"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="odak.learn.perception.util.slice_rgbd_targets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">slice_rgbd_targets</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">depth_plane_positions</span><span class="p">)</span></code>

<a href="#odak.learn.perception.util.slice_rgbd_targets" class="headerlink" title="Permanent link">Â¶</a></h2>


    <div class="doc doc-contents ">

        <p>Slices the target RGBD image and depth map into multiple layers based on depth plane positions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>target</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                 The RGBD target tensor with shape (C, H, W).
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>depth</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                 The depth map corresponding to the target image with shape (H, W).
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>depth_plane_positions</code></b>
          â€“
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>                 The positions of the depth planes used for slicing.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>targets</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>A tensor of shape (N, C, H, W) where N is the number of depth planes. Contains the sliced targets for each depth plane.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>masks</code></b> (              <code><span title="torch.Tensor">Tensor</span></code>
)          â€“
          <div class="doc-md-description">
            <p>A tensor of shape (N, C, H, W) containing binary masks for each depth plane.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>odak/learn/perception/util.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">slice_rgbd_targets</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">depth_plane_positions</span><span class="p">):</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    Slices the target RGBD image and depth map into multiple layers based on depth plane positions.</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    ----------</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    target                 : torch.Tensor</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">                             The RGBD target tensor with shape (C, H, W).</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    depth                  : torch.Tensor</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">                             The depth map corresponding to the target image with shape (H, W).</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    depth_plane_positions  : list or torch.Tensor</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">                             The positions of the depth planes used for slicing.</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    Returns</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    -------</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    targets              : torch.Tensor</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                           A tensor of shape (N, C, H, W) where N is the number of depth planes. Contains the sliced targets for each depth plane.</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    masks                : torch.Tensor</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">                           A tensor of shape (N, C, H, W) containing binary masks for each depth plane.</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    """</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">device</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">device</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">number_of_planes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">depth_plane_positions</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">targets</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>                        <span class="n">number_of_planes</span><span class="p">,</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>                        <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>                        <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>                        <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>                        <span class="n">requires_grad</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>                        <span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>                        <span class="p">)</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">masks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">mask_zeros</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">mask_ones</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_of_planes</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="n">pos</span> <span class="o">=</span> <span class="n">depth_plane_positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">depth_plane_positions</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">number_of_planes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>                <span class="n">condition</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">prev_pos</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">,</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>                <span class="n">condition</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">prev_pos</span> <span class="o">&lt;=</span> <span class="n">depth</span><span class="p">,</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">mask_ones</span><span class="p">,</span> <span class="n">mask_zeros</span><span class="p">)</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="n">new_target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="o">*</span> <span class="n">mask</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>            <span class="n">targets</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_target</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="n">masks</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span> 
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">return</span> <span class="n">targets</span><span class="p">,</span> <span class="n">masks</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../../notes/using_metameric_loss/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Using metameric loss">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Using metameric loss
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Â© 2023
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/kaanaksit" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://join.slack.com/t/rpcdrendering-m4b9370/shared_invite/zt-13b5caruu-o7Ra99nEXkntnJqVYJTVdg" target="_blank" rel="noopener" title="join.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.tooltips", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.footer", "search.share", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>