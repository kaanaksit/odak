<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The fundamental library for scientific computing in optical and visual perception sciences.">
      
      
        <meta name="author" content="Kaan Akşit">
      
      
        <link rel="canonical" href="https://kaanaksit.github.io/odak/course/geometric_optics/">
      
      
        <link rel="prev" href="../fundamentals/">
      
      
        <link rel="next" href="../computer_generated_holography/">
      
      
        
      
      
      <link rel="icon" href="../../odak.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Modeling light with rays - Odak</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="odak" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modeling-light-with-rays" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
For updates follow 
<a href="https://x.com/kaanaksit" style="color:#1da1f2;">
<strong>@kaanaksit</strong> 
</a>
on
<a href="https://x.com/kaanaksit" style="color:#1da1f2;">
<span class="twemoji x-twitter">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg>
</span>
</a>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Odak" class="md-header__button md-logo" aria-label="Odak" data-md-component="logo">
      
  <img src="../../odak.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Odak
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Modeling light with rays
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="odak" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/kaanaksit/odak" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    kaanaksit/odak
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Odak" class="md-nav__button md-logo" aria-label="Odak" data-md-component="logo">
      
  <img src="../../odak.png" alt="logo">

    </a>
    Odak
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kaanaksit/odak" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    kaanaksit/odak
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../beginning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is Odak?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Computational Light Course
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Computational Light Course
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computational_light/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Light, Computation, and Computational Light
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fundamentals in optimizing and learning light
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Modeling light with rays
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Modeling light with rays
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ray description
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.create_ray" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_ray
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.create_ray_from_two_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_ray_from_two_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.propagate_ray" class="md-nav__link">
    <span class="md-ellipsis">
      
        propagate_ray
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.tools.grid_sample" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_sample
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-rays-with-surfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersecting rays with surfaces
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_sphere" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_sphere
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-rays-with-meshes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersecting rays with meshes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_surface" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_surface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.is_it_on_triangle" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_it_on_triangle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_triangle" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_triangle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refracting-and-reflecting-rays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Refracting and reflecting rays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.refract" class="md-nav__link">
    <span class="md-ellipsis">
      
        refract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.reflect" class="md-nav__link">
    <span class="md-ellipsis">
      
        reflect
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-with-rays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization with rays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering-scenes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rendering scenes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computer_generated_holography/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Computer-Generated Holography
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visual_perception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visual Perception
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computational_displays/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Computational Displays
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../computational_imaging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Computational Imaging and Sensing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../photonic_computers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    All-optical Machine Learning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Computer-Generated Holography
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Computer-Generated Holography
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1">
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cgh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/holographic_light_transport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Holographic Light Transport
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/optimizing_holograms_using_odak/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hologram Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/wave/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.wave
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_wave/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.wave
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Lensless Imaging
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Lensless Imaging
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1">
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lensless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_lensless/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.lensless
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5">
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    General toolkit
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    General toolkit
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../toolkit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6">
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Machine learning
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Machine learning
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../machine_learning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/fit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.fit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Raytracing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Raytracing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.raytracing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_raytracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.raytracing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8">
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Visual perception
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Visual perception
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1">
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Introduction
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../perception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/using_metameric_loss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using metameric loss
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../odak/learn_perception/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    odak.learn.perception
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ray-description" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ray description
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.create_ray" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_ray
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.create_ray_from_two_points" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_ray_from_two_points
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.propagate_ray" class="md-nav__link">
    <span class="md-ellipsis">
      
        propagate_ray
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.tools.grid_sample" class="md-nav__link">
    <span class="md-ellipsis">
      
        grid_sample
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-rays-with-surfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersecting rays with surfaces
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_sphere" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_sphere
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intersecting-rays-with-meshes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Intersecting rays with meshes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_surface" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_surface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.is_it_on_triangle" class="md-nav__link">
    <span class="md-ellipsis">
      
        is_it_on_triangle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.intersect_w_triangle" class="md-nav__link">
    <span class="md-ellipsis">
      
        intersect_w_triangle
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refracting-and-reflecting-rays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Refracting and reflecting rays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.refract" class="md-nav__link">
    <span class="md-ellipsis">
      
        refract
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#odak.learn.raytracing.reflect" class="md-nav__link">
    <span class="md-ellipsis">
      
        reflect
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization-with-rays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Optimization with rays
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering-scenes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Rendering scenes
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conclusion
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<details class="quote end">
<summary>Narrate section</summary>
<p><audio controls="controls">
    <source type="audio/mp3" src="../media/geometric_optics.mp3">
</audio></p>
</details>
<h1 id="modeling-light-with-rays">Modeling light with rays<a class="headerlink" href="#modeling-light-with-rays" title="Permanent link">¶</a></h1>
<p>Modeling light plays a crucial role in describing events based on light and helps designing mechanisms based on light (e.g., Realistic graphics in a video game, display or camera).
This chapter introduces the most basic description of light using geometric rays, also known as raytracing.
Raytracing has a long history, from ancient times to current Computer Graphics.
Here, we will not cover the history of raytracing.
Instead, we will focus on how we implement simulations to build "things" with raytracing in the future.
As we provide algorithmic examples to support our descriptions, readers should be able to simulate light on their computers using the provided descriptions.</p>
<details class="question end">
<summary>Are there other good resources on modeling light with rays?</summary>
<p>When I first started coding Odak, the first paper I read was on raytracing. 
Thus, I recommend that paper for any starter:</p>
<ul>
<li><a href="https://doi.org/10.1364/JOSA.52.000672">Spencer, G. H., and M. V. R. K. Murty. "General ray-tracing procedure." JOSA 52, no. 6 (1962): 672-678.</a> <sup id="fnref3:spencer1962general"><a class="footnote-ref" href="#fn:spencer1962general">1</a></sup></li>
</ul>
<p>Beyond this paper, there are several resources that I can recommend for curious readers:</p>
<ul>
<li><a href="https://www.realtimerendering.com/raytracing/Ray%20Tracing%20in%20a%20Weekend.pdf">Shirley, Peter. "Ray tracing in one weekend." Amazon Digital Services LLC 1 (2018): 4.</a> <sup id="fnref:shirley2018ray"><a class="footnote-ref" href="#fn:shirley2018ray">2</a></sup></li>
<li><a href="https://graphicscodex.com/">Morgan McGuire (2021). The Graphics Codex. Casual Effects.</a> <sup id="fnref:mcguire2018graphics"><a class="footnote-ref" href="#fn:mcguire2018graphics">3</a></sup></li>
</ul>
</details>
<h2 id="ray-description">Ray description <span class="twemoji mdx-pulse" title="Too important!"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"></path></svg></span><a class="headerlink" href="#ray-description" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical</p>
<p>We have to define what "a ray" is.
A ray has a starting point in Euclidean space (<span class="arithmatex">\(x_0, y_0, z_0 \in \mathbb{R}\)</span>).
We also have to define direction cosines to provide the directions for rays.
Direction cosines are three angles of a ray between the XYZ axis and that ray (<span class="arithmatex">\(\theta_x, \theta_y, \theta_z \in \mathbb{R}\)</span>).
To calculate direction cosines, we must choose a point on that ray as <span class="arithmatex">\(x_1, y_1,\)</span> and <span class="arithmatex">\(z_1\)</span> and we calculate its distance to the starting point of <span class="arithmatex">\(x_0, y_0\)</span> and <span class="arithmatex">\(z_0\)</span>:</p>
<div class="arithmatex">\[
x_{distance} = x_1 - x_0, \\
y_{distance} = y_1 - y_0, \\
z_{distance} = z_1 - z_0.
\]</div>
<p>Then, we can also calculate the Euclidian distance between starting point and the point chosen:</p>
<div class="arithmatex">\[
s = \sqrt{x_{distance}^2 + y_{distance}^2 + z_{distance}^2}.
\]</div>
<p>Thus, we describe each direction cosines as:</p>
<div class="arithmatex">\[
cos(\theta_x) = \frac{x_{distance}}{s}, \\
cos(\theta_y) = \frac{y_{distance}}{s}, \\
cos(\theta_z) = \frac{z_{distance}}{s}.
\]</div>
<p>Now that we know how to define a ray with a starting point, <span class="arithmatex">\(x_0, y_0, z_0\)</span> and a direction cosine, <span class="arithmatex">\(cos(\theta_x), cos(\theta_y), cos(\theta_z)\)</span>, let us carefully analyze the parameters, returns, and source code of the provided two following functions in <code>odak</code> dedicated to creating a ray or multiple rays.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.create_ray</code></label><label for="__tabbed_1_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.create_ray_from_two_points</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.create_ray"></a>
    <div class="doc doc-contents first">

        <p>Definition to create a ray.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>xyz</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       List that contains X,Y and Z start locations of a ray.
       Size could be [1 x 3], [3], [m x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>abg</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       List that contains angles in degrees with respect to the X,Y and Z axes.
       Size could be [1 x 3], [3], [m x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>direction</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       If set to True, cosines of `abg` is not calculated.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Array that contains starting points and cosines of a created ray.
Size will be either [1 x 3] or [m x 3].</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/ray.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_ray</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">abg</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="sd">    Definition to create a ray.</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    ----------</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    xyz          : torch.tensor</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">                   List that contains X,Y and Z start locations of a ray.</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">                   Size could be [1 x 3], [3], [m x 3].</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    abg          : torch.tensor</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">                   List that contains angles in degrees with respect to the X,Y and Z axes.</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">                   Size could be [1 x 3], [3], [m x 3].</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    direction    : bool</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">                   If set to True, cosines of `abg` is not calculated.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    Returns</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    ----------</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    ray          : torch.tensor</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                   Array that contains starting points and cosines of a created ray.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">                   Size will be either [1 x 3] or [m x 3].</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">    """</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">points</span> <span class="o">=</span> <span class="n">xyz</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">angles</span> <span class="o">=</span> <span class="n">abg</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">xyz</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">abg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a>        <span class="n">angles</span> <span class="o">=</span> <span class="n">abg</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">ray</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="k">if</span> <span class="n">direction</span><span class="p">:</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">abg</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">abg</span><span class="p">))</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="k">return</span> <span class="n">ray</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.create_ray_from_two_points"></a>
    <div class="doc doc-contents first">

        <p>Definition to create a ray from two given points. Note that both inputs must match in shape.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>x0y0z0</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       List that contains X,Y and Z start locations of a ray.
       Size could be [1 x 3], [3], [m x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>x1y1z1</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       List that contains X,Y and Z ending locations of a ray or batch of rays.
       Size could be [1 x 3], [3], [m x 3].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Array that contains starting points and cosines of a created ray(s).</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/ray.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_ray_from_two_points</span><span class="p">(</span><span class="n">x0y0z0</span><span class="p">,</span> <span class="n">x1y1z1</span><span class="p">):</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">    Definition to create a ray from two given points. Note that both inputs must match in shape.</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    ----------</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    x0y0z0       : torch.tensor</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">                   List that contains X,Y and Z start locations of a ray.</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">                   Size could be [1 x 3], [3], [m x 3].</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">    x1y1z1       : torch.tensor</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">                   List that contains X,Y and Z ending locations of a ray or batch of rays.</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">                   Size could be [1 x 3], [3], [m x 3].</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">    Returns</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    ----------</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">    ray          : torch.tensor</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">                   Array that contains starting points and cosines of a created ray(s).</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">    """</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x0y0z0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">x0y0z0</span> <span class="o">=</span> <span class="n">x0y0z0</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1y1z1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">x1y1z1</span> <span class="o">=</span> <span class="n">x1y1z1</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">xdiff</span> <span class="o">=</span> <span class="n">x1y1z1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x0y0z0</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">ydiff</span> <span class="o">=</span> <span class="n">x1y1z1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x0y0z0</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">zdiff</span> <span class="o">=</span> <span class="n">x1y1z1</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x0y0z0</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdiff</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ydiff</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">zdiff</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">s</span><span class="p">[</span><span class="n">s</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">)</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="n">cosines</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x0y0z0</span> <span class="o">*</span> <span class="n">x1y1z1</span><span class="p">)</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">cosines</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xdiff</span> <span class="o">/</span> <span class="n">s</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">cosines</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ydiff</span> <span class="o">/</span> <span class="n">s</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">cosines</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">zdiff</span> <span class="o">/</span> <span class="n">s</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">ray</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">xdiff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">x0y0z0</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0y0z0</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cosines</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="k">return</span> <span class="n">ray</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>In the future, we must find out where a ray lands after a certain amount of propagation distance for various purposes, which we will describe in this chapter.
For that purpose, let us also create a utility function that propagates a  ray to some distance, <span class="arithmatex">\(d\)</span>, using <span class="arithmatex">\(x_0, y_0, z_0\)</span> and <span class="arithmatex">\(cos(\theta_x), cos(\theta_y), cos(\theta_z)\)</span>:</p>
<div class="arithmatex">\[
x_{new} = x_0 + cos(\theta_x) d,\\
y_{new} = y_0 + cos(\theta_y) d,\\
z_{new} = z_0 + cos(\theta_z) d.
\]</div>
<p>Let us also check the function provided below to understand its source code, parameters, and returns.
This function will serve as a utility function to propagate a ray or a batch of rays in our future simulations.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.propagate_ray</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.propagate_ray"></a>
    <div class="doc doc-contents first">

        <p>Definition to propagate a ray at a certain given distance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>ray</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>     A ray with a size of [2 x 3], [1 x 2 x 3] or a batch of rays with [m x 2 x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>distance</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>     Distance with a size of [1], [1, m] or distances with a size of [m], [1, m].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>new_ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Propagated ray with a size of [1 x 2 x 3] or batch of rays with [m x 2 x 3].</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/ray.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="k">def</span><span class="w"> </span><span class="nf">propagate_ray</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">distance</span><span class="p">):</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">    Definition to propagate a ray at a certain given distance.</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">    ----------</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a><span class="sd">    ray        : torch.tensor</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a><span class="sd">                 A ray with a size of [2 x 3], [1 x 2 x 3] or a batch of rays with [m x 2 x 3].</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="sd">    distance   : torch.tensor</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a><span class="sd">                 Distance with a size of [1], [1, m] or distances with a size of [m], [1, m].</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="sd">    Returns</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="sd">    ----------</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="sd">    new_ray    : torch.tensor</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">                 Propagated ray with a size of [1 x 2 x 3] or batch of rays with [m x 2 x 3].</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    """</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="n">ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">distance</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">distance</span> <span class="o">=</span> <span class="n">distance</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">new_ray</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ray</span><span class="p">)</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="n">new_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="n">new_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>    <span class="n">new_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="n">new_ray</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>It is now time for us to put what we have learned so far into an actual code.
We can create many rays using the two functions, <code>odak.learn.raytracing.create_ray_from_two_points</code> and <code>odak.learn.raytracing.create_ray</code>.
However, to do so, we need to have many points in both cases.
For that purpose, let's carefully review this utility function provided below.
This utility function can generate grid samples from a plane with some tilt, and we can also define the center of our samples to position points anywhere in Euclidean space.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.tools.grid_sample</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.tools.grid_sample"></a>
    <div class="doc doc-contents first">

        <p>Generate samples over a surface.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>no</code></b>
              (<code><span title="list">list</span></code>, default:
                  <code>[10, 10]</code>
)
          –
          <div class="doc-md-description">
            <p>Number of samples along each dimension.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>size</code></b>
              (<code><span title="list">list</span></code>, default:
                  <code>[100.0, 100.0]</code>
)
          –
          <div class="doc-md-description">
            <p>Physical size of the surface along each dimension.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>center</code></b>
              (<code><span title="list">list</span></code>, default:
                  <code>[0.0, 0.0, 0.0]</code>
)
          –
          <div class="doc-md-description">
            <p>Center location of the surface.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>angles</code></b>
              (<code><span title="list">list</span></code>, default:
                  <code>[0.0, 0.0, 0.0]</code>
)
          –
          <div class="doc-md-description">
            <p>Tilt angles of the surface around X, Y, and Z axes.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>samples</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Generated samples.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>rotx</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Rotation matrix around X axis.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>roty</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Rotation matrix around Y axis.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>rotz</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Rotation matrix around Z axis.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/tools/sample.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">grid_sample</span><span class="p">(</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">angles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="p">):</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="sd">    Generate samples over a surface.</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="sd">    ----------</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="sd">    no : list</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">        Number of samples along each dimension.</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    size : list</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        Physical size of the surface along each dimension.</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    center : list</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">        Center location of the surface.</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    angles : list</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">        Tilt angles of the surface around X, Y, and Z axes.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    Returns</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    -------</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    samples : torch.tensor</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        Generated samples.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    rotx : torch.tensor</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        Rotation matrix around X axis.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">    roty : torch.tensor</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        Rotation matrix around Y axis.</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    rotz : torch.tensor</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        Rotation matrix around Z axis.</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    """</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">center</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">angles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">angles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">no</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">no</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">no</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">no</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">"ij"</span><span class="p">)</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">samples</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">samples</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">samples</span><span class="p">,</span> <span class="n">rotx</span><span class="p">,</span> <span class="n">roty</span><span class="p">,</span> <span class="n">rotz</span> <span class="o">=</span> <span class="n">rotate_points</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">rotx</span><span class="p">,</span> <span class="n">roty</span><span class="p">,</span> <span class="n">rotz</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>The below script provides a sample use case for the functions provided above.
I also leave comments near some lines explaining the code in steps.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"><div class="tabbed-labels"><label for="__tabbed_4_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_create_ray_from_two_points.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>  <span class="c1"># (1)</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">starting_point</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>  <span class="c1"># (2)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    <span class="n">end_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="p">)</span>  <span class="c1"># (3)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">rays_from_points</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">starting_point</span><span class="p">,</span> <span class="n">end_points</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="p">)</span>  <span class="c1"># (4)</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">starting_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>        <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">angles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">starting_points</span><span class="p">)</span> <span class="o">*</span> <span class="mf">180.0</span>  <span class="c1"># (5)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">rays_from_angles</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray</span><span class="p">(</span><span class="n">starting_points</span><span class="p">,</span> <span class="n">angles</span><span class="p">)</span>  <span class="c1"># (6)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="n">distances</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">rays_from_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">12.5</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="n">propagated_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">propagate_ray</span><span class="p">(</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>        <span class="n">rays_from_points</span><span class="p">,</span> <span class="n">distances</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="p">)</span>  <span class="c1"># (7)</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># (8)</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span><span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">starting_point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">end_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">starting_point</span><span class="p">,</span> <span class="n">end_points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>        <span class="n">x_axis</span> <span class="o">=</span> <span class="n">starting_point</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="n">x_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">x_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">starting_point</span><span class="p">,</span> <span class="n">x_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">"dash"</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>        <span class="n">y_axis</span> <span class="o">=</span> <span class="n">starting_point</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="n">y_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">y_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">starting_point</span><span class="p">,</span> <span class="n">y_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">"dash"</span><span class="p">)</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>        <span class="n">z_axis</span> <span class="o">=</span> <span class="n">starting_point</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>        <span class="n">z_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">z_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">starting_point</span><span class="p">,</span> <span class="n">z_axis</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">"dash"</span><span class="p">)</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
<ol>
<li>Required libraries are imported.</li>
<li>Defining a starting point, in order X, Y and Z locations.
   Size of starting point could be s1] or [1, 1].</li>
<li>Defining some end points on a plane in grid fashion.</li>
<li><code>odak.learn.raytracing.create_ray_from_two_points</code> is verified with an example! Let's move on to <code>odak.learn.raytracing.create_ray</code>.</li>
<li>Creating starting points with <code>odak.learn.tools.grid_sample</code> and defining some angles as the direction using <code>torch.randn</code>.
   Note that the angles are in degrees.</li>
<li><code>odak.learn.raytracing.create_ray</code> is verified with an example!</li>
<li><code>odak.learn.raytracing.propagate_a_ray</code> is verified with an example!</li>
<li>Set it to <code>True</code> to enable visualization.</li>
</ol>
</div>
</div>
</div>
<p>The above code also has parts that are disabled (see <code>visualize</code> variable).
We disabled these lines intentionally to avoid running it at every run.
Let me talk about these disabled functions as well.
Odak offers a tidy approach to simple visualizations through packages called <a href="https://plotly.com/">Plotly</a> and <code>kaleido</code>.
To make these lines work by setting <code>visualize = True</code>, you must first install <code>plotly</code> in your work environment.
This installation is as simple as <code>pip3 install plotly kaleido</code> in a Linux system.
As you install these packages and enable these lines, the code will produce a visualization similar to the one below.
Note that this is an interactive visualization where you can interact with your mouse clicks to rotate, shift, and zoom.
In this visualization, we visualize a single ray (green line) starting from our defined starting point (red dot) and ending at one of the <code>end_points</code> (blue dot).
We also highlight three axes with black lines to provide a reference frame.
Although <code>odak.visualize.plotly</code> offers us methods to visualize rays quickly for debugging, it is highly suggested to stick to a low number of lines when using it (e.g., say not exceeding 100 rays in total).
The proper way to draw many rays lies in modern path-tracing renderers such as <a href="https://www.blender.org/">Blender</a>.</p>
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>                <div id="3598239a-f352-4650-981b-0943f8d0aa2d" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("3598239a-f352-4650-981b-0943f8d0aa2d")) {                    Plotly.newPlot(                        "3598239a-f352-4650-981b-0943f8d0aa2d",                        [{"marker":{"color":"red","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[5.0],"y":[5.0],"z":[0.0],"type":"scatter3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-10.0],"y":[-10.0],"z":[10.0],"type":"scatter3d"},{"line":{"color":"green","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,-10.0],"y":[5.0,-10.0],"z":[0.0,10.0],"type":"scatter3d"},{"marker":{"color":"black","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-10.0],"y":[5.0],"z":[0.0],"type":"scatter3d"},{"line":{"color":"black","dash":"dash","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,-10.0],"y":[5.0,5.0],"z":[0.0,0.0],"type":"scatter3d"},{"marker":{"color":"black","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[5.0],"y":[-10.0],"z":[0.0],"type":"scatter3d"},{"line":{"color":"black","dash":"dash","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,5.0],"y":[5.0,-10.0],"z":[0.0,0.0],"type":"scatter3d"},{"marker":{"color":"black","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[5.0],"y":[5.0],"z":[10.0],"type":"scatter3d"},{"line":{"color":"black","dash":"dash","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,5.0],"y":[5.0,5.0],"z":[0.0,10.0],"type":"scatter3d"}],                        {"annotations":[{"font":{"size":16},"showarrow":false,"text":"Ray visualization","x":0.5,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"scene":{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]}},"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>

<details class="question end">
<summary>How can I learn more about more sophisticated renderers like Blender?</summary>
<p>Blender is a widely used open-source renderer that comes with sophisticated features.
It is user interface could be challenging for newcomers.
A blog post published by SIGGRAPH Research Career Development Committee offers a neat entry-level post titled <a href="https://www.silviasellan.com/blender_course.html"><code>Rendering a paper figure with Blender</code></a> written by <a href="https://www.silviasellan.com/">Silvia Sellán</a>.</p>
<p>In addition to Blender, there are various renderers you may be happy to know about if you are curious about Computer Graphics.
<a href="https://www.mitsuba-renderer.org/">Mitsuba 3</a> is another sophisticated rendering system based on a SIGGRAPH paper titled <a href="https://rgl.epfl.ch/publications/Jakob2022DrJit"><code>Dr.Jit: A Just-In-Time Compiler for Differentiable Rendering</code></a> <sup id="fnref:jakob2022dr"><a class="footnote-ref" href="#fn:jakob2022dr">4</a></sup> from <a href="https://rgl.epfl.ch/people/wjakob">Wenzel Jakob</a>.</p>
<p>If you know any other, please share it with the class so that they also learn more about other renderers.</p>
</details>
<details class="abstract end">
<summary><a href="https://github.com/kaanaksit/odak/discussions/71">Challenge: Blender meets Odak</a></summary>
<p>In light of the given information, we challenge readers to create a new submodule for Odak.
Note that Odak has <code>odak.visualize.blender</code> submodule.
However, at the time of this writing, this submodule works as a server that sends commands to a program that has to be manually triggered inside Blender.
Odak seeks an upgrade to this submodule, where users can draw rays, meshes, or parametric surfaces easily in Blender with commands from Odak.
This newly upgraded submodule should require no manual processes.
To add these to <code>odak,</code> you can rely on the <code>pull request</code> feature on GitHub.
You can also create a new <code>engineering note</code> for your new submodule in <code>docs/notes/odak_meets_blender.md</code>.</p>
</details>
<h2 id="intersecting-rays-with-surfaces">Intersecting rays with surfaces <span class="twemoji mdx-pulse" title="Too important!"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"></path></svg></span><a class="headerlink" href="#intersecting-rays-with-surfaces" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical</p>
<p>Rays we have described so far help us explore light and matter interactions.
Often in simulations, these rays interact with surfaces.
In a simulation environment for optical design,  equations often describe surfaces continuously.
These surface equations typically contain a number of parameters for defining surfaces.
For example, let us consider a sphere, which follows a standard equation as follows,</p>
<div class="arithmatex">\[
r^2 = (x - x_0)^2 + (y - y_0)^2 + (z - z_0)^2,
\]</div>
<p>Where <span class="arithmatex">\(r\)</span> represents the diameter of that sphere, <span class="arithmatex">\(x_0, y_0, z_0\)</span> defines the center location of that sphere, and <span class="arithmatex">\(x, y, z\)</span> are points on the surface of a sphere.
When testing if a point is on a sphere, we use the above equation by inserting the point to be tested as <span class="arithmatex">\(x, y, z\)</span> into that equation.
In other words, to find a ray and sphere intersection, we must identify a distance that propagates our rays a certain amount and lends on a point on that sphere, and we can use the above sphere equation for identifying the intersection point of that rays.
As long the surface equation is well degined, the same strategy can be used for any surfaces.
In addition, if needed for future purposes (e.g., reflecting or refracting light off the surface of that sphere), we can also calculate the surface normal of that sphere by drawing a line by defining a ray starting from the center of that sphere and propagating towards the intersection point.
Let us examine, how we can identify intersection points for a set of given rays and a sphere by examining the below function.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"><div class="tabbed-labels"><label for="__tabbed_5_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.intersect_w_sphere</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.intersect_w_sphere"></a>
    <div class="doc doc-contents first">

        <p>Definition to find the intersection between ray(s) and sphere(s).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>ray</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Input ray(s).
              Expected size is [1 x 2 x 3] or [m x 2 x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>sphere</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Input sphere.
              Expected size is [1 x 4].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>learning_rate</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Learning rate used in the optimizer for finding the propagation distances of the rays.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>number_of_steps</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Number of steps used in the optimizer.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>error_threshold</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              The error threshold that will help deciding intersection or no intersection.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>intersecting_ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Ray(s) that intersecting with the given sphere.
Expected size is [n x 2 x 3], where n could be any real number.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>intersecting_normal</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Normal(s) for the ray(s) intersecting with the given sphere
Expected size is [n x 2 x 3], where n could be any real number.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/boundary.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="k">def</span><span class="w"> </span><span class="nf">intersect_w_sphere</span><span class="p">(</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">ray</span><span class="p">,</span> <span class="n">sphere</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">2e-1</span><span class="p">,</span> <span class="n">number_of_steps</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">error_threshold</span><span class="o">=</span><span class="mf">1e-2</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="p">):</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Definition to find the intersection between ray(s) and sphere(s).</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    ----------</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    ray                 : torch.tensor</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">                          Input ray(s).</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">                          Expected size is [1 x 2 x 3] or [m x 2 x 3].</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    sphere              : torch.tensor</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">                          Input sphere.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">                          Expected size is [1 x 4].</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    learning_rate       : float</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">                          Learning rate used in the optimizer for finding the propagation distances of the rays.</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    number_of_steps     : int</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">                          Number of steps used in the optimizer.</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    error_threshold     : float</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">                          The error threshold that will help deciding intersection or no intersection.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    Returns</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">    -------</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    intersecting_ray    : torch.tensor</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">                          Ray(s) that intersecting with the given sphere.</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">                          Expected size is [n x 2 x 3], where n could be any real number.</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    intersecting_normal : torch.tensor</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">                          Normal(s) for the ray(s) intersecting with the given sphere</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">                          Expected size is [n x 2 x 3], where n could be any real number.</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    """</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sphere</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">sphere</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">distance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">ray</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">loss_l2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s2">"sum"</span><span class="p">)</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">([</span><span class="n">distance</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dynamic_ncols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">propagated_ray</span> <span class="o">=</span> <span class="n">propagate_ray</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">test</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>            <span class="p">(</span><span class="n">propagated_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sphere</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>            <span class="o">+</span> <span class="p">(</span><span class="n">propagated_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sphere</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>            <span class="o">+</span> <span class="p">(</span><span class="n">propagated_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">sphere</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="o">-</span> <span class="n">sphere</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="p">)</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_l2</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">test</span><span class="p">))</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">"Sphere intersection loss: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">check</span> <span class="o">=</span> <span class="n">test</span> <span class="o">&lt;</span> <span class="n">error_threshold</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">intersecting_ray</span> <span class="o">=</span> <span class="n">propagate_ray</span><span class="p">(</span><span class="n">ray</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">],</span> <span class="n">distance</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">])</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">intersecting_normal</span> <span class="o">=</span> <span class="n">create_ray_from_two_points</span><span class="p">(</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>        <span class="n">sphere</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">intersecting_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="p">)</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">return</span> <span class="n">intersecting_ray</span><span class="p">,</span> <span class="n">intersecting_normal</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">check</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>The <code>odak.learn.raytracing.intersect_w_sphere</code> function uses an optimizer to identify intersection points for each ray.
Instead, a function could have accomplished the task with a closed-form solution without iterating over the intersection test, which could have been much faster than the current function.
If you are curious about how to fix the highlighted issue, you may want to see the challenge provided below.</p>
<p>Let us examine how we can use the provided sphere intersection function with an example provided at the end of this subsection.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio"><div class="tabbed-labels"><label for="__tabbed_6_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_intersect_w_a_sphere.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">):</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">starting_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="p">)</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>    <span class="n">end_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="p">)</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">starting_points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>    <span class="n">center</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]])</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">radius</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">3.0</span><span class="p">]])</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="n">sphere</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">define_sphere</span><span class="p">(</span><span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>  <span class="c1"># (1)</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>        <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_sphere</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">sphere</span><span class="p">)</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="p">)</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># (2)</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span><span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>            <span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">],</span> <span class="n">intersecting_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>        <span class="p">)</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_sphere</span><span class="p">(</span><span class="n">sphere</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">intersecting_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
<ol>
<li>Here we provide an example use case for <code>odak.learn.raytracing.intersect_w_sphere</code> by providing a sphere and a batch of sample rays.</li>
<li>Uncomment for running visualization.</li>
</ol>
</div>
</div>
</div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../media/sphere_rays.png" data-desc-position="bottom"><img alt="Image title" src="../media/sphere_rays.png" width="600"></a>
  </p>
<figcaption>Screenshow showing a sphere and ray intersections generated by "test_learn_raytracing_intersect_w_a_sphere.py" script.</figcaption>
</figure>
<p>This section shows us how to operate with known geometric shapes, precisely spheres.
However, not every shape could be defined using parametric modeling (e.g., nonlinearities such as discontinuities on a surface).
We will look into another method in the next section, an approach used by folks working in Computer Graphics.</p>
<details class="abstract end">
<summary><a href="https://github.com/kaanaksit/odak/discussions/72">Challenge: Raytracing arbitrary surfaces</a></summary>
<p>In light of the given information, we challenge readers to create a new function inside <code>odak.learn.raytracing</code> submodule that replaces the current <code>intersect_w_sphere</code> function.
In addition, the current unit test <code>test/test_learn_raytracing_intersect_w_a_sphere.py</code> has to adopt this new function.
<code>odak.learn.raytracing</code> submodule also needs new functions for supporting arbitrary surfaces (parametric).
New unit tests are needed to improve the submodule accordingly.
To add these to <code>odak,</code> you can rely on the <code>pull request</code> feature on GitHub.
You can also create a new <code>engineering note</code> for arbitrary surfaces in <code>docs/notes/raytracing_arbitrary_surfaces.md</code>.</p>
</details>
<h2 id="intersecting-rays-with-meshes">Intersecting rays with meshes <span class="twemoji mdx-pulse" title="Too important!"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"></path></svg></span><a class="headerlink" href="#intersecting-rays-with-meshes" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical</p>
<p>Parametric surfaces provide ease in defining shapes and geometries in various fields, including Optics and Computer Graphics.
However, not every object in a given scene could easily be described using parametric surfaces.
In many cases, including modern Computer Graphics, triangles formulate the smallest particle of an object or a shape.
These triangles altogether form meshes that define objects and shapes.
For this purpose, we will review source codes, parameters, and returns of three utility functions here.
We will first review <code>odak.learn.raytracing.intersect_w_surface</code> to understand how one can calculate the intersection of a ray with a given plane.
Later, we review <code>odak.learn.raytracing.is_it_on_triangle</code> function, which checks if an intersection point on a given surface is inside a triangle on that surface.
Finally, we will review <code>odak.learn.raytracing.intersect_w_triangle</code> function.
This last function combines both reviewed functions into a single function to identify the intersection between rays and a triangle.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:3"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio"><input id="__tabbed_7_2" name="__tabbed_7" type="radio"><input id="__tabbed_7_3" name="__tabbed_7" type="radio"><div class="tabbed-labels"><label for="__tabbed_7_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.intersect_w_surface</code></label><label for="__tabbed_7_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.is_it_on_triangle</code></label><label for="__tabbed_7_3"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.intersect_w_triangle</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.intersect_w_surface"></a>
    <div class="doc doc-contents first">

        <p>Definition to find intersection point inbetween a surface and a ray. For more see: http://geomalgorithms.com/a06-_intersect-2.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>ray</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       A vector/ray.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>points</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       Set of points in X,Y and Z to define a planar surface.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>normal</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Surface normal at the point of intersection.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>distance</code></b> (              <code><span title="float">float</span></code>
)          –
          <div class="doc-md-description">
            <p>Distance in between starting point of a ray with it's intersection with a planar surface.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/boundary.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="k">def</span><span class="w"> </span><span class="nf">intersect_w_surface</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">    Definition to find intersection point inbetween a surface and a ray. For more see: http://geomalgorithms.com/a06-_intersect-2.html</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">    ----------</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">    ray          : torch.tensor</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">                   A vector/ray.</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    points       : torch.tensor</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">                   Set of points in X,Y and Z to define a planar surface.</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">    Returns</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">    ----------</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">    normal       : torch.tensor</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">                   Surface normal at the point of intersection.</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    distance     : float</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">                   Distance in between starting point of a ray with it's intersection with a planar surface.</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    """</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">normal</span> <span class="o">=</span> <span class="n">get_triangle_normal</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">points</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="n">f</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="n">distance</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a>    <span class="n">new_normal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ray</span><span class="p">)</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">new_normal</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="n">new_normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">new_normal</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">new_normal</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">),</span> <span class="n">posinf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">),</span> <span class="n">neginf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">)</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="p">)</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">distance</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">distance</span><span class="p">,</span> <span class="n">nan</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">),</span> <span class="n">posinf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">),</span> <span class="n">neginf</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s2">"nan"</span><span class="p">)</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="p">)</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="k">return</span> <span class="n">new_normal</span><span class="p">,</span> <span class="n">distance</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.is_it_on_triangle"></a>
    <div class="doc doc-contents first">

        <p>Definition to check if a given point is inside a triangle.
If the given point is inside a defined triangle, this definition returns True.
For more details, visit: <a href="https://blackpawn.com/texts/pointinpoly/">https://blackpawn.com/texts/pointinpoly/</a>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>point_to_check</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Point(s) to check.
          Expected size is [3], [1 x 3] or [m x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>triangle</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>          Triangle described with three points.
          Expected size is [3 x 3], [1 x 3 x 3] or [m x 3 x3].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>result</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Is it on a triangle? Returns NaN if condition not satisfied.
Expected size is [1] or [m] depending on the input.</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/primitives.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="k">def</span><span class="w"> </span><span class="nf">is_it_on_triangle</span><span class="p">(</span><span class="n">point_to_check</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    Definition to check if a given point is inside a triangle.</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    If the given point is inside a defined triangle, this definition returns True.</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    For more details, visit: [https://blackpawn.com/texts/pointinpoly/](https://blackpawn.com/texts/pointinpoly/).</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    ----------</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    point_to_check  : torch.tensor</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">                      Point(s) to check.</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">                      Expected size is [3], [1 x 3] or [m x 3].</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">    triangle        : torch.tensor</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">                      Triangle described with three points.</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">                      Expected size is [3 x 3], [1 x 3 x 3] or [m x 3 x3].</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    Returns</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">    -------</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    result          : torch.tensor</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">                      Is it on a triangle? Returns NaN if condition not satisfied.</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">                      Expected size is [1] or [m] depending on the input.</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    """</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_to_check</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="n">point_to_check</span> <span class="o">=</span> <span class="n">point_to_check</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">triangle</span> <span class="o">=</span> <span class="n">triangle</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="n">v0</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">triangle</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="n">v1</span> <span class="o">=</span> <span class="n">triangle</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">triangle</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="n">v2</span> <span class="o">=</span> <span class="n">point_to_check</span> <span class="o">-</span> <span class="n">triangle</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">v1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="n">dot00</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v0</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">dot01</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="n">dot02</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">v2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="n">dot11</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v1</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="n">dot12</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">invDenom</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">dot00</span> <span class="o">*</span> <span class="n">dot11</span> <span class="o">-</span> <span class="n">dot01</span> <span class="o">*</span> <span class="n">dot01</span><span class="p">)</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">dot11</span> <span class="o">*</span> <span class="n">dot02</span> <span class="o">-</span> <span class="n">dot01</span> <span class="o">*</span> <span class="n">dot12</span><span class="p">)</span> <span class="o">*</span> <span class="n">invDenom</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">dot00</span> <span class="o">*</span> <span class="n">dot12</span> <span class="o">-</span> <span class="n">dot01</span> <span class="o">*</span> <span class="n">dot02</span><span class="p">)</span> <span class="o">*</span> <span class="n">invDenom</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">u</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.intersect_w_triangle"></a>
    <div class="doc doc-contents first">

        <p>Definition to find intersection point of a ray with a triangle.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>ray</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              A ray [1 x 2 x 3] or a batch of ray [m x 2 x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>triangle</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>              Set of points in X,Y and Z to define a single triangle [1 x 3 x 3].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>normal</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Surface normal at the point of intersection with the surface of triangle.
This could also involve surface normals that are not on the triangle.
Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>distance</code></b> (              <code><span title="float">float</span></code>
)          –
          <div class="doc-md-description">
            <p>Distance in between a starting point of a ray and the intersection point with a given triangle.
Expected size is [1 x 1] or [m x 1] depending on the input.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>intersecting_ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Rays that intersect with the triangle plane and on the triangle.
Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>intersecting_normal</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Normals that intersect with the triangle plane and on the triangle.
Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
<b><code>check</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>A list that provides a bool as True or False for each ray used as input.
A test to see is a ray could be on the given triangle.
Expected size is [1] or [m].</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/boundary.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="k">def</span><span class="w"> </span><span class="nf">intersect_w_triangle</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">triangle</span><span class="p">):</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Definition to find intersection point of a ray with a triangle.</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    ----------</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">    ray                 : torch.tensor</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">                          A ray [1 x 2 x 3] or a batch of ray [m x 2 x 3].</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    triangle            : torch.tensor</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">                          Set of points in X,Y and Z to define a single triangle [1 x 3 x 3].</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">    Returns</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">    ----------</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">    normal              : torch.tensor</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">                          Surface normal at the point of intersection with the surface of triangle.</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">                          This could also involve surface normals that are not on the triangle.</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">                          Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</span>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    distance            : float</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">                          Distance in between a starting point of a ray and the intersection point with a given triangle.</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">                          Expected size is [1 x 1] or [m x 1] depending on the input.</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    intersecting_ray    : torch.tensor</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">                          Rays that intersect with the triangle plane and on the triangle.</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">                          Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    intersecting_normal : torch.tensor</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">                          Normals that intersect with the triangle plane and on the triangle.</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">                          Expected size is [1 x 2 x 3] or [m x 2 x 3] depending on the input.</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    check               : torch.tensor</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">                          A list that provides a bool as True or False for each ray used as input.</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">                          A test to see is a ray could be on the given triangle.</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">                          Expected size is [1] or [m].</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    """</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">triangle</span> <span class="o">=</span> <span class="n">triangle</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="n">ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">normal</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">intersect_w_surface</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="n">triangle</span><span class="p">)</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="n">check</span> <span class="o">=</span> <span class="n">is_it_on_triangle</span><span class="p">(</span><span class="n">normal</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">triangle</span><span class="p">)</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">intersecting_ray</span> <span class="o">=</span> <span class="n">ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">intersecting_ray</span> <span class="o">=</span> <span class="n">intersecting_ray</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="n">intersecting_ray</span> <span class="o">=</span> <span class="n">intersecting_ray</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">intersecting_normal</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="n">intersecting_normal</span> <span class="o">=</span> <span class="n">intersecting_normal</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">triangle</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="n">intersecting_normal</span> <span class="o">=</span> <span class="n">intersecting_normal</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="k">return</span> <span class="n">normal</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">intersecting_ray</span><span class="p">,</span> <span class="n">intersecting_normal</span><span class="p">,</span> <span class="n">check</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>Using the provided utility functions above, let us build an example below that helps us find intersections between a triangle and a batch of rays.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio"><div class="tabbed-labels"><label for="__tabbed_8_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_intersect_w_a_triangle.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">):</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">starting_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">end_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="p">)</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">starting_points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">triangle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]]])</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">normals</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_triangle</span><span class="p">(</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">rays</span><span class="p">,</span> <span class="n">triangle</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="p">)</span>  <span class="c1"># (2)</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># (1)</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>            <span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">marker_size</span><span class="o">=</span><span class="mf">3.0</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>        <span class="p">)</span>  <span class="c1"># (1)</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>        <span class="k">for</span> <span class="n">color_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>            <span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">color_id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"green"</span><span class="p">)</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>            <span class="k">elif</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">color_id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
<ol>
<li>Uncomment for running visualization.</li>
<li>Returning intersection normals as new rays, distances from starting point of input rays and a check which returns True if intersection points are inside the triangle.</li>
</ol>
</div>
</div>
</div>
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>                <div id="c4b7e43e-4358-4ab9-aac5-eff46bf1ec43" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("c4b7e43e-4358-4ab9-aac5-eff46bf1ec43")) {                    Plotly.newPlot(                        "c4b7e43e-4358-4ab9-aac5-eff46bf1ec43",                        [{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,5.0,0.0],"y":[-5.0,-5.0,5.0],"z":[10.0,10.0,10.0],"type":"mesh3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-5.0,-5.0,-5.0,-5.0,-5.0,-2.5,-2.5,-2.5,-2.5,-2.5,0.0,0.0,0.0,0.0,0.0,2.5,2.5,2.5,2.5,2.5,5.0,5.0,5.0,5.0,5.0],"y":[-5.0,-2.5,0.0,2.5,5.0,-5.0,-2.5,0.0,2.5,5.0,-5.0,-2.5,0.0,2.5,5.0,-5.0,-2.5,0.0,2.5,5.0,-5.0,-2.5,0.0,2.5,5.0],"z":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,-3.0],"y":[-5.0,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,-3.0],"y":[-2.5,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,-3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,-3.0],"y":[2.5,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,-3.0],"y":[5.0,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-2.5,-1.5],"y":[-5.0,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-2.5,-1.5],"y":[-2.5,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-2.5,-1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-2.5,-1.5],"y":[2.5,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-2.5,-1.5],"y":[5.0,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-5.0,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-2.5,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[2.5,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[5.0,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[2.5,1.5],"y":[-5.0,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[2.5,1.5],"y":[-2.5,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[2.5,1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[2.5,1.5],"y":[2.5,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[2.5,1.5],"y":[5.0,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,3.0],"y":[-5.0,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,3.0],"y":[-2.5,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,3.0],"y":[2.5,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[5.0,3.0],"y":[5.0,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"marker":{"color":["green","green","red","red","red","green","green","green","green","red","green","green","green","green","green","green","green","green","green","red","green","green","red","red","red"],"opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-3.0,-3.0,-3.0,-3.0,-3.0,-1.5,-1.5,-1.5,-1.5,-1.5,0.0,0.0,0.0,0.0,0.0,1.5,1.5,1.5,1.5,1.5,3.0,3.0,3.0,3.0,3.0],"y":[-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0],"z":[10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0],"type":"scatter3d"}],                        {"annotations":[{"font":{"size":16},"showarrow":false,"text":"Ray visualization","x":0.5,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"scene":{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]}},"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}}},                        {"responsive": true}                    )                };                            </script>        </div>

<details class="question end">
<summary>Why should we be interested in ray and triangle intersections?</summary>
<p>Modern Computer Graphics uses various representations for defining three-dimensional objects and scenes.
These representations include:</p>
<ul>
<li>Point Clouds: a series of XYZ coordinates from the surface of a three-dimensional object,</li>
<li>Meshes: a soup of triangles that represents a surface of a three-dimensional object,</li>
<li>Signed Distance Functions: a function informing about the distance between an XYZ point and a surface of a three-dimensional object,</li>
<li>Neural Radiance Fields: A machine learning approach to learning ray patterns from various perspectives.</li>
</ul>
<p>Historically, meshes have been mainly used to represent three-dimensional objects.
Thus, intersecting rays and triangles are important for most Computer Graphics.</p>
</details>
<details class="abstract end">
<summary><a href="https://github.com/kaanaksit/odak/discussions/73">Challenge: Many triangles!</a></summary>
<p>The example provided above deals with a ray and a batch of rays.
However, objects represented with triangles are typically described with many triangles but not one.
Note that <code>odak.learn.raytracing.intersect_w_triangle</code> deal with each triangle one by one, and may lead to slow execution times as the function has to visit each triangle one by one.
Given the information, we challenge readers to create a new function inside <code>odak.learn.raytracing</code> submodule named <code>intersect_w_mesh</code>.
This new function has to be able to work with multiple triangles (meshes) and has to be aware of "occlusions" (e.g., a triangle blocking another triangle).
In addition, a new unit test, <code>test/test_learn_raytracing_intersect_w_mesh.py</code>, has to adopt this new function.
To add these to <code>odak,</code> you can rely on the <code>pull request</code> feature on GitHub.
You can also create a new <code>engineering note</code> for arbitrary surfaces in <code>docs/notes/raytracing_meshes.md</code>.</p>
</details>
<h2 id="refracting-and-reflecting-rays">Refracting and reflecting rays <span class="twemoji mdx-pulse" title="Too important!"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m23 12-2.44-2.78.34-3.68-3.61-.82-1.89-3.18L12 3 8.6 1.54 6.71 4.72l-3.61.81.34 3.68L1 12l2.44 2.78-.34 3.69 3.61.82 1.89 3.18L12 21l3.4 1.46 1.89-3.18 3.61-.82-.34-3.68zm-10 5h-2v-2h2zm0-4h-2V7h2z"></path></svg></span><a class="headerlink" href="#refracting-and-reflecting-rays" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical </p>
<p>In the previous subsections, we reviewed ray intersection with various surface representations, including parametric (e.g., spheres) and non-parametric (e.g., meshes).
Please remember that raytracing is the most simplistic modeling of light.
Thus, often raytracing does not account for any wave or quantum-related nature of light.
To our knowledge, light refracts, reflects, or diffracts when light interfaces with a surface or, in other words, a changing medium (e.g., light traveling from air to glass).
In that case, our next step should be identifying a methodology to help us model these events using rays.
We compiled two utility functions that could help us to model a refraction or a reflection.
These functions are named <code>odak.learn.raytracing.refract</code> <sup id="fnref:spencer1962general"><a class="footnote-ref" href="#fn:spencer1962general">1</a></sup> and <code>odak.learn.raytracing.reflect</code> <sup id="fnref2:spencer1962general"><a class="footnote-ref" href="#fn:spencer1962general">1</a></sup>.
This first one, <code>odak.learn.raytracing.refract</code> follows <a href="https://en.wikipedia.org/wiki/Snell's_law">Snell's law of refraction</a>, while <code>odak.learn.raytracing.reflect</code> follows a perfect reflection case.
We will not go into details of this theory as its simplest form in the way we discuss it could now be considered common knowledge.
However, for curious readers, the work by <a href="https://doi.org/10.1364/JOSA.59.000187">Bell et al.</a> <sup id="fnref:bell1969generalized"><a class="footnote-ref" href="#fn:bell1969generalized">5</a></sup> provides a generalized solution for the laws of refraction and reflection.
Let us carefully examine these two utility functions to understand their internal workings.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio"><input id="__tabbed_9_2" name="__tabbed_9" type="radio"><div class="tabbed-labels"><label for="__tabbed_9_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.refract</code></label><label for="__tabbed_9_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>odak.learn.raytracing.reflect</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.refract"></a>
    <div class="doc doc-contents first">

        <p>Definition to refract an incoming ray.
Used method described in G.H. Spencer and M.V.R.K. Murty, "General Ray-Tracing Procedure", 1961.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>vector</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>         Incoming ray.
         Expected size is [2, 3], [1, 2, 3] or [m, 2, 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>normvector</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>         Normal vector.
         Expected size is [2, 3], [1, 2, 3] or [m, 2, 3]].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n1</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>         Refractive index of the incoming medium.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>n2</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>         Refractive index of the outgoing medium.
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>error</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>         Desired error.
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>output</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Refracted ray.
Expected size is [1, 2, 3]</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/boundary.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">refract</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">normvector</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="sd">    Definition to refract an incoming ray.</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="sd">    Used method described in G.H. Spencer and M.V.R.K. Murty, "General Ray-Tracing Procedure", 1961.</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    ----------</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    vector         : torch.tensor</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">                     Incoming ray.</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">                     Expected size is [2, 3], [1, 2, 3] or [m, 2, 3].</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    normvector     : torch.tensor</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">                     Normal vector.</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">                     Expected size is [2, 3], [1, 2, 3] or [m, 2, 3]].</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    n1             : float</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">                     Refractive index of the incoming medium.</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    n2             : float</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">                     Refractive index of the outgoing medium.</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    error          : float</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">                     Desired error.</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28"></a>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Returns</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">    -------</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    output         : torch.tensor</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">                     Refracted ray.</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">                     Expected size is [1, 2, 3]</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    """</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">vector</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normvector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">normvector</span> <span class="o">=</span> <span class="n">normvector</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">mu</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">/</span> <span class="n">n2</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="n">div</span> <span class="o">=</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="n">mu</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="o">+</span> <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="o">+</span> <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="p">)</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="o">/</span> <span class="n">div</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="p">)</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">div</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">to</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="n">a</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="n">eps</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">vector</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="n">error</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">eps</span><span class="p">[</span><span class="n">eps</span> <span class="o">&gt;</span> <span class="n">error</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">oldto</span> <span class="o">=</span> <span class="n">to</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">v</span> <span class="o">=</span> <span class="n">to</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">to</span> <span class="o">+</span> <span class="n">b</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">deltav</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">to</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">to</span> <span class="o">=</span> <span class="n">to</span> <span class="o">-</span> <span class="n">v</span> <span class="o">/</span> <span class="n">deltav</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">oldto</span> <span class="o">-</span> <span class="n">to</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">to</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">to</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">output</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">vector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">to</span> <span class="o">*</span> <span class="n">normvector</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="k">return</span> <span class="n">output</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
<div class="tabbed-block">


<div class="doc doc-object doc-function">



<a id="odak.learn.raytracing.reflect"></a>
    <div class="doc doc-contents first">

        <p>Definition to reflect an incoming ray from a surface defined by a surface normal.
Used method described in G.H. Spencer and M.V.R.K. Murty, "General Ray-Tracing Procedure", 1961.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>input_ray</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       A ray or rays.
       Expected size is [2 x 3], [1 x 2 x 3] or [m x 2 x 3].
</code></pre></div>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>normal</code></b>
          –
          <div class="doc-md-description">
            <div class="language-text highlight"><pre><span></span><code>       A surface normal(s).
       Expected size is [2 x 3], [1 x 2 x 3] or [m x 2 x 3].
</code></pre></div>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
<b><code>output_ray</code></b> (              <code><span title="torch.tensor">tensor</span></code>
)          –
          <div class="doc-md-description">
            <p>Array that contains starting points and cosines of a reflected ray.
Expected size is [1 x 2 x 3] or [m x 2 x 3].</p>
          </div>
        </li>
    </ul>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>odak/learn/raytracing/boundary.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="k">def</span><span class="w"> </span><span class="nf">reflect</span><span class="p">(</span><span class="n">input_ray</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Definition to reflect an incoming ray from a surface defined by a surface normal.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Used method described in G.H. Spencer and M.V.R.K. Murty, "General Ray-Tracing Procedure", 1961.</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    ----------</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    input_ray    : torch.tensor</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">                   A ray or rays.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">                   Expected size is [2 x 3], [1 x 2 x 3] or [m x 2 x 3].</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    normal       : torch.tensor</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">                   A surface normal(s).</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">                   Expected size is [2 x 3], [1 x 2 x 3] or [m x 2 x 3].</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Returns</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    ----------</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">    output_ray   : torch.tensor</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">                   Array that contains starting points and cosines of a reflected ray.</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">                   Expected size is [1 x 2 x 3] or [m x 2 x 3].</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    """</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">input_ray</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">input_ray</span> <span class="o">=</span> <span class="n">input_ray</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">normal</span> <span class="o">=</span> <span class="n">normal</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">mu</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">div</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">1e-8</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a>        <span class="n">mu</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="o">*</span> <span class="p">(</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a>            <span class="n">input_ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="o">+</span> <span class="n">input_ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="o">+</span> <span class="n">input_ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="o">/</span> <span class="n">div</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="p">)</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="n">normal</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">input_ray</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]])))</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="n">output_ray</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">input_ray</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="n">output_ray</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="n">output_ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_ray</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span> <span class="o">*</span> <span class="n">normal</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="k">return</span> <span class="n">output_ray</span>
</span></code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div></div>
</div>
</div>
<p>Please note that we provide two refractive indices as inputs in <code>odak.learn.raytracing.refract</code>.
These inputs represent the refractive indices of two mediums (e.g., air and glass).
However, the refractive index of a medium is dependent on light's wavelength (color).
In the following example, where we showcase a sample use case of these utility functions, we will assume that light has a single wavelength.
But bear in mind that when you need to ray trace with lots of wavelengths (multi-color RGB or hyperspectral), one must ray trace for each wavelength (color).
Thus, the computational complexity of the raytracing increases dramatically as we aim growing realism in the simulations (e.g., describe scenes per color, raytracing for each color).
Let's dive deep into how we use these functions in an actual example by observing the example below.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio"><div class="tabbed-labels"><label for="__tabbed_10_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_refract_reflect.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">):</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="n">starting_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>    <span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>    <span class="n">end_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>    <span class="p">)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">starting_points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>    <span class="n">triangle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]]])</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>    <span class="n">normals</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_triangle</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">triangle</span><span class="p">)</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>    <span class="p">)</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>    <span class="n">n_air</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># (1)</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>    <span class="n">n_glass</span> <span class="o">=</span> <span class="mf">1.51</span>  <span class="c1"># (2)</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>    <span class="n">refracted_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">refract</span><span class="p">(</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>        <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span><span class="p">,</span> <span class="n">n_air</span><span class="p">,</span> <span class="n">n_glass</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a>    <span class="p">)</span>  <span class="c1"># (3)</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>    <span class="n">reflected_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>        <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>    <span class="p">)</span>  <span class="c1"># (4)</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>    <span class="n">refract_distance</span> <span class="o">=</span> <span class="mf">11.0</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>    <span class="n">reflect_distance</span> <span class="o">=</span> <span class="mf">7.2</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>    <span class="n">propagated_refracted_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">propagate_ray</span><span class="p">(</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>        <span class="n">refracted_rays</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">refracted_rays</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">refract_distance</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>    <span class="p">)</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>    <span class="n">propagated_reflected_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">propagate_ray</span><span class="p">(</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>        <span class="n">reflected_rays</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">reflected_rays</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">reflect_distance</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>    <span class="p">)</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>            <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>            <span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>            <span class="n">marker_size</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>            <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">"Refraction example"</span><span class="p">,</span> <span class="s2">"Reflection example"</span><span class="p">],</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>        <span class="p">)</span>  <span class="c1"># (1)</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>            <span class="n">refracted_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>            <span class="n">propagated_refracted_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a>            <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a>        <span class="p">)</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a>            <span class="n">reflected_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a>            <span class="n">propagated_reflected_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>            <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>        <span class="p">)</span>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>        <span class="n">colors</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>        <span class="k">for</span> <span class="n">color_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>            <span class="k">if</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">color_id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"green"</span><span class="p">)</span>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>            <span class="k">elif</span> <span class="n">check</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">color_id</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>                <span class="n">colors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"red"</span><span class="p">)</span>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
<ol>
<li>Refractive index of air (arbitrary and regardless of wavelength), the medium before the ray and triangle intersection. </li>
<li>Refractive index of glass (arbitrary and regardless of wavelength), the medium after the ray and triangle intersection.</li>
<li>Refraction process.</li>
<li>Reflection process.</li>
</ol>
</div>
</div>
</div>
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>                <div id="db79d5e8-6a2a-4723-948f-69a8abd08d11" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("db79d5e8-6a2a-4723-948f-69a8abd08d11")) {                    Plotly.newPlot(                        "db79d5e8-6a2a-4723-948f-69a8abd08d11",                        [{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,5.0,0.0],"y":[-5.0,-5.0,5.0],"z":[10.0,10.0,10.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-5.0,5.0,0.0],"y":[-5.0,-5.0,5.0],"z":[10.0,10.0,10.0],"type":"mesh3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-7.5,-7.5,-7.5,-7.5,-7.5,-3.75,-3.75,-3.75,-3.75,-3.75,0.0,0.0,0.0,0.0,0.0,3.75,3.75,3.75,3.75,3.75,7.5,7.5,7.5,7.5,7.5],"y":[-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5],"z":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"type":"scatter3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene2","showlegend":false,"x":[-7.5,-7.5,-7.5,-7.5,-7.5,-3.75,-3.75,-3.75,-3.75,-3.75,0.0,0.0,0.0,0.0,0.0,3.75,3.75,3.75,3.75,3.75,7.5,7.5,7.5,7.5,7.5],"y":[-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5,-7.5,-3.75,0.0,3.75,7.5],"z":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-7.5,-3.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-7.5,-3.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-7.5,-3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-7.5,-3.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-7.5,-3.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.75,-1.5],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.75,-1.5],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.75,-1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.75,-1.5],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.75,-1.5],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.75,1.5],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.75,1.5],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.75,1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.75,1.5],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.75,1.5],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[7.5,3.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[7.5,3.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[7.5,3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[7.5,3.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[7.5,3.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-7.5,-3.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-7.5,-3.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-7.5,-3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-7.5,-3.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-7.5,-3.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.75,-1.5],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.75,-1.5],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.75,-1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.75,-1.5],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.75,-1.5],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.75,1.5],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.75,1.5],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.75,1.5],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.75,1.5],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.75,1.5],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[7.5,3.0],"y":[-7.5,-3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[7.5,3.0],"y":[-3.75,-1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[7.5,3.0],"y":[0.0,0.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[7.5,3.0],"y":[3.75,1.5],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[7.5,3.0],"y":[7.5,3.0],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.0,-0.23439526557922363],"y":[-3.0,-0.23439526557922363],"z":[10.0,20.28152084350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-3.0,-0.07159566879272461],"y":[-1.5,-0.035797834396362305],"z":[10.0,20.50164794921875],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-1.5,-0.035797834396362305],"y":[-3.0,-0.07159566879272461],"z":[10.0,20.50164794921875],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-1.5,0.061907410621643066],"y":[-1.5,0.061907410621643066],"z":[10.0,20.776042938232422],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-1.5,0.09909546375274658],"y":[0.0,0.0],"z":[10.0,20.883230209350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-1.5,0.061907410621643066],"y":[1.5,-0.061907410621643066],"z":[10.0,20.776042938232422],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-3.0,-0.010588407516479492],"z":[10.0,20.58616065979004],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.5,0.09909546375274658],"z":[10.0,20.883230209350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.0,0.0],"z":[10.0,21.000064849853516],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[1.5,-0.09909546375274658],"z":[10.0,20.883230209350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[3.0,0.010588407516479492],"z":[10.0,20.58616065979004],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[1.5,0.035797834396362305],"y":[-3.0,-0.07159566879272461],"z":[10.0,20.50164794921875],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[1.5,-0.061907410621643066],"y":[-1.5,0.061907410621643066],"z":[10.0,20.776042938232422],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[1.5,-0.09909546375274658],"y":[0.0,0.0],"z":[10.0,20.883230209350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[1.5,-0.061907410621643066],"y":[1.5,-0.061907410621643066],"z":[10.0,20.776042938232422],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.0,0.23439526557922363],"y":[-3.0,-0.23439526557922363],"z":[10.0,20.28152084350586],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[3.0,0.07159566879272461],"y":[-1.5,-0.035797834396362305],"z":[10.0,20.50164794921875],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.0,-0.26657700538635254],"y":[-3.0,-0.26657700538635254],"z":[10.0,3.925726890563965],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.0,-0.10567164421081543],"y":[-1.5,-0.052835822105407715],"z":[10.0,3.5681591033935547],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-1.5,-0.052835822105407715],"y":[-3.0,-0.10567164421081543],"z":[10.0,3.5681591033935547],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-1.5,0.043732523918151855],"y":[-1.5,0.043732523918151855],"z":[10.0,3.1389670372009277],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-1.5,0.08048772811889648],"y":[0.0,0.0],"z":[10.0,2.97560977935791],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-1.5,0.043732523918151855],"y":[1.5,-0.043732523918151855],"z":[10.0,3.1389670372009277],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-3.0,-0.045374393463134766],"z":[10.0,3.4341650009155273],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-1.5,0.08048772811889648],"z":[10.0,2.97560977935791],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[0.0,0.0],"z":[10.0,2.8000001907348633],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[1.5,-0.08048772811889648],"z":[10.0,2.97560977935791],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[3.0,0.045374393463134766],"z":[10.0,3.4341650009155273],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[1.5,0.052835822105407715],"y":[-3.0,-0.10567164421081543],"z":[10.0,3.5681591033935547],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[1.5,-0.043732523918151855],"y":[-1.5,0.043732523918151855],"z":[10.0,3.1389670372009277],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[1.5,-0.08048772811889648],"y":[0.0,0.0],"z":[10.0,2.97560977935791],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[1.5,-0.043732523918151855],"y":[1.5,-0.043732523918151855],"z":[10.0,3.1389670372009277],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.0,0.26657700538635254],"y":[-3.0,-0.26657700538635254],"z":[10.0,3.925726890563965],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[3.0,0.10567164421081543],"y":[-1.5,-0.052835822105407715],"z":[10.0,3.5681591033935547],"type":"scatter3d"},{"marker":{"color":["green","green","red","red","red","green","green","green","green","red","green","green","green","green","green","green","green","green","green","red","green","green","red","red","red"],"opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-3.0,-3.0,-3.0,-3.0,-3.0,-1.5,-1.5,-1.5,-1.5,-1.5,0.0,0.0,0.0,0.0,0.0,1.5,1.5,1.5,1.5,1.5,3.0,3.0,3.0,3.0,3.0],"y":[-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0],"z":[10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0],"type":"scatter3d"},{"marker":{"color":["green","green","red","red","red","green","green","green","green","red","green","green","green","green","green","green","green","green","green","red","green","green","red","red","red"],"opacity":0.5,"size":3.0},"mode":"markers","scene":"scene2","showlegend":false,"x":[-3.0,-3.0,-3.0,-3.0,-3.0,-1.5,-1.5,-1.5,-1.5,-1.5,0.0,0.0,0.0,0.0,0.0,1.5,1.5,1.5,1.5,1.5,3.0,3.0,3.0,3.0,3.0],"y":[-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0,-3.0,-1.5,0.0,1.5,3.0],"z":[10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0,10.0],"type":"scatter3d"}],                        {"annotations":[{"font":{"size":16},"showarrow":false,"text":"Refraction example","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Reflection example","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"scene":{"domain":{"x":[0.0,0.45],"y":[0.0,1.0]}},"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"scene2":{"domain":{"x":[0.55,1.0],"y":[0.0,1.0]}}},                        {"responsive": true}                    )                };                            </script>        </div>

<details class="abstract end">
<summary><a href="https://github.com/kaanaksit/odak/discussions/74">Challenge: Diffracted intefering rays</a></summary>
<p>This subsection covered simulating refraction and reflection events.
However, <a href="https://youtu.be/z_AtSgct6_I?t=4956">diffraction or interference</a> <sup id="fnref:born2013principles"><a class="footnote-ref" href="#fn:born2013principles">6</a></sup> is not introduced in this raytracing model.
This is because diffraction and interference would require another layer of complication.
In other words, rays have to have an extra dimension beyond their starting points and direction cosines, and they also have to have the quality named phase of light.
This fact makes a typical ray have dimensions of [1 x 3 x 3] instead of [1 x 2 x 3], where only direction cosines and starting points are defined.
Given the information, we challenge readers to create a new submodule, <code>odak.learn.raytracing.diffraction</code>, extending rays to diffraction and interference.
In addition, a new set of unit tests should be derived to adopt this new function submodule.
To add these to <code>odak,</code> you can rely on the <code>pull request</code> feature on GitHub.
You can also create a new <code>engineering note</code> for arbitrary surfaces in <code>docs/notes/raytracing_diffraction_interference.md</code>.</p>
</details>
<h2 id="optimization-with-rays">Optimization with rays<a class="headerlink" href="#optimization-with-rays" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical </p>
<p>We learned about refraction, reflection, rays, and surface intersections in the previous subsection.
We didn't mention it then, but these functions are differentiable <sup id="fnref:paszke2017automatic"><a class="footnote-ref" href="#fn:paszke2017automatic">7</a></sup>.
In other words, a modern machine learning library can keep a graph of a variable passing through each one of these functions (see <a href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a>).
This differentiability feature is vital because differentiability makes our simulations for light with raytracing based on these functions compatible with modern machine learning frameworks such as Torch.
In this subsection, we will use an off-the-shelf optimizer from Torch to optimize variables in our ray tracing simulations.
In the first example, we will see that the optimizer helps us define the proper tilt angles for a triangle-shaped mirror and redirect light from a point light source towards a given target.
Our first example resembles a straightforward case for optimization by containing only a batch of rays and a single triangle.
The problem highlighted in the first example has a closed-form solution, and using an optimizer is obviously overkill.
We want our readers to understand that the first example is a warm-up scenario where our readers understand how to interact with race and triangles in the context of an optimization problem.
In our following second example, we will deal with a more sophisticated case where a batch of rays arriving from a point light source bounces off a surface with multiple triangles in parentheses mesh and comes at some point in our final target plane.
This time we will ask our optimizer to optimize the shape of our triangles so that most of the light bouncing off there's optimized surface ends up at a location close to a target we define in our simulation.
This way, we show our readers that a more sophisticated shape could be optimized using our framework, Odak.
In real life, the second example could be a lens or mirror shape to be optimized. 
More specifically, as an application example, it could be a mirror or a lens that focuses light from the Sun onto a solar cell to increase the efficiency of a solar power system, or it could have been a lens helping you to focus on a specific depth given your eye prescription.
Let us start from our first example and examine how we can tilt the surfaces using an optimizer, and in this second example, let us see how an optimizer helps us define and optimize shape for a given mesh.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio"><div class="tabbed-labels"><label for="__tabbed_11_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_optimization.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">header</span><span class="o">=</span><span class="s2">"test_learn_raytracing_optimization.py"</span><span class="p">,</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="p">):</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="n">final_surface</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="p">[[[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]]</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>    <span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>    <span class="n">final_target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]])</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>    <span class="n">triangle</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]])</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="n">starting_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>    <span class="p">)</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>    <span class="n">end_point</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">center_of_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">starting_points</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>    <span class="n">angles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>    <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">2e-1</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">([</span><span class="n">angles</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>    <span class="n">loss_function</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>    <span class="n">number_of_steps</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dynamic_ncols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>        <span class="n">rotated_triangle</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">rotate_points</span><span class="p">(</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>            <span class="n">triangle</span><span class="p">,</span> <span class="n">angles</span><span class="o">=</span><span class="n">angles</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">end_point</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>        <span class="p">)</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>            <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_triangle</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">rotated_triangle</span><span class="p">)</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>        <span class="p">)</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>        <span class="n">reflected_rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>            <span class="n">intersecting_rays</span><span class="p">,</span> <span class="n">intersecting_normals</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>        <span class="p">)</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>        <span class="n">final_normals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_surface</span><span class="p">(</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>            <span class="n">reflected_rays</span><span class="p">,</span> <span class="n">final_surface</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>        <span class="p">)</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>            <span class="n">start_rays</span> <span class="o">=</span> <span class="n">rays</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>            <span class="n">start_rotated_triangle</span> <span class="o">=</span> <span class="n">rotated_triangle</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>            <span class="n">start_intersecting_rays</span> <span class="o">=</span> <span class="n">intersecting_rays</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>            <span class="n">start_intersecting_normals</span> <span class="o">=</span> <span class="n">intersecting_normals</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>            <span class="n">start_final_normals</span> <span class="o">=</span> <span class="n">final_normals</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>        <span class="n">final_points</span> <span class="o">=</span> <span class="n">final_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">final_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">final_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_function</span><span class="p">(</span><span class="n">final_points</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>        <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">"Loss: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>        <span class="s2">"</span><span class="si">{}</span><span class="s2"> -&gt; Loss: </span><span class="si">{}</span><span class="s2">, angles: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">angles</span><span class="p">)</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>    <span class="p">)</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>            <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>            <span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>            <span class="n">marker_size</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>            <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>                <span class="s2">"Surace before optimization"</span><span class="p">,</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>                <span class="s2">"Surface after optimization"</span><span class="p">,</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>                <span class="s2">"Hits at the target plane before optimization"</span><span class="p">,</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>                <span class="s2">"Hits at the target plane after optimization"</span><span class="p">,</span>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>            <span class="p">],</span>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>        <span class="p">)</span>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span><span class="n">start_rotated_triangle</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span><span class="n">rotated_triangle</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">start_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>            <span class="n">start_intersecting_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>            <span class="n">start_intersecting_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>            <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>        <span class="p">)</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>            <span class="n">intersecting_rays</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">intersecting_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>        <span class="p">)</span>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>            <span class="n">start_intersecting_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>            <span class="n">start_final_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>            <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>        <span class="p">)</span>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>            <span class="n">start_intersecting_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>            <span class="n">final_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>            <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">,</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>        <span class="p">)</span>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">final_target</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">)</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>        <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">final_target</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"green"</span><span class="p">)</span>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
</div>
</div>
</div>
<div>                        <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-2.11.1.min.js"></script>                <div id="265fe3c7-46f5-48fe-ad53-346e12506e4c" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("265fe3c7-46f5-48fe-ad53-346e12506e4c")) {                    Plotly.newPlot(                        "265fe3c7-46f5-48fe-ad53-346e12506e4c",                        [{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-5.0,5.0,0.0],"y":[-5.0,-5.0,5.0],"z":[10.0,10.0,10.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-3.3808789253234863,5.826111316680908,-2.445233106613159],"y":[-6.272851467132568,-3.085897922515869,4.358749866485596],"z":[8.138861656188965,10.39156436920166,11.469573974609375],"type":"mesh3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[-0.5,-0.5,-0.5,-0.5,-0.5,-0.25,-0.25,-0.25,-0.25,-0.25,0.0,0.0,0.0,0.0,0.0,0.25,0.25,0.25,0.25,0.25,0.5,0.5,0.5,0.5,0.5],"y":[-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5],"z":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"type":"scatter3d"},{"marker":{"color":"blue","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene2","showlegend":false,"x":[-0.5,-0.5,-0.5,-0.5,-0.5,-0.25,-0.25,-0.25,-0.25,-0.25,0.0,0.0,0.0,0.0,0.0,0.25,0.25,0.25,0.25,0.25,0.5,0.5,0.5,0.5,0.5],"y":[-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5,-0.5,-0.25,0.0,0.25,0.5],"z":[0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.5,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.5,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.5,0.0],"y":[0.0,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.5,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.5,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.25,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.25,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.25,0.0],"y":[0.0,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.25,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.25,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.0,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.25,-1.6666667461395264],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.25,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.25,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.25,0.0],"y":[0.0,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.25,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.25,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.5,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.5,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.5,0.0],"y":[0.0,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.5,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.5,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.5,-5.960464477539063e-08],"y":[-0.5,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.5,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.5,0.0],"y":[0.0,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.5,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.5,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.25,-2.9802322387695312e-08],"y":[-0.5,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.25,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.25,0.0],"y":[0.0,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.25,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.25,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-0.5,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[-0.25,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[0.0,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[0.25,-1.6666667461395264],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.25,0.0],"y":[-0.5,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.25,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.25,0.0],"y":[0.0,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.25,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.25,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.5,5.960464477539063e-08],"y":[-0.5,-1.6666665077209473],"z":[0.0,9.999999046325684],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.5,0.0],"y":[-0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.5,0.0],"y":[0.0,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.5,0.0],"y":[0.25,-1.6666666269302368],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.5,0.0],"y":[0.5,-1.6666665077209473],"z":[0.0,10.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.5],"y":[-1.6666666269302368,-2.8333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.5],"y":[-1.6666666269302368,-3.0833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.5],"y":[-1.6666665077209473,-3.3333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.5],"y":[-1.6666666269302368,-3.5833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.5],"y":[-1.6666665077209473,-3.8333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.25],"y":[-1.6666666269302368,-2.8333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.25],"y":[-1.6666666269302368,-3.0833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.25],"y":[-1.6666666269302368,-3.3333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.25],"y":[-1.6666666269302368,-3.5833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.25],"y":[-1.6666665077209473,-3.8333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.6666666269302368,-2.8333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.6666666269302368,-3.0833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.6666666269302368,-3.3333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.6666667461395264,-3.5833334922790527],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0],"y":[-1.6666665077209473,-3.8333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.25],"y":[-1.6666666269302368,-2.8333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.25],"y":[-1.6666666269302368,-3.0833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.25],"y":[-1.6666666269302368,-3.3333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.25],"y":[-1.6666666269302368,-3.5833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.25],"y":[-1.6666665077209473,-3.8333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.5],"y":[-1.6666666269302368,-2.8333332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.5],"y":[-1.6666666269302368,-3.0833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.5],"y":[-1.6666665077209473,-3.3333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.5],"y":[-1.6666666269302368,-3.5833332538604736],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.5],"y":[-1.6666665077209473,-3.8333330154418945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.6414151191711426],"y":[-1.6666666269302368,3.5053300857543945],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.6063997745513916],"y":[-1.6666666269302368,3.1826014518737793],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.572463274002075],"y":[-1.6666665077209473,2.8698220252990723],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.539557933807373],"y":[-1.6666666269302368,2.5665411949157715],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.507636547088623],"y":[-1.6666665077209473,2.2723307609558105],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.3336312770843506],"y":[-1.6666666269302368,3.4893832206726074],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.303654432296753],"y":[-1.6666666269302368,3.1692452430725098],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.274595260620117],"y":[-1.6666666269302368,2.8589067459106445],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.246411085128784],"y":[-1.6666666269302368,2.557924270629883],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.2190651893615723],"y":[-1.6666665077209473,2.265882730484009],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.030352830886841],"y":[-1.6666666269302368,3.4736709594726562],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,3.005272150039673],"y":[-1.6666666269302368,3.1560821533203125],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.980952739715576],"y":[-1.6666666269302368,2.848144054412842],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.9573631286621094],"y":[-1.6666667461395264,2.5494282245635986],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.9344685077667236],"y":[-1.6666665077209473,2.259523630142212],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.7314820289611816],"y":[-1.6666666269302368,3.4581871032714844],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.7111594676971436],"y":[-1.6666666269302368,3.143106460571289],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.691451072692871],"y":[-1.6666666269302368,2.837535858154297],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.6723272800445557],"y":[-1.6666666269302368,2.541050434112549],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.6537649631500244],"y":[-1.6666665077209473,2.253251552581787],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.436922073364258],"y":[-1.6666666269302368,3.442925453186035],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.4212255477905273],"y":[-1.6666666269302368,3.1303162574768066],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.405998706817627],"y":[-1.6666665077209473,2.8270740509033203],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.3912222385406494],"y":[-1.6666666269302368,2.5327882766723633],"z":[10.0,0.0],"type":"scatter3d"},{"line":{"color":"blue","width":3.0},"mode":"lines","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,2.376875162124634],"y":[-1.6666665077209473,2.2470641136169434],"z":[10.0,0.0],"type":"scatter3d"},{"marker":{"color":"red","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene","showlegend":false,"x":[3.0],"y":[3.0],"z":[0.0],"type":"scatter3d"},{"marker":{"color":"green","opacity":0.5,"size":3.0},"mode":"markers","scene":"scene2","showlegend":false,"x":[3.0],"y":[3.0],"z":[0.0],"type":"scatter3d"}],                        {"annotations":[{"font":{"size":16},"showarrow":false,"text":"Surace before optimization","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"Surface after optimization","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"scene":{"domain":{"x":[0.0,0.45],"y":[0.0,1.0]}},"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"scene2":{"domain":{"x":[0.55,1.0],"y":[0.0,1.0]}}},                        {"responsive": true}                    )                };                            </script>        </div>

<p>Let us also look into the more sophisticated second example, where a triangular mesh is optimized to meet a specific demand, redirecting rays to a particular target.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="12:1"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio"><div class="tabbed-labels"><label for="__tabbed_12_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_mesh.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">header</span><span class="o">=</span><span class="s2">"test/test_learn_raytracing_mesh.py"</span><span class="p">,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="p">):</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    <span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">"cpu"</span><span class="p">)</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>    <span class="n">final_target</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="n">final_surface</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">define_plane</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">final_target</span><span class="p">)</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">planar_mesh</span><span class="p">(</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>        <span class="n">size</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]),</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>        <span class="n">number_of_meshes</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">]),</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>        <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">,</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>    <span class="p">)</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="n">start_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>    <span class="p">)</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>    <span class="n">end_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>        <span class="n">no</span><span class="o">=</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>    <span class="p">)</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>    <span class="n">start_points</span> <span class="o">=</span> <span class="n">start_points</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>    <span class="n">end_points</span> <span class="o">=</span> <span class="n">end_points</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#__codelineno-5-28"></a>    <span class="n">loss_function</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s2">"sum"</span><span class="p">)</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#__codelineno-5-29"></a>    <span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">2e-3</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#__codelineno-5-30"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">([</span><span class="n">mesh</span><span class="o">.</span><span class="n">heights</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#__codelineno-5-31"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">start_points</span><span class="p">,</span> <span class="n">end_points</span><span class="p">)</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#__codelineno-5-32"></a>    <span class="n">number_of_steps</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#__codelineno-5-33"></a>    <span class="n">t</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_steps</span><span class="p">),</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dynamic_ncols</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#__codelineno-5-34"></a>    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#__codelineno-5-35"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#__codelineno-5-36"></a>        <span class="n">triangles</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_triangles</span><span class="p">()</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#__codelineno-5-37"></a>        <span class="n">reflected_rays</span><span class="p">,</span> <span class="n">reflected_normals</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">mirror</span><span class="p">(</span><span class="n">rays</span><span class="p">)</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#__codelineno-5-38"></a>        <span class="n">final_normals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_surface</span><span class="p">(</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#__codelineno-5-39"></a>            <span class="n">reflected_rays</span><span class="p">,</span> <span class="n">final_surface</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#__codelineno-5-40"></a>        <span class="p">)</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#__codelineno-5-41"></a>        <span class="n">final_points</span> <span class="o">=</span> <span class="n">final_normals</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#__codelineno-5-42"></a>        <span class="n">target</span> <span class="o">=</span> <span class="n">final_target</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">final_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#__codelineno-5-43"></a>        <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#__codelineno-5-44"></a>            <span class="n">start_triangles</span> <span class="o">=</span> <span class="n">triangles</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#__codelineno-5-45"></a>            <span class="n">start_reflected_rays</span> <span class="o">=</span> <span class="n">reflected_rays</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#__codelineno-5-46"></a>            <span class="n">start_final_normals</span> <span class="o">=</span> <span class="n">final_normals</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#__codelineno-5-47"></a>        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_function</span><span class="p">(</span><span class="n">final_points</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#__codelineno-5-48"></a>        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">retain_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#__codelineno-5-49"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#__codelineno-5-50"></a>        <span class="n">description</span> <span class="o">=</span> <span class="s2">"</span><span class="si">{}</span><span class="s2"> -&gt; Loss: </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#__codelineno-5-51"></a>        <span class="n">t</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#__codelineno-5-52"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#__codelineno-5-53"></a>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#__codelineno-5-54"></a>    <span class="n">visualize</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#__codelineno-5-55"></a>    <span class="k">if</span> <span class="n">visualize</span><span class="p">:</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#__codelineno-5-56"></a>        <span class="n">ray_diagram</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plotly</span><span class="o">.</span><span class="n">rayshow</span><span class="p">(</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#__codelineno-5-57"></a>            <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#__codelineno-5-58"></a>            <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#__codelineno-5-59"></a>            <span class="n">line_width</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#__codelineno-5-60"></a>            <span class="n">marker_size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#__codelineno-5-61"></a>            <span class="n">subplot_titles</span><span class="o">=</span><span class="p">[</span><span class="s2">"Before optimization"</span><span class="p">,</span> <span class="s2">"After optimization"</span><span class="p">],</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#__codelineno-5-62"></a>        <span class="p">)</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#__codelineno-5-63"></a>        <span class="k">for</span> <span class="n">triangle_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#__codelineno-5-64"></a>            <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#__codelineno-5-65"></a>                <span class="n">start_triangles</span><span class="p">[</span><span class="n">triangle_id</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#__codelineno-5-66"></a>            <span class="p">)</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#__codelineno-5-67"></a>            <span class="n">ray_diagram</span><span class="o">.</span><span class="n">add_triangle</span><span class="p">(</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#__codelineno-5-68"></a>                <span class="n">triangles</span><span class="p">[</span><span class="n">triangle_id</span><span class="p">],</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#__codelineno-5-69"></a>            <span class="p">)</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#__codelineno-5-70"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">ray_diagram</span><span class="o">.</span><span class="n">save_offline</span><span class="p">()</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#__codelineno-5-71"></a>        <span class="n">markdown_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"</span><span class="si">{}</span><span class="s2">/ray.txt"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="s2">"w"</span><span class="p">)</span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#__codelineno-5-72"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#__codelineno-5-73"></a>        <span class="n">markdown_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#__codelineno-5-74"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#__codelineno-5-75"></a>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#__codelineno-5-76"></a>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#__codelineno-5-77"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#__codelineno-5-78"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
</div>
</div>
</div>
<div>                            <div id="2695fa16-4022-43c9-91a6-8a44bbaa4b87" class="plotly-graph-div" style="height:100%; width:100%;"></div>            <script type="text/javascript">                                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("2695fa16-4022-43c9-91a6-8a44bbaa4b87")) {                    Plotly.newPlot(                        "2695fa16-4022-43c9-91a6-8a44bbaa4b87",                        [{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0055454084649682045,0.005545407999306917,0.002182161435484886],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.002182161435484886,0.003139992244541645,-9.937785216607153e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-9.937785216607153e-05,0.002054185839369893,-0.0013756140833720565],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.0013756140833720565,0.0016916069434955716,-0.0018024155870079994],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.0018024155870079994,0.00215203152038157,-0.0011152835795655847],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.0011152835795655847,0.0036816310603171587,0.00025126710534095764],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.00025126710534095764,0.005900067742913961,0.002618858590722084],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.550000011920929,-0.4125000238418579],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.002618858590722084,0.00937181431800127,0.005947472993284464],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0031399924773722887,0.002182161435484886,-9.937761933542788e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[-9.937761933542788e-05,-9.937785216607153e-05,-0.0024164936039596796],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-0.0024164936039596796,-0.0013756140833720565,-0.0037830001674592495],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.0037830001674592495,-0.0018024155870079994,-0.004109933506697416],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.004109933506697416,-0.0011152835795655847,-0.003457849845290184],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.003457849845290184,0.00025126710534095764,-0.0021152407862246037],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[-0.0021152407862246037,0.002618858590722084,0.0002446242142468691],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.4125000238418579,-0.2750000059604645],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0002446242142468691,0.005947472993284464,0.0036900248378515244],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0020541830454021692,-9.937761933542788e-05,-0.0013756133848801255],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[-0.0013756133848801255,-0.0024164936039596796,-0.003783000633120537],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-0.003783000633120537,-0.0037830001674592495,-0.005102294962853193],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.005102294962853193,-0.004109933506697416,-0.005453224293887615],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.005453224293887615,-0.003457849845290184,-0.004800593014806509],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.004800593014806509,-0.0021152407862246037,-0.003468266222625971],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[-0.003468266222625971,0.0002446242142468691,-0.0011214371770620346],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,-0.2750000059604645,-0.13750000298023224],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[-0.0011214371770620346,0.0036900248378515244,0.0022079588379710913],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0016916065942496061,-0.0013756133848801255,-0.0018024157034233212],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[-0.0018024157034233212,-0.003783000633120537,-0.004109933506697416],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-0.004109933506697416,-0.005102294962853193,-0.0054532247595489025],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.0054532247595489025,-0.005453224293887615,-0.005803864449262619],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.005803864449262619,-0.004800593014806509,-0.005193202756345272],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.005193202756345272,-0.003468266222625971,-0.003882543882355094],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[-0.003882543882355094,-0.0011214371770620346,-0.0015464891912415624],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,-0.13750000298023224,0.0],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[-0.0015464891912415624,0.0022079588379710913,0.0016271979548037052],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0021520296577364206,-0.0018024157034233212,-0.0011152841616421938],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[-0.0011152841616421938,-0.004109933506697416,-0.0034578482154756784],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-0.0034578482154756784,-0.0054532247595489025,-0.0048005906865000725],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.0048005906865000725,-0.005803864449262619,-0.005193203687667847],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.005193203687667847,-0.005193202756345272,-0.0046201287768781185],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.0046201287768781185,-0.003882543882355094,-0.0033765838015824556],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[-0.0033765838015824556,-0.0015464891912415624,-0.001203073188662529],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.0,0.13750000298023224],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[-0.001203073188662529,0.0016271979548037052,0.00207264325581491],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0036816324573010206,-0.0011152841616421938,0.0002512667851988226],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0002512667851988226,-0.0034578482154756784,-0.00211524055339396],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[-0.00211524055339396,-0.0048005906865000725,-0.003468265989795327],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.003468265989795327,-0.005193203687667847,-0.0038825448136776686],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.0038825448136776686,-0.0046201287768781185,-0.0033765833359211683],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.0033765833359211683,-0.0033765838015824556,-0.002167513594031334],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[-0.002167513594031334,-0.001203073188662529,5.6114004109986126e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.13750000298023224,0.2750000059604645],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[5.6114004109986126e-05,0.00207264325581491,0.003199667204171419],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0059000663459300995,0.0002512667851988226,0.0026188583578914404],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0026188583578914404,-0.00211524055339396,0.00024462537840008736],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.00024462537840008736,-0.003468265989795327,-0.0011214378755539656],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[-0.13750000298023224,0.0,0.0],"z":[-0.0011214378755539656,-0.0038825448136776686,-0.0015464884927496314],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[-0.0015464884927496314,-0.0033765833359211683,-0.0012030716752633452],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[-0.0012030716752633452,-0.002167513594031334,5.611532833427191e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[5.611532833427191e-05,5.6114004109986126e-05,0.0022796904668211937],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.2750000059604645,0.4125000238418579],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0022796904668211937,0.003199667204171419,0.0055448333732783794],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.550000011920929,-0.4125000238418579,-0.4125000238418579],"z":[0.009371815249323845,0.0026188583578914404,0.005947473458945751],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.4125000238418579,-0.2750000059604645,-0.2750000059604645],"z":[0.005947473458945751,0.00024462537840008736,0.003690022276714444],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.2750000059604645,-0.13750000298023224,-0.13750000298023224],"z":[0.003690022276714444,-0.0011214378755539656,0.0022079560440033674],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[-0.13750000298023224,0.0,0.0],"z":[0.0022079560440033674,-0.0015464884927496314,0.0016271955100819468],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.0,0.13750000298023224,0.13750000298023224],"z":[0.0016271955100819468,-0.0012030716752633452,0.0020726430229842663],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.13750000298023224,0.2750000059604645,0.2750000059604645],"z":[0.0020726430229842663,5.611532833427191e-05,0.0031996637117117643],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.2750000059604645,0.4125000238418579,0.4125000238418579],"z":[0.0031996637117117643,0.0022796904668211937,0.00554483849555254],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.550000011920929,0.4125000238418579,0.550000011920929],"y":[0.4125000238418579,0.550000011920929,0.550000011920929],"z":[0.00554483849555254,0.0055448333732783794,0.008682269603013992],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.00878162868320942,0.0055454084649682045,0.005545407999306917],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.005545407999306917,0.002182161435484886,0.003139992244541645],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.003139992244541645,-9.937785216607153e-05,0.002054185839369893],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.002054185839369893,-0.0013756140833720565,0.0016916069434955716],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.0,0.0,0.13750000298023224],"z":[0.0016916069434955716,-0.0018024155870079994,0.00215203152038157],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.00215203152038157,-0.0011152835795655847,0.0036816310603171587],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0036816310603171587,0.00025126710534095764,0.005900067742913961],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.550000011920929,-0.4125000238418579,-0.550000011920929],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.005900067742913961,0.002618858590722084,0.00937181431800127],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0055454084649682045,0.0031399924773722887,0.002182161435484886],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.002182161435484886,-9.937761933542788e-05,-9.937785216607153e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-9.937785216607153e-05,-0.0024164936039596796,-0.0013756140833720565],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.0013756140833720565,-0.0037830001674592495,-0.0018024155870079994],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.0,0.0,0.13750000298023224],"z":[-0.0018024155870079994,-0.004109933506697416,-0.0011152835795655847],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.0011152835795655847,-0.003457849845290184,0.00025126710534095764],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.00025126710534095764,-0.0021152407862246037,0.002618858590722084],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.4125000238418579,-0.2750000059604645,-0.4125000238418579],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.002618858590722084,0.0002446242142468691,0.005947472993284464],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0031399924773722887,0.0020541830454021692,-9.937761933542788e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[-9.937761933542788e-05,-0.0013756133848801255,-0.0024164936039596796],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-0.0024164936039596796,-0.003783000633120537,-0.0037830001674592495],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.0037830001674592495,-0.005102294962853193,-0.004109933506697416],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.0,0.0,0.13750000298023224],"z":[-0.004109933506697416,-0.005453224293887615,-0.003457849845290184],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.003457849845290184,-0.004800593014806509,-0.0021152407862246037],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[-0.0021152407862246037,-0.003468266222625971,0.0002446242142468691],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.2750000059604645,-0.13750000298023224,-0.2750000059604645],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0002446242142468691,-0.0011214371770620346,0.0036900248378515244],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0020541830454021692,0.0016916065942496061,-0.0013756133848801255],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[-0.0013756133848801255,-0.0018024157034233212,-0.003783000633120537],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-0.003783000633120537,-0.004109933506697416,-0.005102294962853193],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.005102294962853193,-0.0054532247595489025,-0.005453224293887615],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.0,0.0,0.13750000298023224],"z":[-0.005453224293887615,-0.005803864449262619,-0.004800593014806509],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.004800593014806509,-0.005193202756345272,-0.003468266222625971],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[-0.003468266222625971,-0.003882543882355094,-0.0011214371770620346],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[-0.13750000298023224,0.0,-0.13750000298023224],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[-0.0011214371770620346,-0.0015464891912415624,0.0022079588379710913],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0016916065942496061,0.0021520296577364206,-0.0018024157034233212],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[-0.0018024157034233212,-0.0011152841616421938,-0.004109933506697416],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-0.004109933506697416,-0.0034578482154756784,-0.0054532247595489025],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.0054532247595489025,-0.0048005906865000725,-0.005803864449262619],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.0,0.0,0.13750000298023224],"z":[-0.005803864449262619,-0.005193203687667847,-0.005193202756345272],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.005193202756345272,-0.0046201287768781185,-0.003882543882355094],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[-0.003882543882355094,-0.0033765838015824556,-0.0015464891912415624],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.13750000298023224,0.0],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[-0.0015464891912415624,-0.001203073188662529,0.0016271979548037052],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0021520296577364206,0.0036816324573010206,-0.0011152841616421938],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[-0.0011152841616421938,0.0002512667851988226,-0.0034578482154756784],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-0.0034578482154756784,-0.00211524055339396,-0.0048005906865000725],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.0048005906865000725,-0.003468265989795327,-0.005193203687667847],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.0,0.0,0.13750000298023224],"z":[-0.005193203687667847,-0.0038825448136776686,-0.0046201287768781185],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.0046201287768781185,-0.0033765833359211683,-0.0033765838015824556],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[-0.0033765838015824556,-0.002167513594031334,-0.001203073188662529],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.13750000298023224,0.2750000059604645,0.13750000298023224],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[-0.001203073188662529,5.6114004109986126e-05,0.00207264325581491],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0036816324573010206,0.0059000663459300995,0.0002512667851988226],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0002512667851988226,0.0026188583578914404,-0.00211524055339396],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[-0.00211524055339396,0.00024462537840008736,-0.003468265989795327],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.003468265989795327,-0.0011214378755539656,-0.0038825448136776686],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.0,0.0,0.13750000298023224],"z":[-0.0038825448136776686,-0.0015464884927496314,-0.0033765833359211683],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.0033765833359211683,-0.0012030716752633452,-0.002167513594031334],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[-0.002167513594031334,5.611532833427191e-05,5.6114004109986126e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.2750000059604645,0.4125000238418579,0.2750000059604645],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[5.6114004109986126e-05,0.0022796904668211937,0.003199667204171419],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.550000011920929,-0.550000011920929,-0.4125000238418579],"z":[0.0059000663459300995,0.009371815249323845,0.0026188583578914404],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.4125000238418579,-0.4125000238418579,-0.2750000059604645],"z":[0.0026188583578914404,0.005947473458945751,0.00024462537840008736],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.2750000059604645,-0.2750000059604645,-0.13750000298023224],"z":[0.00024462537840008736,0.003690022276714444,-0.0011214378755539656],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[-0.13750000298023224,-0.13750000298023224,0.0],"z":[-0.0011214378755539656,0.0022079560440033674,-0.0015464884927496314],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.0,0.0,0.13750000298023224],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.0,0.0,0.13750000298023224],"z":[-0.0015464884927496314,0.0016271955100819468,-0.0012030716752633452],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.13750000298023224,0.13750000298023224,0.2750000059604645],"z":[-0.0012030716752633452,0.0020726430229842663,5.611532833427191e-05],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.2750000059604645,0.2750000059604645,0.4125000238418579],"z":[5.611532833427191e-05,0.0031996637117117643,0.0022796904668211937],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.4125000238418579,0.550000011920929,0.4125000238418579],"y":[0.4125000238418579,0.4125000238418579,0.550000011920929],"z":[0.0022796904668211937,0.00554483849555254,0.0055448333732783794],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"},{"color":"orange","opacity":0.5,"scene":"scene2","showlegend":false,"x":[0.0,0.0,0.0],"y":[0.0,0.0,0.0],"z":[0.0,0.0,0.0],"type":"mesh3d"}],                        {"annotations":[{"font":{"size":16},"showarrow":false,"text":"Before optimization","x":0.225,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"},{"font":{"size":16},"showarrow":false,"text":"After optimization","x":0.775,"xanchor":"center","xref":"paper","y":1.0,"yanchor":"bottom","yref":"paper"}],"scene":{"domain":{"x":[0.0,0.45],"y":[0.0,1.0]}},"template":{"data":{"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"choropleth":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"choropleth"}],"contourcarpet":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"contourcarpet"}],"contour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"contour"}],"heatmapgl":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmapgl"}],"heatmap":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"heatmap"}],"histogram2dcontour":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2dcontour"}],"histogram2d":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"histogram2d"}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"mesh3d":[{"colorbar":{"outlinewidth":0,"ticks":""},"type":"mesh3d"}],"parcoords":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"parcoords"}],"pie":[{"automargin":true,"type":"pie"}],"scatter3d":[{"line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatter3d"}],"scattercarpet":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattercarpet"}],"scattergeo":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergeo"}],"scattergl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattergl"}],"scattermapbox":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scattermapbox"}],"scatterpolargl":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolargl"}],"scatterpolar":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterpolar"}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"scatterternary":[{"marker":{"colorbar":{"outlinewidth":0,"ticks":""}},"type":"scatterternary"}],"surface":[{"colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"type":"surface"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}]},"layout":{"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"autotypenumbers":"strict","coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]],"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]},"colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"geo":{"bgcolor":"white","lakecolor":"white","landcolor":"#E5ECF6","showlakes":true,"showland":true,"subunitcolor":"white"},"hoverlabel":{"align":"left"},"hovermode":"closest","mapbox":{"style":"light"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","gridwidth":2,"linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white"}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"ternary":{"aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"bgcolor":"#E5ECF6","caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"title":{"x":0.05},"xaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2},"yaxis":{"automargin":true,"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","zerolinewidth":2}}},"scene2":{"domain":{"x":[0.55,1.0],"y":[0.0,1.0]}}},                        {"responsive": true}                    )                };                            </script>        </div>

<details class="abstract end">
<summary><a href="https://github.com/kaanaksit/odak/discussions/75">Challenge: Differentiable detector</a></summary>
<p>In our examples, where we try bouncing light towards a fixed target, our target is defined as a single point along XYZ axes.
However, in many cases in Optics and Computer Graphics, we may want to design surfaces to resemble a specific distribution of intensities over a plane (e.g., a detector or a camera sensor).
For example, the work by <a href="https://doi.org/10.1145/2601097.2601200">Schwartzburg et al.</a> <sup id="fnref:schwartzburg2014high"><a class="footnote-ref" href="#fn:schwartzburg2014high">8</a></sup> designs optical surfaces such that when light refracts, the distribution of these intensities forms an image at some target plane.
To be able to replicate such works with Odak, odak needs a detector that is differentiable.
This detector could be added as a class in the <code>odak.learn.raytracing</code> submodule, and a new unit test could be added as <code>test/test_learn_detector.py</code>.
To add these to <code>odak,</code> you can rely on the <code>pull request</code> feature on GitHub.</p>
</details>
<h2 id="rendering-scenes">Rendering scenes<a class="headerlink" href="#rendering-scenes" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative ·
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8 8.807V3.5h-.563a.75.75 0 0 1 0-1.5h9.125a.75.75 0 0 1 0 1.5H16v5.307l5.125 9.301c.964 1.75-.302 3.892-2.299 3.892H5.174c-1.998 0-3.263-2.142-2.3-3.892ZM4.189 18.832a1.123 1.123 0 0 0 .985 1.668h13.652a1.123 1.123 0 0 0 .985-1.668L17.7 15H6.3ZM14.5 3.5h-5V9a.75.75 0 0 1-.093.362L7.127 13.5h9.746l-2.28-4.138A.75.75 0 0 1 14.5 9Z"></path></svg></span> Practical </p>
<p>This section shows how one can use raytracing for rendering purposes in Computer Graphics.
Note that the provided example is simple, aiming to introduce a newcomer to how raytracing could be used for rendering purposes.
The example uses a single perspective camera and relies on a concept called splatting, where rays originate from a camera towards a scene.
The scene is composed of randomly colored triangles, and each time a ray hits a random colored triangle, our perspective camera's corresponding pixel is painted with the color of that triangle.
Let us review our simple example by reading the code and observing its outcome.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio"><div class="tabbed-labels"><label for="__tabbed_13_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0Zm1.72 4.97a.75.75 0 0 1 1.06 0l2 2a.75.75 0 0 1 0 1.06l-2 2a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734l1.47-1.47-1.47-1.47a.75.75 0 0 1 0-1.06M3.28 7.78 1.81 9.25l1.47 1.47a.75.75 0 0 1-.018 1.042.75.75 0 0 1-1.042.018l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.042.018.75.75 0 0 1 .018 1.042m8.22-6.218V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"></path></svg></span> <code>test_learn_raytracing_render.py</code></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">odak</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">output_directory</span><span class="o">=</span><span class="s2">"test_output"</span><span class="p">):</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_directory</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="n">final_surface_point</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">])</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    <span class="n">final_surface</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">define_plane</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">final_surface_point</span><span class="p">)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>    <span class="n">no</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">]</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    <span class="n">start_points</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>        <span class="n">no</span><span class="o">=</span><span class="n">no</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="n">center</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">]</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="p">)</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>    <span class="n">end_point</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    <span class="n">rays</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">create_ray_from_two_points</span><span class="p">(</span><span class="n">start_points</span><span class="p">,</span> <span class="n">end_point</span><span class="p">)</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>    <span class="n">mesh</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">planar_mesh</span><span class="p">(</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>        <span class="n">size</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]),</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a>        <span class="n">number_of_meshes</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">]),</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>        <span class="n">angles</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">70.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>        <span class="n">offset</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]),</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a>    <span class="p">)</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>    <span class="n">triangles</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">get_triangles</span><span class="p">()</span>
</span><span id="__span-6-24"><a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a>    <span class="n">play_button</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
</span><span id="__span-6-25"><a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>        <span class="p">[</span>
</span><span id="__span-6-26"><a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a>            <span class="p">[</span>
</span><span id="__span-6-27"><a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a>                <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
</span><span id="__span-6-28"><a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a>                <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
</span><span id="__span-6-29"><a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a>                <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span>
</span><span id="__span-6-30"><a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>            <span class="p">]</span>
</span><span id="__span-6-31"><a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>        <span class="p">]</span>
</span><span id="__span-6-32"><a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>    <span class="p">)</span>
</span><span id="__span-6-33"><a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a>    <span class="n">triangles</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">play_button</span><span class="p">,</span> <span class="n">triangles</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-34"><a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a>    <span class="n">background_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-35"><a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>    <span class="n">triangles_color</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">triangles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-36"><a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rays</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-37"><a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>    <span class="k">for</span> <span class="n">triangle_id</span><span class="p">,</span> <span class="n">triangle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">triangles</span><span class="p">):</span>
</span><span id="__span-6-38"><a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a>        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">raytracing</span><span class="o">.</span><span class="n">intersect_w_triangle</span><span class="p">(</span><span class="n">rays</span><span class="p">,</span> <span class="n">triangle</span><span class="p">)</span>
</span><span id="__span-6-39"><a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>        <span class="n">check</span> <span class="o">=</span> <span class="n">check</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-40"><a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>        <span class="n">color</span> <span class="o">=</span> <span class="n">triangles_color</span><span class="p">[</span><span class="n">triangle_id</span><span class="p">]</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-6-41"><a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>        <span class="n">image</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="n">check</span><span class="p">[</span><span class="n">check</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
</span><span id="__span-6-42"><a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a>    <span class="n">image</span><span class="p">[</span><span class="n">image</span> <span class="o">==</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">background_color</span>
</span><span id="__span-6-43"><a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">no</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">no</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="__span-6-44"><a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>    <span class="n">odak</span><span class="o">.</span><span class="n">learn</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">save_image</span><span class="p">(</span>
</span><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a>        <span class="s2">"</span><span class="si">{}</span><span class="s2">/image.png"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output_directory</span><span class="p">),</span> <span class="n">image</span><span class="p">,</span> <span class="n">cmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cmax</span><span class="o">=</span><span class="mf">1.0</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>    <span class="p">)</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a>    <span class="k">assert</span> <span class="kc">True</span> <span class="o">==</span> <span class="kc">True</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</span></code></pre></div>
</div>
</div>
</div>
<figure>
<p><a class="glightbox" data-type="image" data-width="100%" data-height="auto" href="../media/raytracing.png" data-desc-position="bottom"><img alt="Image title" src="../media/raytracing.png" width="600"></a>
  </p>
<figcaption>Rendered result for the renderer script of "/test/test_learn_raytracing_render.py".</figcaption>
</figure>
<p>A modern raytracer used in gaming is far more sophisticated than the example we provide here.
There aspects such as material properties or tracing the ray from its source to a camera or allowing rays to interface with multiple materials.
Covering these aspects in a crash course like the one we provide here will take much work.
Instead, we suggest our readers follow the resources provided in other classes, references provided at the end, or any other online available materials.</p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">¶</a></h2>
<p><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 7.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-3 3.75a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v4.25h.75a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5h.75V12h-.75a.75.75 0 0 1-.75-.75"></path><path d="M12 1c6.075 0 11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12 5.925 1 12 1M2.5 12a9.5 9.5 0 0 0 9.5 9.5 9.5 9.5 0 0 0 9.5-9.5A9.5 9.5 0 0 0 12 2.5 9.5 9.5 0 0 0 2.5 12"></path></svg></span> Informative</p>
<p>We can simulate light on a computer using various methods.
We explain "raytracing" as one of these methods.
Often, raytracing deals with light intensities, omitting many other aspects of light, like the phase or polarization of light.
In addition, sending the right amount of rays from a light source into a scene in raytracing is always a struggle as an outstanding sampling problem.
Raytracing creates many success stories in gaming (e.g., <a href="https://www.nvidia.com/en-gb/geforce/rtx/">NVIDIA RTX</a> or <a href="https://gpuopen.com/radeon-rays/">AMD Radeon Rays</a>) and optical component design (e.g., <a href="https://www.zemax.com/">Zemax</a> or <a href="https://www.ansys.com/products/optics-vr/ansys-speos">Ansys Speos</a>).</p>
<p>Overall, we cover a basic introduction to how to model light as rays and how to use rays to optimize against a given target.
Note that our examples resemble simple cases.
This section aims to provide the readers with a suitable basis to get started with the raytracing of light in simulations.
A dedicated and motivated reader could scale up from this knowledge to advance concepts in displays, cameras, visual perception, optical computing, and many other light-based applications.</p>
<div class="admonition warning end">
<p class="admonition-title">Reminder</p>
<p>We host a Slack group with more than 300 members.
This Slack group focuses on the topics of rendering, perception, displays and cameras.
The group is open to public and you can become a member by following <a href="https://complightlab.com/outreach/">this link</a>.
Readers can get in-touch with the wider community using this public group.</p>
</div>
<div class="footnote">
<hr>
<ol>
<li id="fn:spencer1962general">
<p>GH Spencer and MVRK Murty. General ray-tracing procedure. <em>JOSA</em>, 52(6):672–678, 1962.&nbsp;<a class="footnote-backref" href="#fnref:spencer1962general" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref2:spencer1962general" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref3:spencer1962general" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:shirley2018ray">
<p>Peter Shirley. Ray tracing in one weekend. <em>Amazon Digital Services LLC</em>, 1:4, 2018.&nbsp;<a class="footnote-backref" href="#fnref:shirley2018ray" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:mcguire2018graphics">
<p>Morgan McGuire. The graphics codex. 2018.&nbsp;<a class="footnote-backref" href="#fnref:mcguire2018graphics" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:jakob2022dr">
<p>Wenzel Jakob, Sébastien Speierer, Nicolas Roussel, and Delio Vicini. Dr. jit: a just-in-time compiler for differentiable rendering. <em>ACM Transactions on Graphics (TOG)</em>, 41(4):1–19, 2022.&nbsp;<a class="footnote-backref" href="#fnref:jakob2022dr" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:bell1969generalized">
<p>Robert J Bell, Kendall R Armstrong, C Stephen Nichols, and Roger W Bradley. Generalized laws of refraction and reflection. <em>JOSA</em>, 59(2):187–189, 1969.&nbsp;<a class="footnote-backref" href="#fnref:bell1969generalized" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
<li id="fn:born2013principles">
<p>Max Born and Emil Wolf. <em>Principles of optics: electromagnetic theory of propagation, interference and diffraction of light</em>. Elsevier, 2013.&nbsp;<a class="footnote-backref" href="#fnref:born2013principles" title="Jump back to footnote 6 in the text">↩</a></p>
</li>
<li id="fn:paszke2017automatic">
<p>Adam Paszke, Sam Gross, Soumith Chintala, Gregory Chanan, Edward Yang, Zachary DeVito, Zeming Lin, Alban Desmaison, Luca Antiga, and Adam Lerer. Automatic differentiation in pytorch. <em>NIPS 2017 Workshop Autodiff</em>, 2017.&nbsp;<a class="footnote-backref" href="#fnref:paszke2017automatic" title="Jump back to footnote 7 in the text">↩</a></p>
</li>
<li id="fn:schwartzburg2014high">
<p>Yuliy Schwartzburg, Romain Testuz, Andrea Tagliasacchi, and Mark Pauly. High-contrast computational caustic design. <em>ACM Transactions on Graphics (TOG)</em>, 33(4):1–11, 2014.&nbsp;<a class="footnote-backref" href="#fnref:schwartzburg2014high" title="Jump back to footnote 8 in the text">↩</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../fundamentals/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Fundamentals in optimizing and learning light">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Fundamentals in optimizing and learning light
              </div>
            </div>
          </a>
        
        
          
          <a href="../computer_generated_holography/" class="md-footer__link md-footer__link--next" aria-label="Next: Computer-Generated Holography">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Computer-Generated Holography
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2026
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://x.com/kaanaksit" target="_blank" rel="noopener" title="x.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"></path></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://join.slack.com/t/rpcdrendering-m4b9370/shared_invite/zt-13b5caruu-o7Ra99nEXkntnJqVYJTVdg" target="_blank" rel="noopener" title="join.slack.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M94.1 315.1c0 25.9-21.2 47.1-47.1 47.1S0 341 0 315.1 21.2 268 47.1 268h47.1v47.1zm23.7 0c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1v117.8c0 25.9-21.2 47.1-47.1 47.1s-47.1-21.2-47.1-47.1zm47.1-189c-25.9 0-47.1-21.2-47.1-47.1s21.2-47 47.1-47S212 53.2 212 79.1v47.1h-47.1zm0 23.7c25.9 0 47.1 21.2 47.1 47.1S190.8 244 164.9 244H47.1C21.2 244 0 222.8 0 196.9s21.2-47.1 47.1-47.1zm189 47.1c0-25.9 21.2-47.1 47.1-47.1s47 21.2 47 47.1-21.2 47.1-47.1 47.1h-47.1v-47.1zm-23.7 0c0 25.9-21.2 47.1-47.1 47.1S236 222.8 236 196.9V79.1c0-25.9 21.2-47.1 47.1-47.1s47.1 21.2 47.1 47.1zm-47.1 189c25.9 0 47.1 21.2 47.1 47.1s-21.2 47-47.1 47-47.1-21.2-47.1-47.1v-47.1h47.1zm0-23.7c-25.9 0-47.1-21.2-47.1-47.1s21.2-47.1 47.1-47.1h117.8c25.9 0 47.1 21.2 47.1 47.1s-21.2 47.1-47.1 47.1z"></path></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": {"json": [".s2"]}, "base": "../..", "features": ["content.tooltips", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "navigation.instant", "navigation.indexes", "navigation.footer", "search.share", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>